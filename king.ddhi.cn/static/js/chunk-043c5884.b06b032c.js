(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-043c5884"],{"14d3":function(e,r,t){"use strict";var i=t("97cb"),o=t.n(i);o.a},"1f63":function(e,r,t){"use strict";var i=t("fd13"),o=t.n(i);o.a},6184:function(e,r,t){"use strict";t.r(r);var i=function(){var e=this,r=e.$createElement,t=e._self._c||r;return t("div",{staticClass:"shopSet"},[t("div",{staticClass:"page-title"},[e._v(e._s(this._getVuex("pageTitle")))]),t("div",{staticClass:"formBox"},[t("el-form",{ref:"ruleForm",staticClass:"demo-ruleForm",attrs:{model:e.ruleForm,rules:e.rules,"label-width":"130px"}},[t("el-form-item",{attrs:{label:"套餐名称",prop:"title"}},[t("el-input",{staticClass:"gb-ipt",attrs:{placeholder:"请输入套餐名"},model:{value:e.ruleForm.title,callback:function(r){e.$set(e.ruleForm,"title",r)},expression:"ruleForm.title"}})],1),t("el-form-item",{attrs:{label:"副标题",prop:"subtitle"}},[t("el-input",{staticClass:"gb-ipt",attrs:{placeholder:"请输入套餐副标题"},model:{value:e.ruleForm.subtitle,callback:function(r){e.$set(e.ruleForm,"subtitle",r)},expression:"ruleForm.subtitle"}})],1),t("el-form-item",{attrs:{label:"套餐原价",prop:"original_price"}},[t("el-input",{staticClass:"gb-ipt",attrs:{placeholder:"请输入套餐原价"},model:{value:e.ruleForm.original_price,callback:function(r){e.$set(e.ruleForm,"original_price",r)},expression:"ruleForm.original_price"}})],1),t("el-form-item",{attrs:{label:"套餐价格",prop:"total_price"}},[t("el-input",{staticClass:"gb-ipt",attrs:{placeholder:"请输入套餐价格"},model:{value:e.ruleForm.total_price,callback:function(r){e.$set(e.ruleForm,"total_price",r)},expression:"ruleForm.total_price"}})],1),t("el-form-item",{attrs:{label:"时间段",required:""}},[t("div",{staticClass:"timeBox"},[t("el-time-picker",{attrs:{"picker-options":{selectableRange:"00:00:00 - 23:59:59"},placeholder:"任意时间点","value-format":"HH:mm"},model:{value:e.ruleForm.start_time,callback:function(r){e.$set(e.ruleForm,"start_time",r)},expression:"ruleForm.start_time"}}),t("span",{staticClass:"time-span"},[e._v("-")]),t("el-time-picker",{attrs:{"picker-options":{selectableRange:"00:00:00 - 23:59:59"},placeholder:"任意时间点","value-format":"HH:mm"},model:{value:e.ruleForm.end_time,callback:function(r){e.$set(e.ruleForm,"end_time",r)},expression:"ruleForm.end_time"}})],1)]),t("el-form-item",{attrs:{label:"使用时长",prop:"max_duration"}},[t("el-input",{staticClass:"gb-ipt",attrs:{placeholder:"请输入使用时长"},model:{value:e.ruleForm.max_duration,callback:function(r){e.$set(e.ruleForm,"max_duration",r)},expression:"ruleForm.max_duration"}}),t("span",{staticClass:"uni-span"},[e._v("小时")])],1),t("el-form-item",{attrs:{label:"包厢类型",prop:"type_id"}},[t("el-select",{attrs:{placeholder:"请选择包厢类型"},model:{value:e.ruleForm.type_name,callback:function(r){e.$set(e.ruleForm,"type_name",r)},expression:"ruleForm.type_name"}},e._l(e.options,(function(e,r){return t("el-option",{key:r,attrs:{label:e.name,value:e.name}})})),1)],1),t("el-form-item",{attrs:{label:"开放日期",prop:"week_price"}},e._l(e.week_price,(function(r,i){return t("div",{key:i,staticClass:"checkBoxnav"},[1==r.week?t("div",[t("el-checkbox",{on:{change:function(r){return e.checkboxFun(i)}},model:{value:e.week_price[i].checked,callback:function(r){e.$set(e.week_price[i],"checked",r)},expression:"week_price[index].checked"}},[e._v("周一")])],1):e._e(),2==r.week?t("div",[t("el-checkbox",{on:{change:function(r){return e.checkboxFun(i)}},model:{value:e.week_price[i].checked,callback:function(r){e.$set(e.week_price[i],"checked",r)},expression:"week_price[index].checked"}},[e._v("周二")])],1):e._e(),3==r.week?t("div",[t("el-checkbox",{on:{change:function(r){return e.checkboxFun(i)}},model:{value:e.week_price[i].checked,callback:function(r){e.$set(e.week_price[i],"checked",r)},expression:"week_price[index].checked"}},[e._v("周三")])],1):e._e(),4==r.week?t("div",[t("el-checkbox",{on:{change:function(r){return e.checkboxFun(i)}},model:{value:e.week_price[i].checked,callback:function(r){e.$set(e.week_price[i],"checked",r)},expression:"week_price[index].checked"}},[e._v("周四")])],1):e._e(),5==r.week?t("div",[t("el-checkbox",{on:{change:function(r){return e.checkboxFun(i)}},model:{value:e.week_price[i].checked,callback:function(r){e.$set(e.week_price[i],"checked",r)},expression:"week_price[index].checked"}},[e._v("周五")])],1):e._e(),6==r.week?t("div",[t("el-checkbox",{on:{change:function(r){return e.checkboxFun(i)}},model:{value:e.week_price[i].checked,callback:function(r){e.$set(e.week_price[i],"checked",r)},expression:"week_price[index].checked"}},[e._v("周六")])],1):e._e(),7==r.week?t("div",[t("el-checkbox",{on:{change:function(r){return e.checkboxFun(i)}},model:{value:e.week_price[i].checked,callback:function(r){e.$set(e.week_price[i],"checked",r)},expression:"week_price[index].checked"}},[e._v("周日")])],1):e._e(),t("div",{staticClass:"mar-num"},[t("el-input",{staticClass:"price-ipt",attrs:{placeholder:"金额"},model:{value:e.week_price[i].price,callback:function(r){e.$set(e.week_price[i],"price",r)},expression:"week_price[index].price"}})],1),t("span",{staticClass:"t-01"},[e._v("元")]),t("div",{staticClass:"mar-num"},[t("el-input",{staticClass:"price-ipt",attrs:{placeholder:"份数"},model:{value:e.week_price[i].allow_buy,callback:function(r){e.$set(e.week_price[i],"allow_buy",r)},expression:"week_price[index].allow_buy"}})],1),t("span",{staticClass:"t-01"},[e._v("份")])])})),0),t("el-form-item",{attrs:{label:"套餐组合",prop:"goods_detail"}},e._l(e.ruleForm.goods_detail,(function(r,i){return t("div",{key:i,staticClass:"groupBox"},[t("el-autocomplete",{staticClass:"inline-input",attrs:{"fetch-suggestions":e.querySearch,placeholder:"请输入商品名称","trigger-on-focus":!1},on:{select:e.handleSelect,input:function(r){return e.inputFun(i)}},model:{value:e.ruleForm.goods_detail[i].goods_name,callback:function(r){e.$set(e.ruleForm.goods_detail[i],"goods_name",r)},expression:"ruleForm.goods_detail[i].goods_name"}}),t("div",[t("el-input-number",{staticClass:"num-ipt",attrs:{"controls-position":"right",min:1},on:{change:e.handleChange},model:{value:e.ruleForm.goods_detail[i].goods_num,callback:function(r){e.$set(e.ruleForm.goods_detail[i],"goods_num",r)},expression:"ruleForm.goods_detail[i].goods_num"}})],1),t("el-input",{staticClass:"danwei-ipt",attrs:{placeholder:"单位"},model:{value:e.ruleForm.goods_detail[i].goods_unit,callback:function(r){e.$set(e.ruleForm.goods_detail[i],"goods_unit",r)},expression:"ruleForm.goods_detail[i].goods_unit"}}),t("el-input",{staticClass:"danwei-ipt",attrs:{placeholder:"金额"},model:{value:e.ruleForm.goods_detail[i].goods_price,callback:function(r){e.$set(e.ruleForm.goods_detail[i],"goods_price",r)},expression:"ruleForm.goods_detail[i].goods_price"}}),t("span",[e._v("元")]),i==e.ruleForm.goods_detail.length-1?t("i",{staticClass:"add-icon el-icon-circle-plus",on:{click:function(r){return e.addGoodsDetail(i)}}}):t("i",{staticClass:"close-icon el-icon-error",on:{click:function(r){return e.removeGoodsDetail(i)}}})],1)})),0),t("el-form-item",{attrs:{label:"套餐组合",prop:"image"}},[t("uploadFiles",{ref:"uploadImg",attrs:{root:"goods"},on:{theIMG:e.theIMG}}),t("span",{staticClass:"zhushi"},[e._v("（请上传100*100的图片尺寸，不得超过2M，不得超过6张）")])],1),t("el-form-item",{attrs:{label:"购买须知",prop:"summary"}},e._l(e.ruleForm.summary,(function(r,i){return t("div",{key:i,staticClass:"groupBox"},[t("el-input",{staticClass:"n-ipt2",attrs:{placeholder:"请输入小标题"},model:{value:e.ruleForm.summary[i].item_name,callback:function(r){e.$set(e.ruleForm.summary[i],"item_name",r)},expression:"ruleForm.summary[i].item_name"}}),t("el-input",{staticClass:"danwei-ipt2",attrs:{placeholder:"请输入内容"},model:{value:e.ruleForm.summary[i].item_content,callback:function(r){e.$set(e.ruleForm.summary[i],"item_content",r)},expression:"ruleForm.summary[i].item_content"}}),i==e.ruleForm.summary.length-1?t("i",{staticClass:"add-icon el-icon-circle-plus",on:{click:function(r){return e.addSummary(i)}}}):t("i",{staticClass:"close-icon el-icon-error",on:{click:function(r){return e.removeSummary(i)}}})],1)})),0),t("el-form-item",[t("el-button",{attrs:{type:"primary"},on:{click:function(r){return e.submitForm("ruleForm")}}},[e._v("保存")]),t("el-button",{on:{click:function(r){return e.resetForm("ruleForm")}}},[e._v("重置")])],1)],1)],1)])},o=[],a=(t("d81d"),t("a434"),t("b0c0"),t("a9e3"),t("ac1f"),t("1276"),t("9cca")),l=t("2ef0"),s=t.n(l),c={name:"editGroupBuy",components:{uploadFiles:a["a"]},data:function(){return{logos:[],ruleForm:{shop_id:0,merchant_id:0,gb_id:"",week_price:[]},week_price:[],rules:{title:[{required:!0,message:"请输入套餐名称",trigger:"blur"}],original_price:[{required:!0,message:"请输入套餐原价",trigger:"blur"}],total_price:[{required:!0,message:"请输入套餐价格",trigger:"blur"}],type_id:[{required:!0,message:"请选择包厢类型",trigger:"change"}],goods_detail:[{type:"array",required:!0,message:"请输入套餐组合信息",trigger:"blur"}],image:[{required:!0,message:"请上传套餐图片",trigger:"on-change"}],summary:[{required:!0,message:"请填写购买须知",trigger:"blur"}],start_time:[{required:!0,message:"请选择开始时间",trigger:"change"}],end_time:[{required:!0,message:"请选择结束时间",trigger:"change"}],max_duration:[{required:!0,message:"请输入使用时长",trigger:"blur"}]},limit:6,hasImg:!1,restaurants:[],options:[],imgArr:[],fileList:[],isAddImg:!1}},created:function(){this.ruleForm.shop_id=Number(this.$route.query.shop_id),this.ruleForm.merchant_id=Number(this.$route.query.merchant_id),this.ruleForm.gb_id=this.$route.query.gb_id,this.ruleForm.gb_id&&this.getGroudbuyDetaile(),this.getGoodsClass()},methods:{checkboxFun:function(e){},getGoodsClass:function(){var e=this,r={merchant_id:this.ruleForm.merchant_id,shop_id:this.ruleForm.shop_id};this.api.shop.getPlaceType(r).then((function(r){e.options=r.data.data}))},querySearch:function(e,r){var t=this.restaurants;r(t)},handleSelect:function(e){},inputFun:function(e){var r=this,t={name:this.ruleForm.goods_detail[e].goods_name,shop_id:this.ruleForm.merchant_id,merchant_id:this.ruleForm.shop_id};this.$store.dispatch("goods/getGroupBuySelectGoods",t).then((function(e){var t=[];e.data.map((function(e){t.push({value:e.name})})),r.restaurants=t}))},getGroudbuyDetaile:function(){var e=this,r={shop_id:this.ruleForm.merchant_id,merchant_id:this.ruleForm.shop_id,id:this.ruleForm.gb_id};this.$store.dispatch("goods/getGroupBuyDetail",r).then((function(r){e.ruleForm=r.data,e.$refs.uploadImg.concert(e.ruleForm.image),e.ruleForm.original_price=Number(e.ruleForm.original_price)/100,e.ruleForm.total_price=Number(e.ruleForm.total_price)/100;for(var t=0;t<e.ruleForm.goods_detail.length;t++)e.ruleForm.goods_detail[t].goods_price=Number(e.ruleForm.goods_detail[t].goods_price)/100;e.week_price=[{week:1,price:"",allow_buy:"",checked:!1},{week:2,price:"",allow_buy:"",checked:!1},{week:3,price:"",allow_buy:"",checked:!1},{week:4,price:"",allow_buy:"",checked:!1},{week:5,price:"",allow_buy:"",checked:!1},{week:6,price:"",allow_buy:"",checked:!1},{week:7,price:"",allow_buy:"",checked:!1}];var i=[],o=[],a=[];i=r.data.allow_week_days.split(","),o=r.data.allow_week_price.split(","),a=r.data.allow_week_buy.split(",");var l={};l.week=i,l.price=o,l.allow_buy=a;var s=[];for(t=0;t<l.week.length;t++)l.week[t]=Number(l.week[t]),l.price[t]=Number(l.price[t])/100,l.allow_buy[t]=Number(l.allow_buy[t]),s.push({week:1,price:"",allow_buy:"",checked:!0}),s[t].week=l.week[t],s[t].price=l.price[t],s[t].allow_buy=l.allow_buy[t];for(t=0;t<s.length;t++)for(var c=0;c<e.week_price.length;c++)s[t].week==e.week_price[c].week&&(e.week_price[c].checked=!0,e.week_price[c].price=s[t].price,e.week_price[c].allow_buy=s[t].allow_buy)}))},handleChange:function(e){this.ruleForm.sum=e},checkWeekPrice:function(e){if(!e.length)return!1;for(var r in e){var t=e[r],i=t.allow_buy>0&&t.price>0&&t.week>0;if(!i)return!1}return!0},submitForm:function(e){var r=this;this.$refs[e].validate((function(e){if(!e)return console.log("error submit!!"),!1;var t=s.a.cloneDeep(r.ruleForm);t.original_price=100*Number(t.original_price),t.total_price=100*Number(t.total_price);for(var i=0;i<t.goods_detail.length;i++)t.goods_detail[i].goods_price=100*Number(t.goods_detail[i].goods_price);t.week_price=[];for(i=r.week_price.length-1;i>=0;i--)r.week_price[i].checked&&(r.week_price[i].price=Number(r.week_price[i].price),r.week_price[i].allow_buy=Number(r.week_price[i].allow_buy),t.week_price.push({allow_buy:r.week_price[i].allow_buy,price:100*r.week_price[i].price,week:r.week_price[i].week}));if(r.checkWeekPrice(t.week_price)){for(i=0;i<r.options.length;i++)r.options[i].name==t.type_name&&(t.type_id=r.options[i].type_id);delete t.allow_week_buy,delete t.allow_week_days,delete t.allow_week_price,r.$store.dispatch("goods/updateGroupBuy",t).then((function(e){r.$message({message:""+e.msg,type:"success"}),r.$router.push({path:"/ShopInfo",query:{merchant_id:r.ruleForm.merchant_id,shop_id:r.ruleForm.shop_id,tab:"shopGroups"}})}))}else r.$message.error("必须设置开放日期...")}))},resetForm:function(e){this.$refs[e].resetFields()},theIMG:function(e){this.ruleForm.image=e},addGoodsDetail:function(e){this.ruleForm.goods_detail.push({goods_name:"",goods_num:1,goods_unit:"",goods_price:0})},removeGoodsDetail:function(e){this.ruleForm.goods_detail.splice(e,1)},addSummary:function(e){this.ruleForm.summary.push({item_name:"",item_content:""})},removeSummary:function(e){this.ruleForm.summary.splice(e,1)}}},n=c,u=(t("1f63"),t("2877")),d=Object(u["a"])(n,i,o,!1,null,"5ecdd914",null);r["default"]=d.exports},"97cb":function(e,r,t){},"9cca":function(e,r,t){"use strict";var i=function(){var e=this,r=e.$createElement,t=e._self._c||r;return t("div",{staticClass:"uploadFiles"},[t("el-upload",{directives:[{name:"show",rawName:"v-show",value:""!=this.root,expression:"this.root != ''"}],staticClass:"avatar-uploader",attrs:{action:"/api/file/uploads","show-file-list":!1,"file-list":e.fileList,limit:1,"http-request":e.uploadImg,"on-change":e.handleChange,"before-upload":e.beforeAvatarUpload}},[e.imageUrl?t("img",{staticClass:"avatar",attrs:{src:e.imageUrl}}):t("i",{staticClass:"el-icon-plus avatar-uploader-icon"})]),t("h4",{directives:[{name:"show",rawName:"v-show",value:""==this.root,expression:"this.root == ''"}]},[e._v("没有设置路径“root”...")])],1)},o=[],a=(t("a9e3"),t("d3b7"),t("3ca3"),t("ddb0"),t("2b3d"),t("5f87")),l={name:"uploadImg",props:{defaltIcon:Number,root:{type:String,default:""}},data:function(){return{header:{headers:{"Content-Type":"multipart/form-data; boundary=--------------------------AAAAA",AccessToken:Object(a["a"])()}},fileList:[],DataImg:[],imageUrl:""}},methods:{concert:function(e){this.imageUrl=e},beforeAvatarUpload:function(e){var r=e.size/1024/1024<2;return r||this.$message.error("上传图片大小不能超过 2MB!"),r},handleChange:function(e,r){console.log(e.size);var t=e.size/1024/1024<2;console.log(e.size/1024/1024),console.log(e.size/1024/1024<2),t?(this.DataImg=e.raw,this.imageUrl=URL.createObjectURL(e.raw)):(this.fileList=[],this.DataImg=[])},uploadImg:function(e){var r=this,t=new FormData;t.append("file[]",this.DataImg),t.append("root",this.root),this.$ajax.post("/api/file/uploads",t,this.header).then((function(e){0==e.data.code?(r.fileList=[],r.DataImg=[],r.$emit("theIMG",e.data.data.url_path[0],r.defaltIcon)):(r.fileList=[],r.DataImg=[],r.imageUrl="",r.$message({message:e.data.msg,type:"warning"}))}))}}},s=l,c=(t("14d3"),t("2877")),n=Object(c["a"])(s,i,o,!1,null,null,null);r["a"]=n.exports},a434:function(e,r,t){"use strict";var i=t("23e7"),o=t("23cb"),a=t("a691"),l=t("50c4"),s=t("7b0b"),c=t("65f0"),n=t("8418"),u=t("1dde"),d=t("ae40"),m=u("splice"),p=d("splice",{ACCESSORS:!0,0:0,1:2}),_=Math.max,h=Math.min,g=9007199254740991,k="Maximum allowed length exceeded";i({target:"Array",proto:!0,forced:!m||!p},{splice:function(e,r){var t,i,u,d,m,p,f=s(this),b=l(f.length),w=o(e,b),v=arguments.length;if(0===v?t=i=0:1===v?(t=0,i=b-w):(t=v-2,i=h(_(a(r),0),b-w)),b+t-i>g)throw TypeError(k);for(u=c(f,i),d=0;d<i;d++)m=w+d,m in f&&n(u,d,f[m]);if(u.length=i,t<i){for(d=w;d<b-i;d++)m=d+i,p=d+t,m in f?f[p]=f[m]:delete f[p];for(d=b;d>b-i+t;d--)delete f[d-1]}else if(t>i)for(d=b-i;d>w;d--)m=d+i-1,p=d+t-1,m in f?f[p]=f[m]:delete f[p];for(d=0;d<t;d++)f[d+w]=arguments[d+2];return f.length=b-i+t,u}})},fd13:function(e,r,t){}}]);
//# sourceMappingURL=chunk-043c5884.b06b032c.js.map