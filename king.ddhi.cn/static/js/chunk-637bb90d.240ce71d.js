(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-637bb90d"],{"02bc":function(e,t,a){"use strict";var s=a("2677"),i=a.n(s);i.a},1984:function(e,t,a){},2153:function(e,t,a){"use strict";var s=a("47ec"),i=a.n(s);i.a},"22fc":function(e,t,a){},"236c":function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"shopSet"},[a("h2",{staticStyle:{margin:"15px 15px 15px 15px","font-size":"24px"}},[e._v(" "+e._s(e.form.name)+" "),a("el-button",{staticStyle:{"margin-left":"20px"},attrs:{type:"text"},on:{click:e.handleOpenOrder}},[e._v("查看店铺订单")])],1),a("el-tabs",{attrs:{type:"border-card"},on:{"tab-click":e.tabsFun},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[a("el-tab-pane",{attrs:{name:"shopInfo"}},[a("span",{attrs:{slot:"label"},slot:"label"},[a("i",{staticClass:"el-icon-date"}),e._v(" 基本信息")]),a("el-form",{ref:"formShop",staticClass:"basicInfo",attrs:{model:e.form,rules:e.rules,"label-width":"140px"}},[a("el-form-item",{attrs:{label:"商家名称"}},[a("el-input",{model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1),a("el-form-item",{attrs:{label:"商家英文简称"}},[a("el-input",{attrs:{disabled:""},model:{value:e.form.ename,callback:function(t){e.$set(e.form,"ename",t)},expression:"form.ename"}})],1),a("el-form-item",{attrs:{label:"店铺类型",prop:"type_id"}},[a("el-select",{attrs:{placeholder:"请选择店铺类型"},model:{value:e.form.type_id,callback:function(t){e.$set(e.form,"type_id",t)},expression:"form.type_id"}},e._l(e.shopTypeList,(function(e){return a("el-option",{key:e.type_id,attrs:{label:e.type_name,value:e.type_id}})})),1)],1),a("el-form-item",{attrs:{label:"营业时间",required:""}},[a("div",{staticStyle:{display:"flex",width:"200px"}},[a("el-time-picker",{attrs:{"value-format":"HH:mm",format:"HH:mm",placeholder:"开始时间"},model:{value:e.form.business_start_time,callback:function(t){e.$set(e.form,"business_start_time",t)},expression:"form.business_start_time"}}),a("span",{staticStyle:{margin:"0 5px"}},[e._v("-")]),a("el-time-picker",{attrs:{"value-format":"HH:mm",format:"HH:mm",placeholder:"结束时间"},model:{value:e.form.business_stop_time,callback:function(t){e.$set(e.form,"business_stop_time",t)},expression:"form.business_stop_time"}})],1)]),a("el-form-item",{attrs:{label:"省市区",required:""}},[a("el-input",{on:{focus:e.openCitySelect},model:{value:e.shopAreaName,callback:function(t){e.shopAreaName=t},expression:"shopAreaName"}}),a("citySelect",{attrs:{title:e.areaTitle},on:{setArea:e.setCityAreaName}})],1),a("el-form-item",{attrs:{label:"商家地址",prop:"address"}},[a("el-input",{model:{value:e.form.address,callback:function(t){e.$set(e.form,"address",t)},expression:"form.address"}},[a("el-button",{attrs:{slot:"append"},on:{click:e.selectLocation},slot:"append"},[e._v("定位")])],1),a("br"),a("i",{staticClass:"iconfont icon-dingwei"}),e._v("经度："+e._s(e.form.longitude)+" 纬度："+e._s(e.form.latitude)+" "),a("div",[a("el-image",{attrs:{src:"https://restapi.amap.com/v3/staticmap?location="+e.form.longitude+","+e.form.latitude+"&zoom=16&size=700*300&markers=mid,,:"+e.form.longitude+","+e.form.latitude+"&key=ec089479f41e213eb5167410a7be396e"},on:{click:e.selectLocation}},[a("div",{staticClass:"image-slot",attrs:{slot:"placeholder"},slot:"placeholder"},[e._v(" 加载中"),a("span",{staticClass:"dot"},[e._v("...")])])])],1)],1),a("el-form-item",{attrs:{label:"商家电话",prop:"phone"}},[a("el-input",{model:{value:e.form.phone,callback:function(t){e.$set(e.form,"phone",t)},expression:"form.phone"}}),a("span",{staticClass:"form-shan"},[e._v("(多个电话用英文半角分号分隔。如：0772-2663398;0772-5051498)")])],1),a("el-form-item",{attrs:{label:"人均消费",prop:"basic_price"}},[a("el-input",{model:{value:e.form.basic_price,callback:function(t){e.$set(e.form,"basic_price",t)},expression:"form.basic_price"}})],1),a("el-form-item",{attrs:{label:"预定自动审核",prop:"reserve_auto_audit"}},[a("el-checkbox",{model:{value:e.form.reserve_auto_audit,callback:function(t){e.$set(e.form,"reserve_auto_audit",t)},expression:"form.reserve_auto_audit"}},[e._v("预定自动审核")])],1),a("el-form-item",{attrs:{label:"点单自动审核",prop:"shopping_auto_audit"}},[a("el-checkbox",{model:{value:e.form.shopping_auto_audit,callback:function(t){e.$set(e.form,"shopping_auto_audit",t)},expression:"form.shopping_auto_audit"}},[e._v("点单自动审核")])],1),a("el-form-item",{attrs:{label:"支付类型",prop:"shopping_pay_online"}},[a("el-checkbox",{model:{value:e.form.shopping_pay_online,callback:function(t){e.$set(e.form,"shopping_pay_online",t)},expression:"form.shopping_pay_online"}},[e._v("在线支付")])],1),a("el-form-item",{attrs:{label:"店铺logo",prop:"logo"}},[e.imageUrl?a("img",{staticClass:"comimg",attrs:{src:e.imageUrl}}):e._e(),a("Imgcutter",{attrs:{boxHeight:600,cutWidth:500,cutHeight:500,sizeChange:!0},on:{cutDown:e.cutDown}}),a("span",{staticClass:"form-shan"},[e._v("(推荐上传图片尺寸500px * 500px，不得超过2M)")])],1),a("el-form-item",{attrs:{label:"营业状态",prop:"business_status"}},[a("el-radio-group",{model:{value:e.form.business_status,callback:function(t){e.$set(e.form,"business_status",t)},expression:"form.business_status"}},[a("el-radio",{attrs:{label:1}},[e._v("营业中")]),a("el-radio",{attrs:{label:0}},[e._v("暂停营业")])],1)],1),0==e.form.business_status?a("el-form-item",{attrs:{label:"暂停营业公告"}},[a("el-input",{attrs:{type:"textarea",autosize:{minRows:2,maxRows:4},placeholder:"请输入内容"},model:{value:e.form.notice,callback:function(t){e.$set(e.form,"notice",t)},expression:"form.notice"}})],1):e._e(),a("el-form-item",{attrs:{label:"审核状态",prop:"status"}},[a("el-radio-group",{model:{value:e.form.status,callback:function(t){e.$set(e.form,"status",t)},expression:"form.status"}},[a("el-radio",{attrs:{label:0}},[e._v("禁用")]),a("el-radio",{attrs:{label:1}},[e._v("正常显示")]),a("el-radio",{attrs:{label:2}},[e._v("审核中")])],1)],1),a("el-form-item",{attrs:{label:"是否支持VR",prop:"vr"}},[a("el-radio-group",{model:{value:e.form.vr,callback:function(t){e.$set(e.form,"vr",t)},expression:"form.vr"}},[a("el-radio",{attrs:{label:1}},[e._v("是")]),a("el-radio",{attrs:{label:0}},[e._v("否")])],1)],1),1==e.form.vr?a("el-form-item",{attrs:{label:"VR地址"}},[a("el-input",{attrs:{placeholder:"请输入VR地址"},model:{value:e.form.vr_url,callback:function(t){e.$set(e.form,"vr_url",t)},expression:"form.vr_url"}})],1):e._e(),a("el-form-item",{attrs:{label:"是否预定",prop:"reserve"}},[a("el-radio-group",{model:{value:e.form.reserve,callback:function(t){e.$set(e.form,"reserve",t)},expression:"form.reserve"}},[a("el-radio",{attrs:{label:1}},[e._v("是")]),a("el-radio",{attrs:{label:0}},[e._v("否")])],1)],1),a("el-form-item",[a("el-button",{on:{click:function(t){return e.$router.back()}}},[e._v("取消")]),a("el-button",{attrs:{type:"primary",disabled:e.isNothing},on:{click:function(t){return e.updatedShop("info","formShop")}}},[e._v("保存")])],1)],1)],1),a("el-tab-pane",{attrs:{label:"店铺相册",name:"shopAlbum"}},[a("div",{staticClass:"videoBox"},[a("div",{staticClass:"photo-title"},[e._v("视频列表")]),a("draggable",{staticClass:"list-group",attrs:{options:{animation:20}},on:{change:e.draggableChangeVideo},model:{value:e.videoList,callback:function(t){e.videoList=t},expression:"videoList"}},[e._l(e.videoList,(function(t,s){return a("div",{key:s,staticClass:"img-div"},[a("video",{staticClass:"v-img",attrs:{preload:"none",src:t.file_url,poster:t.cover_url,controls:""},on:{mouseover:function(t){return e.videoMouseover(s)},mouseleave:function(t){return e.videoMouseleave(s)}}}),a("div",{directives:[{name:"show",rawName:"v-show",value:t.status,expression:"item.status"}],staticClass:"del-icon"}),a("div",{directives:[{name:"show",rawName:"v-show",value:t.status,expression:"item.status"}],staticClass:"del-icon2",on:{click:function(a){return e.deleteVideoFun(t.video_id)},mouseover:function(t){return e.videoMouseover(s)},mouseleave:function(t){return e.videoMouseleave(s)}}},[a("i",{staticClass:"delete-i el-icon-delete"})])])})),a("div",[a("el-alert",{directives:[{name:"show",rawName:"v-show",value:e.videoList.length>=e.video_limit,expression:"videoList.length >= video_limit"}],attrs:{title:"视频数已经到达限制数。 请删掉一些视频后才能上传。",type:"warning",closable:!1}}),a("uploadVideo",{directives:[{name:"show",rawName:"v-show",value:e.videoList.length<e.video_limit,expression:"videoList.length < video_limit"}],ref:"uploadVideo",staticClass:"uploadTemp",attrs:{limit:e.video_limit,shop:e.isShop,root:"shopvideo"},on:{childrenFun:e.GetVideosUrl}})],1)],2)],1),a("div",{staticClass:"imgBox"},[a("div",[a("div",{staticClass:"photo-title"},[e._v("相册列表")]),a("draggable",{staticClass:"list-group",attrs:{options:{animation:20}},on:{change:e.draggableChangeFile},model:{value:e.fileList,callback:function(t){e.fileList=t},expression:"fileList"}},e._l(e.fileList,(function(t,s){return a("div",{key:s,staticClass:"img-div"},[a("img",{staticClass:"d-img",attrs:{src:t.album_path,alt:""},on:{mouseover:function(t){return e.picMouseover(s)},mouseleave:function(t){return e.picMouseleave(s)},click:function(a){return e.showImg(t.album_path,s)}}}),a("div",{directives:[{name:"show",rawName:"v-show",value:t.status,expression:"item.status"}],staticClass:"del-icon"}),a("div",{directives:[{name:"show",rawName:"v-show",value:t.status,expression:"item.status"}],staticClass:"del-icon2",on:{click:function(a){return e.deletePotoFun(t.album_id)},mouseover:function(t){return e.picMouseover(s)},mouseleave:function(t){return e.picMouseleave(s)}}},[a("i",{staticClass:"delete-i el-icon-delete"})])])})),0)],1),a("div",[a("el-alert",{directives:[{name:"show",rawName:"v-show",value:e.fileList.length>=e.photo_limit,expression:"fileList.length >= photo_limit"}],attrs:{title:"图片数已经到达限制数。 请删掉一些图片后才能上传。",type:"warning",closable:!1}}),a("Imgcutter",{directives:[{name:"show",rawName:"v-show",value:e.fileList.length<e.photo_limit,expression:"fileList.length < photo_limit"}],attrs:{boxHeight:600,cutWidth:684,cutHeight:388,sizeChange:!0},on:{cutDown:e.cutDown2}}),a("P",{staticStyle:{"font-size":"14px",color:"#8c939d"}},[e._v("请保证图片格式正确，且不超过2M。数量不能超过 "+e._s(e.photo_limit)+" 张图片。")])],1)])]),a("el-tab-pane",{staticClass:"summary",attrs:{label:"商品",name:"shopGoods"}},[a("goods",{attrs:{enable:e.showPanle.shopGoods,merchants:{merchant_id:e.merchant_id,shop_id:e.shop_id}}})],1),2==e.form.type_id?a("el-tab-pane",{staticClass:"summary",attrs:{label:"套餐",name:"shopGroups"}},[a("group",{ref:"shopGroupComponent",attrs:{enable:e.showPanle.shopGroups,merchants:{merchant_id:e.merchant_id,shop_id:e.shop_id}}})],1):e._e(),a("el-tab-pane",{staticClass:"summary",attrs:{label:"座位",name:"shopPlace"}},[a("place-main",{attrs:{enable:e.showPanle.shopPlace,merchants:{merchant_id:e.merchant_id,shop_id:e.shop_id}}})],1),a("el-tab-pane",{attrs:{label:"员工",name:"shopStaff"}},[a("staff-main",{attrs:{enable:e.showPanle.shopStaff,merchants:{merchant_id:e.merchant_id,shop_id:e.shop_id}}})],1),a("el-tab-pane",{attrs:{label:"打印机",name:"shopPrint"}},[a("print-manage",{attrs:{enable:e.showPanle.shopPrint,merchants:{merchant_id:e.merchant_id,shop_id:e.shop_id}}})],1)],1),a("el-dialog",{attrs:{title:"位置标注",visible:e.mapForAdd.dialogVisible,"custom-class":"baidu-map",width:"80%"},on:{"update:visible":function(t){return e.$set(e.mapForAdd,"dialogVisible",t)},opened:e.showShopMap}},[a("amap",{ref:"aMap",attrs:{address:e.form.name},on:{chooseLocation:e.chooseLocation}})],1),a("el-dialog",{attrs:{title:"大图预览",visible:e.imgDialogVisible,width:"50%"},on:{"update:visible":function(t){e.imgDialogVisible=t}}},[e.imgDialogVisible?a("el-carousel",{attrs:{autoplay:!1,"indicator-position":"none",arrow:"always",height:"600px","initial-index":e.imgIndex}},e._l(e.fileList,(function(e,t){return a("el-carousel-item",{key:t},[a("div",{staticClass:"imgbox"},[a("el-image",{staticStyle:{height:"600px",width:"auto"},attrs:{fit:"contain",src:e.album_path}})],1)])})),1):e._e()],1),e.showBack?a("go-back"):e._e()],1)},i=[],o=(a("4160"),a("b0c0"),a("a9e3"),a("d3b7"),a("ac1f"),a("25f0"),a("1276"),a("159b"),a("ade3")),r=a("5f87"),l=a("ff03"),n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"videoBox"},[a("el-upload",{directives:[{name:"show",rawName:"v-show",value:""!=this.root,expression:"this.root != ''"},{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{width:"148px"},attrs:{action:"/api/file/uploads","show-file-list":!1,"on-success":e.handleVideoSuccess,"before-upload":e.beforeUploadVideo,"on-progress":e.uploadVideoProcess,"on-change":e.handleChange,"http-request":e.handleUploadSTS,"list-type":"picture-card"}},[""!=e.videoForm.Video&&0==e.videoFlag?a("video",{staticClass:"avatar",attrs:{src:e.videoForm.Video,controls:"controls"}},[e._v(" 您的浏览器不支持视频播放 ")]):""==e.videoForm.Video&&0==e.videoFlag?a("i",{staticClass:"el-icon-plus"}):e._e(),1==e.videoFlag?a("el-progress",{staticStyle:{"margin-top":"30px"},attrs:{type:"circle",percentage:e.videoUploadPercent}}):e._e()],1),a("h4",{directives:[{name:"show",rawName:"v-show",value:""==this.root,expression:"this.root == ''"}]},[e._v("没有设置路径“root”...")]),a("P",{staticClass:"text"},[e._v("请保证视频格式正确，且不超过10M。数量不能超过 "+e._s(e.limit)+" 个视频。")])],1)},c=[],u=(a("c975"),a("96cf"),a("1da1")),d={props:{shop:Boolean,root:{type:String,default:""},limit:{type:Number,default:3}},data:function(){return{isUploadOk:!1,region:"cn-shanghai",userId:"1994484675040235",workFlow:{w1:"6629b72dd776e84f573cdc2aefe4a642",w2:"7e35f1b2bb20acbf6bb8a4274a29a44c",size:2097152},uploader:null,uploadInfo:{},clentSts:{},videoAuth:{},videoForm:{Video:""},loading:!1,videoFlag:!1,videoUploadPercent:0,statusText:"",fileLists:[],header:{headers:{"Content-Type":"multipart/form-data; boundary=--------------------------AAAAA",AccessToken:Object(r["a"])()}}}},created:function(){},methods:{setUploadInfo:function(e){this.uploadInfo=e},beforeUploadVideo:function(e){var t=e.size/1024/1024<10;return-1==["video/mp4","video/ogg","video/flv","video/avi","video/wmv","video/rmvb"].indexOf(e.type)?(this.$message.error("请上传正确的视频格式"),!1):t?void 0:(this.$message.error("上传视频大小不能超过10MB哦!"),!1)},uploadVideoProcess:function(e,t,a){this.videoFlag=!0,this.videoUploadPercent=Math.floor(e.percent)},handleVideoSuccess:function(e,t){this.videoFlag=!1,this.videoUploadPercent=0,200==e.status?(this.videoForm.videoUploadId=e.data.uploadId,this.videoForm.Video=e.data.uploadUrl):this.$message.error("视频上传失败，请重新上传！")},handleChange:function(e,t){this.fileLists.push(e.raw)},uploadImg:function(e){var t=this,a=new FormData;this.loading=!0;var s=this;this.fileLists.forEach((function(e){a.append("file[]",e,e.name),a.append("root",s.root)})),this.$ajax.defaults.headers.common["token"]=Object(r["a"])(),this.$ajax.post("/api/file/uploads",a,this.header).then((function(e){t.loading=!1;var a=e.data.data.url_path;t.shop&&t.$emit("childrenFun",a,"1")})).catch((function(){t.loading=!1}))},startUpload:function(){if(console.info("o"),null!=this.uploader){console.info("yes");var e=this.uploader.startUpload();this.isUploadOk=!1,console.info(e)}},handleUploadSTS:function(e){var t=this;return Object(u["a"])(regeneratorRuntime.mark((function a(){var s,i;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:try{s=t,t.uploader=t.createUploader(),{Vod:{Title:s.uploadInfo.title,CateId:"1000220325",Description:"店铺视频相册",WorkflowId:e.file.size<t.workFlow.size?t.workFlow.w1:t.workFlow.w2,UserData:{Extend:{scene:"shop",shop_id:t.uploadInfo.shop_id}}}},i={Vod:{}},console.info("UserData：",JSON.stringify(i)),t.uploader.addFile(e.file,null,null,null,JSON.stringify(i)),t.isUploadOk=!0,t.startUpload()}catch(o){console.error(o),e.onError("上传失败"),t.$error(o.message)}case 1:case"end":return a.stop()}}),a)})))()},uploadOk:function(e){var t=this;return Object(u["a"])(regeneratorRuntime.mark((function a(){var s,i;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return console.info(e),a.next=3,t.api.shop.shopVideoInsert({shop_id:Number(t.uploadInfo.shop_id),video_id:e.videoId});case 3:s=a.sent,i=s.data,console.info(i),t.$message.success(i.msg+" 视频转码需要一定时间，稍后会在列表中显示。"),t.$emit("childrenFun");case 8:case"end":return a.stop()}}),a)})))()},createUploader:function(){var e=this,t=new AliyunUpload.Vod({timeout:e.timeout||6e4,partSize:e.partSize||1048576,parallel:e.parallel||5,retryCount:e.retryCount||3,retryDuration:e.retryDuration||2,region:e.region,userId:e.userId,addFileSuccess:function(t){e.uploadDisabled=!1,e.resumeDisabled=!1,e.statusText="添加文件成功, 等待上传...",console.log("addFileSuccess: ",t)},onUploadstarted:function(a){console.info("开始上传的uploadInfo：",a);var s={merchant_id:Number(e.uploadInfo.merchant_id),shop_id:Number(e.uploadInfo.shop_id),title:e.uploadInfo.title,description:"店铺视频",file_name:a.file.name,tags:"店铺视频",workflow_id:a.file.size<e.workFlow.size?e.workFlow.w1:e.workFlow.w2};console.info("getAuth参数：",s),console.info("uploader：",t==e.uploadInfo);e.api.shop.shopVideoGetAuth(s).then((function(s){e.videoAuth=s.data.data,console.info("onUploadstarted",e.videoAuth),t.setUploadAuthAndAddress(a,e.videoAuth.upload_auth,e.videoAuth.upload_address,e.videoAuth.video_id),e.statusText="文件开始上传...",console.log("onUploadStarted:"+a.file.name+", endpoint:"+a.endpoint+", bucket:"+a.bucket+", object:"+a.object)}))},onUploadSucceed:function(t){console.info(t),console.log("onUploadSucceed: "+t.file.name+", endpoint:"+t.endpoint+", bucket:"+t.bucket+", object:"+t.object),e.statusText="文件上传成功!",e.uploadOk(t)},onUploadFailed:function(t,a,s){console.log("onUploadFailed: file:"+t.file.name+",code:"+a+", message:"+s),e.statusText="文件上传失败!"},onUploadCanceled:function(t,a,s){console.log("Canceled file: "+t.file.name+", code: "+a+", message:"+s),e.statusText="文件已暂停上传"},onUploadProgress:function(t,a,s){console.log("onUploadProgress:file:"+t.file.name+", fileSize:"+a+", percent:"+Math.ceil(100*s)+"%");var i=Math.ceil(100*s);e.stsProgress=i,e.statusText="文件上传中..."},onUploadTokenExpired:function(t){e.statusText="文件超时..."},onUploadEnd:function(t){console.log("onUploadEnd: uploaded all the files",t),e.statusText="文件上传完毕"}});return t}}},m=d,p=(a("b9aa"),a("2877")),h=Object(p["a"])(m,n,c,!1,null,"fba63154",null),f=h.exports,_=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"citySelect"},[a("el-dialog",{attrs:{title:e.title,visible:e.showCitySelect,width:"30%","before-close":e.handleClose},on:{"update:visible":function(t){e.showCitySelect=t}}},[a("el-card",{staticClass:"box-card "},[a("div",{staticClass:"selectBox"},[a("span",[e._v("省份：")]),a("el-select",{ref:"city1",staticClass:"text item",attrs:{focus:"",filterable:"",placeholder:"请选择"},model:{value:e.getcity1,callback:function(t){e.getcity1=t},expression:"getcity1"}},e._l(e.level1City,(function(t){return a("el-option",{key:t.id,attrs:{label:t.name,value:t.name}},[a("div",{on:{click:function(a){return e.getCity(t,1)}}},[e._v(e._s(t.name))])])})),1)],1),a("div",{staticClass:"selectBox"},[a("span",[e._v("城市：")]),a("el-select",{ref:"city2",staticClass:"text item",attrs:{filterable:"",placeholder:"请选择"},model:{value:e.getcity2,callback:function(t){e.getcity2=t},expression:"getcity2"}},e._l(e.level2City,(function(t){return a("el-option",{key:t.id,attrs:{label:t.name,value:t.name}},[a("div",{on:{click:function(a){return e.getCity(t,2)}}},[e._v(e._s(t.name))])])})),1)],1),a("div",{staticClass:"selectBox"},[a("span",[e._v("区域：")]),a("el-select",{ref:"city3",staticClass:"text item",attrs:{filterable:"",placeholder:"请选择"},model:{value:e.getcity3,callback:function(t){e.getcity3=t},expression:"getcity3"}},e._l(e.level3City,(function(t){return a("el-option",{key:t.id,attrs:{label:t.name,value:t.name}},[a("div",{on:{click:function(a){return e.getCity(t,3)}}},[e._v(e._s(t.name))])])})),1)],1)])],1)],1)},g=[],b={props:{title:{type:String,default:"城市选择"}},data:function(){return{curtitle:this.title,direction:"btt",defaultData:{id:"00000",name:""},level1City:[],level2City:[],level3City:[],getcity1:"",getcity2:"",getcity3:"",city1:"",city2:"",city3:""}},computed:{showCitySelect:function(){return this._getVuex("showCitySelectBox")}},created:function(){this.getCity(this.defaultData,0)},methods:{handleClose:function(e){this._setVuex("showCitySelectBox",!1)},getCity:function(e,t){var a=this,s=e.id;if(3!==t)this.$store.dispatch("shop/getCitySelectList",s).then((function(s){0===t?(a.level1City=s.data,a.level2City=[]):1===t?(a.level2City=s.data,a.level3City=[],a.city1=e,a.$refs.city2.focus()):2===t&&(a.level3City=s.data,a.city2=e,a.$refs.city3.focus())}));else{this.city3=e;var i={province:this.city1,city:this.city2,area:this.city3};this.$emit("setArea",i),this._setVuex("showCitySelectBox",!1)}}}},v=b,y=(a("02bc"),Object(p["a"])(v,_,g,!1,null,"1a724f20",null)),k=y.exports,F=(a("4360"),function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"shopSet"},[a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:4}},[a("el-card",[a("div",{staticClass:"goods-class-list-left",on:{click:e.addGoodsClassOpen}},[a("i",{staticClass:"el-icon-plus"},[e._v("新建分类")])])]),a("el-card",{attrs:{shadow:0==e.class_id?"never":"always"}},[a("div",{class:"goods-class-list-left"+(0==e.class_id?" goods-class-list-selected":""),on:{click:function(t){return e.tabFun(0)}}},[a("i",{staticClass:"el-icon-folder-opened"},[e._v("显示全部")])])]),a("draggable",{staticClass:"list-group",attrs:{options:{animation:20}},on:{change:e.draggableChangeClass},model:{value:e.GoodsClass,callback:function(t){e.GoodsClass=t},expression:"GoodsClass"}},e._l(e.GoodsClass,(function(t,s){return a("el-card",{key:"class"+s,attrs:{shadow:e.class_id==t.class_id?"never":"always"}},[a("div",{class:"goods-class-list-left"+(e.class_id==t.class_id?" goods-class-list-selected":""),on:{click:function(a){return e.tabFun(t.class_id)}}},[e._v(" "+e._s(t.class_name)+" ")]),1==t.status?a("span",{staticClass:"goods-class-list-right"},[a("el-button",{attrs:{type:"warning",size:"mini"},on:{click:function(a){return e.changeStatusClass(t,!1)}}},[e._v("禁用")])],1):e._e(),0==t.status?a("span",{staticClass:"goods-class-list-right"},[a("el-button",{attrs:{type:"",size:"mini"},on:{click:function(a){return e.editClass(t)}}},[e._v("编辑")]),a("el-button",{attrs:{type:"",size:"mini"},on:{click:function(a){return e.changeStatusClass(t,!0)}}},[e._v("启用")])],1):e._e()])})),1)],1),a("el-col",{attrs:{span:20}},[a("div",{staticClass:"add-box"},[a("div",{staticClass:"btn-nav"},[a("el-button",{attrs:{type:"primary"},on:{click:e.addOpen}},[e._v("新增单品")]),a("el-button",{attrs:{type:"primary"},on:{click:e.addGroupOpen}},[e._v("新增商品套餐")])],1),a("div",{staticClass:"so-nav"},[a("div",{staticClass:"btnBox"},[a("div",{staticClass:"g-btn jia-btn",on:{click:function(t){return e.putawayFun(1)}}},[e._v("上架")]),a("div",{staticClass:"g-btn jia-btn",on:{click:function(t){return e.putawayFun(2)}}},[e._v("下架")]),a("div",{staticClass:"g-btn",on:{click:e.batchDelete}},[e._v("删除")])]),a("el-input",{staticClass:"so-ipt",attrs:{placeholder:"请输入商品名称","suffix-icon":"el-icon-search"},on:{change:e.seachFun},model:{value:e.soVal,callback:function(t){e.soVal=t},expression:"soVal"}}),a("el-button",{staticClass:"sosuo",attrs:{type:"primary",clearable:""},on:{click:e.seachFun}},[e._v("搜索")])],1)]),a("div",[a("el-tabs",{attrs:{type:"border-card"},on:{"tab-click":e.oneTabFun},model:{value:e.tabStatus,callback:function(t){e.tabStatus=t},expression:"tabStatus"}},[a("el-tab-pane",{attrs:{label:"已上架商品"}},[a("goods-item",{attrs:{merchants:e.merchants,options:e.options},on:{childFun:e.parentFun,edit:e.editOpen}})],1),a("el-tab-pane",{attrs:{label:"已下架商品"}},[a("goods-item",{attrs:{merchants:e.merchants,options:e.options},on:{childFun:e.parentFun,edit:e.editOpen}})],1)],1)],1),a("div",{staticClass:"pagination"},[a("el-pagination",{ref:"pagination",attrs:{"current-page":e.page,"hide-on-single-page":!0,background:"",layout:"prev, pager, next",total:e.count},on:{"current-change":e.pageChange}})],1)])],1),a("el-dialog",{attrs:{title:e.title,visible:e.dialogVisible,"close-on-click-modal":!1,"destroy-on-close":!0,width:"30%"},on:{"update:visible":function(t){e.dialogVisible=t}}},[a("el-form",{ref:"classForm",staticClass:"demo-classForm",attrs:{model:e.classForm,rules:e.rules,"label-width":"150px"}},[a("el-form-item",{attrs:{label:"分类名称",prop:"class_name"}},[a("el-input",{model:{value:e.classForm.class_name,callback:function(t){e.$set(e.classForm,"class_name",t)},expression:"classForm.class_name"}})],1),a("el-form-item",{attrs:{label:"排序",prop:"class_sort"}},[a("el-input",{model:{value:e.classForm.class_sort,callback:function(t){e.$set(e.classForm,"class_sort",t)},expression:"classForm.class_sort"}})],1),a("el-form-item",{attrs:{label:"启用状态",prop:"status"}},[a("el-switch",{model:{value:e.classForm.status,callback:function(t){e.$set(e.classForm,"status",t)},expression:"classForm.status"}})],1),a("el-form-item",[a("el-button",{attrs:{type:"danger"},on:{click:function(t){return e.delClass(e.classForm.class_id,e.classForm.class_name)}}},[e._v("删除分类")]),a("el-button",{on:{click:function(t){e.dialogVisible=!1}}},[e._v("取消")]),a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitForm("classForm")}}},[e._v("确定")])],1)],1)],1),a("el-dialog",{attrs:{title:"新增商品分类",visible:e.dialogVisibleAdd,"close-on-click-modal":!1,"destroy-on-close":!0,width:"30%"},on:{"update:visible":function(t){e.dialogVisibleAdd=t}}},[a("el-form",{ref:"classFormAdd",staticClass:"demo-classForm",attrs:{model:e.classFormAdd,rules:e.rules,"label-width":"150px"}},[a("el-form-item",{attrs:{label:"分类名称",prop:"class_name"}},[a("el-input",{model:{value:e.classFormAdd.class_name,callback:function(t){e.$set(e.classFormAdd,"class_name",t)},expression:"classFormAdd.class_name"}})],1),a("el-form-item",{attrs:{label:"排序",prop:"class_sort"}},[a("el-input",{model:{value:e.classFormAdd.class_sort,callback:function(t){e.$set(e.classFormAdd,"class_sort",t)},expression:"classFormAdd.class_sort"}})],1),a("el-form-item",{attrs:{label:"状态",prop:"status"}},[a("el-switch",{model:{value:e.classFormAdd.status,callback:function(t){e.$set(e.classFormAdd,"status",t)},expression:"classFormAdd.status"}})],1),a("el-form-item",[a("el-button",{on:{click:function(t){e.dialogVisibleAdd=!1}}},[e._v("取消")]),a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitFormAdd("classFormAdd")}}},[e._v("添加")])],1)],1)],1),a("el-dialog",{attrs:{title:e.delClasstitle,visible:e.deldialogClass,width:"30%"},on:{"update:visible":function(t){e.deldialogClass=t}}},[a("span",[e._v("确定要删除此分类吗")]),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.deldialogClass=!1}}},[e._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:e.confirmDelClassFun}},[e._v("确定")])],1)]),a("el-dialog",{attrs:{title:"添加商品",visible:e.addGoodsDialog,"destroy-on-close":"","close-on-press-escape":!1,"close-on-click-modal":!1,width:"70%"},on:{"update:visible":function(t){e.addGoodsDialog=t}}},[a("add-goods",{attrs:{merchants:{merchant_id:e.merchants.merchant_id,shop_id:e.merchants.shop_id},"goods-class":e.GoodsClass},on:{close:e.addOpen,reload:e.getGoodsList}})],1),a("el-dialog",{attrs:{title:"编辑商品",visible:e.editGoodsDialog,"destroy-on-close":"","close-on-press-escape":!1,"close-on-click-modal":!1,width:"70%"},on:{"update:visible":function(t){e.editGoodsDialog=t},opened:e.showEditGoods}},[a("edit-goods",{ref:"editGoodsRef",attrs:{merchants:{merchant_id:e.merchants.merchant_id,shop_id:e.merchants.shop_id,goods_id:e.goods_id},"goods-class":e.GoodsClass},on:{close:e.editOpen,reload:e.getGoodsList}})],1),a("el-dialog",{attrs:{title:"添加商品套餐",visible:e.addGroupDialog,"destroy-on-close":"","close-on-press-escape":!1,"close-on-click-modal":!1,width:"70%"},on:{"update:visible":function(t){e.addGroupDialog=t}}},[a("add-group",{attrs:{merchants:{merchant_id:e.merchants.merchant_id,shop_id:e.merchants.shop_id},"goods-class":e.GoodsClass},on:{close:e.addGroupOpen,reload:e.getGoodsList}})],1),a("el-dialog",{attrs:{title:"编辑商品套餐",visible:e.editGroupDialog,"destroy-on-close":"","close-on-press-escape":!1,"close-on-click-modal":!1,width:"70%"},on:{"update:visible":function(t){e.editGroupDialog=t},opened:e.showEditGroup}},[a("edit-group",{ref:"editGroupRef",attrs:{merchants:{merchant_id:e.merchants.merchant_id,shop_id:e.merchants.shop_id,goods_id:e.goods_id},"goods-class":e.GoodsClass},on:{close:e.editOpen,reload:e.getGoodsList}})],1),a("el-dialog",{attrs:{title:e.deltitle,visible:e.deldialogVisible,width:"30%"},on:{"update:visible":function(t){e.deldialogVisible=t}}},[a("span",[e._v("确定要删除此商品吗")]),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.deldialogVisible=!1}}},[e._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:e.confirmDelFun}},[e._v("确定")])],1)]),a("el-dialog",{attrs:{title:"批量删除",visible:e.batchdialogVisible,width:"30%"},on:{"update:visible":function(t){e.batchdialogVisible=t}}},[a("span",{staticClass:"s-title"},[e._v("确定要删除以下商品吗?")]),e._l(e.nameArr,(function(t,s){return a("div",{key:s,staticClass:"gz-name"},[e._v(" "+e._s(t)+" ")])})),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.batchdialogVisible=!1}}},[e._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:e.confirmDelbatch}},[e._v("确定")])],1)],2)],1)}),w=[],x=(a("4328"),a("83d4")),C=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"shopSet"},[a("el-tabs",{attrs:{type:"border-card"},on:{"tab-click":e.handleClick},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[a("el-tab-pane",{attrs:{label:"基本信息",name:"first"}},[a("div",{staticStyle:{height:"500px",overflow:"auto"}},[a("el-form",{ref:"ruleForm",staticClass:"demo-ruleForm",attrs:{model:e.ruleForm,rules:e.rules,"label-width":"130px"}},[a("el-form-item",{attrs:{label:"商品名称",prop:"name"}},[a("el-input",{model:{value:e.ruleForm.name,callback:function(t){e.$set(e.ruleForm,"name",t)},expression:"ruleForm.name"}})],1),a("el-form-item",{attrs:{label:"商品小标题",prop:"alias"}},[a("el-input",{model:{value:e.ruleForm.alias,callback:function(t){e.$set(e.ruleForm,"alias",t)},expression:"ruleForm.alias"}})],1),a("el-form-item",{attrs:{label:"商品分类",prop:"class_id"}},[a("el-select",{attrs:{placeholder:"请选择商品分类"},model:{value:e.ruleForm.class_id,callback:function(t){e.$set(e.ruleForm,"class_id",t)},expression:"ruleForm.class_id"}},e._l(e.goodsClass,(function(e,t){return a("el-option",{key:t,attrs:{label:e.class_name,value:e.class_id}})})),1)],1),a("el-form-item",{attrs:{label:"单位",prop:"unit"}},[a("el-input",{model:{value:e.ruleForm.unit,callback:function(t){e.$set(e.ruleForm,"unit",t)},expression:"ruleForm.unit"}}),a("span",{staticClass:"form-shan2"},[e._v("(例：大杯、小杯、L、ml等)")])],1),a("el-form-item",{attrs:{label:"图片",prop:"image"}},[a("uploadFiles",{ref:"uploadImages",staticClass:"uploadTemp",attrs:{limit:e.limit,fileList:e.imageUrl,option:{boxHeigth:600,cutWidth:500,cutHeight:500,sizeChange:!1},root:"goods"},on:{upload:e.uploadTheImages}})],1),a("el-form-item",{attrs:{label:"原价",prop:"m_price"}},[a("el-input",{model:{value:e.ruleForm.m_price,callback:function(t){e.$set(e.ruleForm,"m_price",t)},expression:"ruleForm.m_price"}}),a("span",{staticClass:"form-shan"},[e._v("元")])],1),a("el-form-item",{attrs:{label:"折扣",prop:"discount"}},[a("el-input",{model:{value:e.ruleForm.discount,callback:function(t){e.$set(e.ruleForm,"discount",t)},expression:"ruleForm.discount"}}),a("span",{staticClass:"form-shan"},[e._v(" % "),a("i",{staticStyle:{color:"#aaaaaa","font-style":"normal"}},[e._v("（例：9.8折，输入98）")])])],1),a("el-form-item",{attrs:{label:"现价",required:""}},[a("el-input",{model:{value:e.computedPrice,callback:function(t){e.computedPrice=t},expression:"computedPrice"}}),a("span",{staticClass:"form-shan"},[e._v("元")])],1),a("el-form-item",{attrs:{label:"是否营销",prop:"is_atmosphere"}},[a("el-radio-group",{model:{value:e.ruleForm.is_atmosphere,callback:function(t){e.$set(e.ruleForm,"is_atmosphere",t)},expression:"ruleForm.is_atmosphere"}},[a("el-radio",{attrs:{label:1}},[e._v("是")]),a("el-radio",{attrs:{label:0}},[e._v("否")])],1),a("span",{staticClass:"form-shan2"},[e._v("(注：营销专员，推荐商品)")])],1),a("el-form-item",{attrs:{label:"是否赠品",prop:"allow_giving"}},[a("el-radio-group",{model:{value:e.ruleForm.allow_giving,callback:function(t){e.$set(e.ruleForm,"allow_giving",t)},expression:"ruleForm.allow_giving"}},[a("el-radio",{attrs:{label:1}},[e._v("是")]),a("el-radio",{attrs:{label:0}},[e._v("否")])],1)],1),a("el-form-item",{attrs:{label:"状态",prop:"status"}},[a("el-radio-group",{model:{value:e.ruleForm.status,callback:function(t){e.$set(e.ruleForm,"status",t)},expression:"ruleForm.status"}},[a("el-radio",{attrs:{label:1}},[e._v("上架")]),a("el-radio",{attrs:{label:2}},[e._v("下架")])],1)],1),a("el-form-item",{attrs:{label:"排序",prop:"sort"}},[a("el-input",{model:{value:e.ruleForm.sort,callback:function(t){e.$set(e.ruleForm,"sort",t)},expression:"ruleForm.sort"}})],1)],1)],1)]),a("el-tab-pane",{attrs:{label:"商品属性",name:"second"}},[a("div",{staticStyle:{height:"500px",overflow:"scroll"}},[a("el-button",{attrs:{type:"primary"},on:{click:e.addAttr}},[e._v("添加属性")]),e._l(e.dataList,(function(t,s){return a("div",{key:s,staticClass:"attrBox"},[a("div",{staticClass:"box01"},[a("div",[a("span",{staticClass:"attr-s01"},[e._v("属性名")]),a("span",[a("el-input",{attrs:{placeholder:"请输入属性名"},model:{value:e.dataList[s].name,callback:function(t){e.$set(e.dataList[s],"name",t)},expression:"dataList[i].name"}})],1)]),a("div",{staticClass:"m-nav"},[a("span",{staticClass:"attr-s01"},[e._v("可选类型")]),a("span",[a("el-select",{attrs:{placeholder:"请选择"},model:{value:e.dataList[s].required,callback:function(t){e.$set(e.dataList[s],"required",t)},expression:"dataList[i].required"}},e._l(e.attrOptions,(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)]),a("div",{staticClass:"ac-nav"},[a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.addAttrVal(s)}}},[e._v("增加属性值")]),a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.deleteAttrVal(s)}}},[e._v("删除")])],1)]),e._l(e.dataList[s].attr_val,(function(t,i){return a("div",{key:i,staticClass:"box01 box02"},[a("div",[a("span",{staticClass:"attr-s01"},[e._v("属性值")]),a("span",[a("el-input",{attrs:{clearable:"",placeholder:"请输入内容"},model:{value:e.dataList[s].attr_val[i].name,callback:function(t){e.$set(e.dataList[s].attr_val[i],"name",t)},expression:"dataList[i].attr_val[j].name"}})],1)]),a("div",{staticClass:"m-nav"},[a("span",{staticClass:"attr-s01"},[e._v("价格")]),a("span",[a("el-input",{attrs:{placeholder:"请输入价格"},model:{value:e.dataList[s].attr_val[i].incr_price,callback:function(t){e.$set(e.dataList[s].attr_val[i],"incr_price",t)},expression:"dataList[i].attr_val[j].incr_price"}}),a("span",{staticStyle:{"margin-left":"5px"}},[e._v("元")])],1)]),a("div",[a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.deleteSubAttrVal(s,i)}}},[e._v("删除")])],1)])}))],2)}))],2)]),a("div",{staticClass:"btnBox"},[a("el-button",{attrs:{type:"warning"},on:{click:function(t){return e.resetForm("ruleForm")}}},[e._v("清除输入")]),a("el-button",{attrs:{type:""},on:{click:function(t){return e.$emit("close",!1)}}},[e._v("取消")]),a("el-button",{attrs:{type:"primary",loading:e.loading},on:{click:function(t){return e.submitForm("ruleForm")}}},[e._v("添加")])],1)],1)],1)},D=[],$=(a("a15b"),a("a434"),a("3f0e")),S={name:"addGoodsComponent",components:{uploadFiles:$["a"]},props:{goodsClass:{type:Array},merchants:{type:Object}},data:function(){return{loading:!1,imageUrl:[],header:{headers:{"Content-Type":"multipart/form-data; boundary=--------------------------AAAAA",AccessToken:Object(r["a"])()}},activeName:"first",atmosphereChecked:!1,givingChecked:!1,ruleForm:{merchant_id:null,shop_id:null,class_id:"",name:"",alias:"",price:"",discount:"",unit:"",image:"",images:0,status:1,market_price:"",m_price:"",sort:0,goods_attr:[],is_combo:0,is_atmosphere:0,allow_giving:0},rules:{name:[{required:!0,message:"请输入活动名称",trigger:"blur"}],class_id:[{required:!0,message:"请选择商品分类",trigger:"change"}],unit:[{required:!0,message:"请输入商品单位",trigger:"blur"}],image:[{required:!0,message:"请选择商品主图",trigger:"on-change"}],m_price:[{required:!0,message:"请输入商品原价",trigger:"blur"}],price:[{required:!0,message:"请输入商品现价",trigger:"blur"}],is_atmosphere:[{required:!0,message:"请设置是否营销",trigger:"change"}],allow_giving:[{required:!0,message:"请设置是否赠品",trigger:"change"}]},value1:"",value2:"",attrName:"",attrOptions:[{value:"0",label:"可选"},{value:"1",label:"单选"},{value:"2",label:"多选"}],value:"",showBtn:!1,attrVal:"",attrPrice:"",dataList:[],limit:1}},watch:{},created:function(){},computed:{computedPrice:function(){return""==this.ruleForm.discount?this.ruleForm.m_price:Number(this.ruleForm.m_price)*Number(this.ruleForm.discount)/100}},methods:{handleClick:function(e,t){},addAttr:function(){this.dataList.push({name:"",required:"请选择",attr_val:[{name:"",incr_price:0}]}),this.showBtn=!0},addAttrVal:function(e){this.dataList[e].attr_val.push({name:"",incr_price:0})},deleteAttrVal:function(e){this.dataList.splice(e,1)},deleteSubAttrVal:function(e,t){this.dataList[e].attr_val.splice(t,1)},uploadTheImages:function(e){console.info(e),this.imageUrl=e,this.isAddImg=!0;var t=[];for(var a in e)t.push(this.GetImageUrl(e[a]["url"]));this.ruleForm.image=t.join(",")},submitForm:function(e){var t=this,a=this;this.$refs[e].validate((function(e){if(!e)return console.log("error submit!!"),!1;for(var s=Object.assign({},t.ruleForm),i=0;i<a.dataList.length;i++){a.dataList[i].required=Number(a.dataList[i].required);for(var o=0;o<a.dataList[i].attr_val.length;o++)a.dataList[i].attr_val[o].incr_price=Number(a.dataList[i].attr_val[o].incr_price)}s.goods_attr=t.dataList,s.discount=Number(s.discount),s.market_price=100*Number(s.m_price),s.class_id=Number(s.class_id),s.sort=Number(s.sort),s.price=100*Number(t.computedPrice),s.merchant_id=Number(t.merchants.merchant_id),s.shop_id=Number(t.merchants.shop_id),delete s.m_price,t.loading=!0,t.$store.dispatch("goods/addGoods",s).then((function(e){t.loading=!1,t.ruleForm.name="",t.ruleForm.image="",t.imageUrl=[],t.$refs.uploadImages.clearAllImage(),t.$emit("reload"),t.$message({message:e.msg+" 你可以继续添加。",type:"success"})})).catch((function(){t.loading=!1}))}))},resetForm:function(e){this.$refs[e].resetFields()},parentFun:function(e){this.ruleForm.image=e.toString()}}},L=S,P=(a("5f5d"),Object(p["a"])(L,C,D,!1,null,"5e7b0535",null)),A=P.exports,N=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"shopSet"},[a("el-tabs",{attrs:{type:"border-card"},on:{"tab-click":e.handleClick},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[a("el-tab-pane",{attrs:{label:"基本信息",name:"first"}},[a("div",{staticStyle:{height:"500px",overflow:"auto"}},[a("el-form",{ref:"ruleForm",staticClass:"demo-ruleForm",attrs:{model:e.ruleForm,rules:e.rules,"label-width":"130px"}},[a("el-form-item",{attrs:{label:"商品名称",prop:"name"}},[a("el-input",{model:{value:e.ruleForm.name,callback:function(t){e.$set(e.ruleForm,"name",t)},expression:"ruleForm.name"}})],1),a("el-form-item",{attrs:{label:"商品小标题",prop:"alias"}},[a("el-input",{model:{value:e.ruleForm.alias,callback:function(t){e.$set(e.ruleForm,"alias",t)},expression:"ruleForm.alias"}})],1),a("el-form-item",{attrs:{label:"商品分类",prop:"class_id"}},[a("el-select",{attrs:{placeholder:"请选择商品分类"},model:{value:e.ruleForm.class_id,callback:function(t){e.$set(e.ruleForm,"class_id",t)},expression:"ruleForm.class_id"}},e._l(e.goodsClass,(function(e,t){return a("el-option",{key:t,attrs:{label:e.class_name,value:e.class_id}})})),1)],1),e.ruleForm.unit?a("el-form-item",{attrs:{label:"单位",prop:"unit"}},[a("el-input",{model:{value:e.ruleForm.unit,callback:function(t){e.$set(e.ruleForm,"unit",t)},expression:"ruleForm.unit"}}),a("span",{staticClass:"form-shan2"},[e._v("(例：大杯、小杯、L、ml等)")])],1):e._e(),a("el-form-item",{attrs:{label:"图片",prop:"image"}},[a("uploadFiles",{staticClass:"uploadTemp",attrs:{limit:e.limit,fileList:e.fileList,option:{boxHeigth:600,cutWidth:500,cutHeight:500,sizeChange:!1},root:"goods"},on:{upload:e.uploadTheImages}}),a("span",{staticClass:"form-shan2"},[e._v("(建议尺寸：200x200px)")])],1),a("el-form-item",{attrs:{label:"原价",prop:"m_price"}},[a("el-input",{model:{value:e.ruleForm.m_price,callback:function(t){e.$set(e.ruleForm,"m_price",t)},expression:"ruleForm.m_price"}}),a("span",{staticClass:"form-shan"},[e._v("元")])],1),a("el-form-item",{attrs:{label:"折扣",prop:"discount"}},[a("el-input",{model:{value:e.ruleForm.discount,callback:function(t){e.$set(e.ruleForm,"discount",t)},expression:"ruleForm.discount"}}),a("span",{staticClass:"form-shan"},[e._v(" % "),a("i",{staticStyle:{color:"#aaaaaa","font-style":"normal"}},[e._v("（例：9.8折，输入98）")])])],1),a("el-form-item",{attrs:{label:"现价",required:""}},[a("el-input",{model:{value:e.computedPrice,callback:function(t){e.computedPrice=t},expression:"computedPrice"}}),a("span",{staticClass:"form-shan"},[e._v("元")])],1),a("el-form-item",{attrs:{label:"是否营销",prop:"is_atmosphere"}},[a("el-radio-group",{model:{value:e.ruleForm.is_atmosphere,callback:function(t){e.$set(e.ruleForm,"is_atmosphere",t)},expression:"ruleForm.is_atmosphere"}},[a("el-radio",{attrs:{label:1}},[e._v("是")]),a("el-radio",{attrs:{label:0}},[e._v("否")])],1),a("span",{staticClass:"form-shan2"},[e._v("(注：营销专员，推荐商品)")])],1),a("el-form-item",{attrs:{label:"是否赠品",prop:"allow_giving"}},[a("el-radio-group",{model:{value:e.ruleForm.allow_giving,callback:function(t){e.$set(e.ruleForm,"allow_giving",t)},expression:"ruleForm.allow_giving"}},[a("el-radio",{attrs:{label:1}},[e._v("是")]),a("el-radio",{attrs:{label:0}},[e._v("否")])],1)],1),a("el-form-item",{attrs:{label:"状态",prop:"status"}},[a("el-radio-group",{model:{value:e.ruleForm.status,callback:function(t){e.$set(e.ruleForm,"status",t)},expression:"ruleForm.status"}},[a("el-radio",{attrs:{label:1}},[e._v("上架")]),a("el-radio",{attrs:{label:2}},[e._v("下架")])],1)],1),a("el-form-item",{attrs:{label:"排序",prop:"sort"}},[a("el-input",{model:{value:e.ruleForm.sort,callback:function(t){e.$set(e.ruleForm,"sort",t)},expression:"ruleForm.sort"}})],1)],1)],1)]),a("el-tab-pane",{attrs:{label:"商品属性",name:"second"}},[a("div",{staticStyle:{height:"500px",overflow:"scroll"}},[a("el-button",{attrs:{type:"primary"},on:{click:e.addAttr}},[e._v("添加属性")]),e._l(e.dataList,(function(t,s){return a("div",{key:s,staticClass:"attrBox"},[a("div",{staticClass:"box01"},[a("div",[a("span",{staticClass:"attr-s01"},[e._v("属性名")]),a("span",[a("el-input",{attrs:{placeholder:"请输入属性名"},model:{value:e.dataList[s].name,callback:function(t){e.$set(e.dataList[s],"name",t)},expression:"dataList[i].name"}})],1)]),a("div",{staticClass:"m-nav"},[a("span",{staticClass:"attr-s01"},[e._v("可选类型")]),a("span",[a("el-select",{attrs:{placeholder:"请选择"},on:{change:e.selectChange},model:{value:e.dataList[s].required,callback:function(t){e.$set(e.dataList[s],"required",t)},expression:"dataList[i].required"}},e._l(e.attrOptions,(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)]),a("div",{staticClass:"ac-nav"},[a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.addAttrVal(s)}}},[e._v("增加属性值")]),a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.deleteAttrVal(s)}}},[e._v("删除")])],1)]),e._l(e.dataList[s].attr_val,(function(t,i){return a("div",{key:i,staticClass:"box01 box02"},[a("div",[a("span",{staticClass:"attr-s01"},[e._v("属性值")]),a("span",[a("el-input",{attrs:{clearable:"",placeholder:"请输入内容"},model:{value:e.dataList[s].attr_val[i].name,callback:function(t){e.$set(e.dataList[s].attr_val[i],"name",t)},expression:"dataList[i].attr_val[j].name"}})],1)]),a("div",{staticClass:"m-nav"},[a("span",{staticClass:"attr-s01"},[e._v("价格")]),a("span",[a("el-input",{attrs:{placeholder:"请输入价格"},model:{value:e.dataList[s].attr_val[i].incr_price,callback:function(t){e.$set(e.dataList[s].attr_val[i],"incr_price",t)},expression:"dataList[i].attr_val[j].incr_price"}}),a("span",{staticStyle:{"margin-left":"5px"}},[e._v("元")])],1)]),a("div",[a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.deleteSubAttrVal(s,i)}}},[e._v("删除")])],1)])}))],2)}))],2)]),a("div",{staticClass:"btnBox"},[a("el-button",{on:{click:function(t){return e.$emit("close",e.ruleForm,!1)}}},[e._v("取消")]),a("el-button",{attrs:{type:"primary",loading:e.loading},on:{click:function(t){return e.handleSubmitForm("ruleForm")}}},[e._v("保存")])],1)],1)],1)},G=[],I=a("2ef0"),V=a.n(I),T={name:"editGoods",components:{uploadFiles:$["a"]},props:{merchants:{type:Object},goodsClass:{type:Array}},data:function(){return{loading:!1,header:{headers:{"Content-Type":"multipart/form-data; boundary=--------------------------AAAAA",AccessToken:Object(r["a"])()}},rVal:"请选择",activeName:"first",options:[],goodsData:{},imageUrl:null,ruleForm:{goods_id:"",class_id:"",name:"",alias:"",price:"",discount:"",unit:"",image:"",images:0,status:1,market_price:"",m_price:"",sort:0,is_combo:0,goods_attr:[],is_atmosphere:0,allow_giving:0},value1:[],value2:[],allow_week_days:[],rules:{name:[{required:!0,message:"请输入活动名称",trigger:"blur"}],class_id:[{required:!0,message:"请选择商品分类",trigger:"change"}],unit:[{required:!0,message:"请输入商品单位",trigger:"blur"}],image:[{required:!0,message:"请选择商品主图",trigger:"on-change"}],m_price:[{required:!0,message:"请输入商品原价",trigger:"blur"}],price:[{required:!0,message:"请输入商品现价",trigger:"blur"}],is_atmosphere:[{required:!0,message:"请设置是否营销",trigger:"change"}],allow_giving:[{required:!0,message:"请设置是否赠品",trigger:"change"}]},attrName:"",attrOptions:[{value:"0",label:"可选"},{value:"1",label:"单选"},{value:"2",label:"多选"}],value:"",showBtn:!1,attrVal:"",attrPrice:"",dataList:[],imgArr:[],fileList:[],limit:1}},watch:{merchants:{immediate:!0,handler:function(e){}}},created:function(){},computed:{computedPrice:function(){return""==this.ruleForm.discount?Number(this.ruleForm.m_price):Number(this.ruleForm.m_price)*Number(this.ruleForm.discount)/100}},methods:{getGoodsDetaile:function(e){var t=this;this.$store.dispatch("goods/getGoodsDetail",e).then((function(e){t.ruleForm=e.data;var a=t.ruleForm.image;t.imgArr=a.split(","),t.imgArr.forEach((function(e){t.imageUrl=e;var a=new Object;a.url=e,t.fileList.push(a)})),t.ruleForm.m_price=Number(t.ruleForm.market_price)/100,t.ruleForm.price=Number(t.ruleForm.price)/100,t.ruleForm.class_id=Number(t.ruleForm.class_id),t.ruleForm.goods_attr&&(t.dataList=t.ruleForm.goods_attr,t.dataList.forEach((function(e){0==e.required?e.required="可选":1==e.required?e.required="单选":2==e.required&&(e.required="多选")})))}))},selectChange:function(e){this.dataList.forEach((function(e){"0"==e.required?e.required="可选":"1"==e.required?e.required="单选":"2"==e.required&&(e.required="多选")}))},handleClick:function(e,t){},addAttr:function(){this.dataList.push({group_id:0,name:"",required:"请选择",attr_val:[{attr_id:0,name:"",incr_price:0}]}),this.showBtn=!0},addAttrVal:function(e){this.dataList[e].attr_val.push({attr_id:0,name:"",incr_price:0})},deleteAttrVal:function(e){this.dataList.splice(e,1)},deleteSubAttrVal:function(e,t){this.dataList[e].attr_val.splice(t,1)},uploadTheImages:function(e){console.info(e),this.isAddImg=!0;var t=[];for(var a in e)t.push(e[a]["url"]);this.ruleForm.image=t.join(",")},handleSubmitForm:function(e){var t=this;this.$confirm("确认提交商品数据吗？","提示").then((function(){t.submitForm(e)}))},submitForm:function(e){var t=this,a=this;this.$refs[e].validate((function(e){if(!e)return console.log("error submit!!"),!1;for(var s=V.a.cloneDeep(t.ruleForm),i=0;i<a.dataList.length;i++)if(a.dataList[i].attr_val)for(var o=0;o<a.dataList[i].attr_val.length;o++)a.dataList[i].attr_val[o].incr_price=Number(a.dataList[i].attr_val[o].incr_price);s.class_id=Number(s.class_id),s.discount=Number(s.discount),s.market_price=100*Number(s.m_price),s.sort=Number(s.sort),s.price=100*Number(t.computedPrice),t.is_atmosphere=Number(t.is_atmosphere),t.allow_giving=Number(t.allow_giving),s.merchant_id=Number(t.merchants.merchant_id),s.shop_id=Number(t.merchants.shop_id),delete s.m_price,s.image.constructor==Array?s.image=s.image.join(","):s.image=t.GetImageUrl(s.image),t.dataList.forEach((function(e){"可选"==e.required?e.required=0:"单选"==e.required?e.required=1:"多选"==e.required&&(e.required=2)})),s.goods_attr=t.dataList,t.loading=!0,t.$store.dispatch("goods/updateGoods",s).then((function(e){t.loading=!1,t.$emit("reload"),t.$message({message:""+e.msg,type:"success"})})).catch((function(){t.loading=!1}))}))},resetForm:function(e){this.$refs[e].resetFields()},parentFun:function(e){this.ruleForm.image=e}}},q=T,O=(a("9857"),Object(p["a"])(q,N,G,!1,null,"2b5519de",null)),B=O.exports,j=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"shopSet"},[a("div",{staticClass:"formBox",staticStyle:{height:"500px",overflow:"auto"}},[a("el-form",{ref:"ruleForm",staticClass:"demo-ruleForm",attrs:{model:e.ruleForm,rules:e.rules,"label-width":"130px"}},[a("el-form-item",{attrs:{label:"套餐名称",prop:"name"}},[a("el-input",{staticClass:"gb-ipt",attrs:{placeholder:"请输入套餐名"},model:{value:e.ruleForm.name,callback:function(t){e.$set(e.ruleForm,"name",t)},expression:"ruleForm.name"}})],1),a("el-form-item",{attrs:{label:"副标题",prop:"alias"}},[a("el-input",{staticClass:"gb-ipt",attrs:{placeholder:"请输入套餐副标题"},model:{value:e.ruleForm.alias,callback:function(t){e.$set(e.ruleForm,"alias",t)},expression:"ruleForm.alias"}})],1),a("el-form-item",{attrs:{label:"商品分类",prop:"class_id"}},[a("el-select",{attrs:{placeholder:"请选择商品分类"},model:{value:e.ruleForm.class_id,callback:function(t){e.$set(e.ruleForm,"class_id",t)},expression:"ruleForm.class_id"}},e._l(e.goodsClass,(function(e,t){return a("el-option",{key:t,attrs:{label:e.class_name,value:e.class_id}})})),1)],1),a("el-form-item",{attrs:{label:"套餐原价",prop:"m_price"}},[a("el-input",{staticClass:"gb-ipt",attrs:{placeholder:"请输入套餐原价"},model:{value:e.ruleForm.m_price,callback:function(t){e.$set(e.ruleForm,"m_price",t)},expression:"ruleForm.m_price"}})],1),a("el-form-item",{attrs:{label:"折扣",prop:"discount"}},[a("el-input",{staticClass:"gb-ipt",model:{value:e.ruleForm.discount,callback:function(t){e.$set(e.ruleForm,"discount",t)},expression:"ruleForm.discount"}}),a("span",{staticClass:"form-shan"},[e._v(" % "),a("i",{staticStyle:{color:"#aaaaaa","font-style":"normal"}},[e._v("（例：9.8折，输入98）")])])],1),a("el-form-item",{attrs:{label:"套餐价格",required:""}},[a("el-input",{staticClass:"gb-ipt",attrs:{placeholder:"请输入套餐价格"},model:{value:e.computedPrice,callback:function(t){e.computedPrice=t},expression:"computedPrice"}})],1),a("el-form-item",{attrs:{label:"套餐组合",prop:"combo"}},e._l(e.ruleForm.combo,(function(t,s){return a("div",{key:s,staticClass:"groupBox"},[a("el-autocomplete",{staticClass:"inline-input",attrs:{"fetch-suggestions":e.querySearch,placeholder:"请输入商品名称","trigger-on-focus":!1},on:{select:e.handleSelect,input:function(t){return e.inputFun(s)}},model:{value:e.ruleForm.combo[s].name,callback:function(t){e.$set(e.ruleForm.combo[s],"name",t)},expression:"ruleForm.combo[i].name"}}),a("div",[a("el-input-number",{staticClass:"num-ipt",attrs:{"controls-position":"right",min:1},on:{change:e.handleChange},model:{value:e.ruleForm.combo[s].num,callback:function(t){e.$set(e.ruleForm.combo[s],"num",t)},expression:"ruleForm.combo[i].num"}})],1),a("el-input",{staticClass:"danwei-ipt",attrs:{placeholder:"单位"},model:{value:e.ruleForm.combo[s].unit,callback:function(t){e.$set(e.ruleForm.combo[s],"unit",t)},expression:"ruleForm.combo[i].unit"}}),s==e.ruleForm.combo.length-1?a("i",{staticClass:"add-icon el-icon-circle-plus",on:{click:function(t){return e.addGoodsDetail(s)}}}):a("i",{staticClass:"close-icon el-icon-error",on:{click:function(t){return e.removeGoodsDetail(s)}}})],1)})),0),a("el-form-item",{attrs:{label:"套餐组合",prop:"image"}},[a("uploadFiles",{ref:"uploadImages",staticClass:"uploadTemp",attrs:{limit:e.limit,fileList:[],option:{boxHeigth:600,cutWidth:500,cutHeight:500,sizeChange:!1},root:"goods"},on:{upload:e.uploadTheImages}}),a("span",{staticClass:"zhushi"},[e._v("（请上传100*100的图片尺寸，不得超过2M，不得超过6张）")])],1),a("el-form-item",{attrs:{label:"排序",prop:"sort"}},[a("el-input",{staticClass:"gb-ipt",attrs:{placeholder:"请输入套餐排序"},model:{value:e.ruleForm.sort,callback:function(t){e.$set(e.ruleForm,"sort",t)},expression:"ruleForm.sort"}})],1),a("el-form-item",{attrs:{label:"状态",prop:"status"}},[a("el-radio-group",{model:{value:e.ruleForm.status,callback:function(t){e.$set(e.ruleForm,"status",t)},expression:"ruleForm.status"}},[a("el-radio",{attrs:{label:1}},[e._v("上架")]),a("el-radio",{attrs:{label:2}},[e._v("下架")])],1)],1)],1)],1),a("div",{staticClass:"btnBox"},[a("el-button",{attrs:{type:"warning"},on:{click:function(t){return e.resetForm("ruleForm")}}},[e._v("清除输入")]),a("el-button",{on:{click:function(t){return e.$emit("close",!1)}}},[e._v("取消")]),a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitForm("ruleForm")}}},[e._v("添加")])],1)])},U=[],R=(a("d81d"),{name:"addGroupGoods",components:{uploadFiles:$["a"]},props:{goodsClass:{type:Array},merchants:{type:Object}},data:function(){return{ruleForm:{class_id:"",name:"",alias:"",price:"",discount:"",unit:"",image:"",images:1,status:1,market_price:"",m_price:"",sort:0,combo:[{name:"",num:0,unit:""}],is_combo:1},rules:{name:[{required:!0,message:"请输入套餐名称",trigger:"blur"}],class_id:[{required:!0,message:"请选择商品分类",trigger:"change"}],market_price:[{required:!0,message:"请输入套餐原价",trigger:"blur"}],price:[{required:!0,message:"请输入套餐价格",trigger:"blur"}],combo:[{required:!0,message:"请输入套餐组合信息",trigger:"blur"}],image:[{required:!0,message:"请上传套餐图片",trigger:"on-change"}]},value1:"",value2:"",limit:6,restaurants:[]}},created:function(){},computed:{computedPrice:function(){return""==this.ruleForm.discount?this.ruleForm.m_price:Number(this.ruleForm.m_price)*Number(this.ruleForm.discount)/100}},methods:{querySearch:function(e,t){var a=this.restaurants;t(a)},handleSelect:function(e){},inputFun:function(e){var t=this,a={name:this.ruleForm.combo[e].name,merchant_id:this.merchants.merchant_id,shop_id:this.merchants.shop_id};this.$store.dispatch("goods/getGroupBuySelectGoods",a).then((function(e){var a=[];e.data&&e.data.map((function(e){a.push({value:e.name})})),t.restaurants=a}))},handleChange:function(e){console.log(e)},uploadTheImages:function(e){console.info(e),this.isAddImg=!0;var t=[];for(var a in e)t.push(e[a]["url"]);this.ruleForm.image=t.join(",")},submitForm:function(e){var t=this;this.$refs[e].validate((function(e){if(!e)return console.log("error submit!!"),!1;var a=V.a.cloneDeep(t.ruleForm);if(a.shop_id=Number(t.merchants.shop_id),a.merchant_id=Number(t.merchants.merchant_id),a.class_id=Number(a.class_id),a.discount=Number(a.discount),a.market_price=100*Number(a.m_price),a.sort=Number(a.sort),a.price=100*Number(t.computedPrice),a.image.constructor==Array)a.image=a.image.join(",");else{for(var s=[],i=(s=a.image.split(","),0);i<s.length;i++)s[i]=t.GetImageUrl(s[i]);a.image=s.join(",")}console.info("提交编辑数据：",a),t.$store.dispatch("goods/addGoods",a).then((function(e){t.$message({message:""+e.msg,type:"success"}),t.ruleForm.name="",t.ruleForm.image="",t.$refs.uploadImages.clearAllImage(),t.$emit("reload"),t.$message({message:e.msg+" 你可以继续添加。",type:"success"})}))}))},resetForm:function(e){this.$refs[e].resetFields()},parentFun:function(e){var t=[];t=e,this.ruleForm.image=t.join(",")},addGoodsDetail:function(e){this.ruleForm.combo.push({name:"",num:1,unit:""})},removeGoodsDetail:function(e){this.ruleForm.combo.splice(e,1)},addSummary:function(e){this.ruleForm.summary.push({item_name:"",item_content:""})},removeSummary:function(e){this.ruleForm.summary.splice(e,1)}}}),z=R,M=(a("4dc5"),Object(p["a"])(z,j,U,!1,null,"6da3f44d",null)),E=M.exports,H=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"shopSet"},[a("div",{staticClass:"formBox",staticStyle:{height:"500px",overflow:"auto"}},[a("el-form",{ref:"ruleForm",staticClass:"demo-ruleForm",attrs:{model:e.ruleForm,rules:e.rules,"label-width":"130px"}},[a("el-form-item",{attrs:{label:"套餐名称",prop:"name"}},[a("el-input",{staticClass:"gb-ipt",attrs:{placeholder:"请输入套餐名"},model:{value:e.ruleForm.name,callback:function(t){e.$set(e.ruleForm,"name",t)},expression:"ruleForm.name"}})],1),a("el-form-item",{attrs:{label:"副标题",prop:"alias"}},[a("el-input",{staticClass:"gb-ipt",attrs:{placeholder:"请输入套餐副标题"},model:{value:e.ruleForm.alias,callback:function(t){e.$set(e.ruleForm,"alias",t)},expression:"ruleForm.alias"}})],1),a("el-form-item",{attrs:{label:"商品分类",prop:"class_id"}},[a("el-select",{attrs:{placeholder:"请选择商品分类"},model:{value:e.ruleForm.class_id,callback:function(t){e.$set(e.ruleForm,"class_id",t)},expression:"ruleForm.class_id"}},e._l(e.goodsClass,(function(e,t){return a("el-option",{key:t,attrs:{label:e.class_name,value:e.class_id}})})),1)],1),a("el-form-item",{attrs:{label:"套餐原价",prop:"market_price"}},[a("el-input",{staticClass:"gb-ipt",attrs:{placeholder:"请输入套餐原价"},model:{value:e.ruleForm.market_price,callback:function(t){e.$set(e.ruleForm,"market_price",t)},expression:"ruleForm.market_price"}})],1),a("el-form-item",{attrs:{label:"折扣",prop:"discount"}},[a("el-input",{staticClass:"gb-ipt",model:{value:e.ruleForm.discount,callback:function(t){e.$set(e.ruleForm,"discount",t)},expression:"ruleForm.discount"}}),a("span",{staticClass:"form-shan"},[e._v(" % "),a("i",{staticStyle:{color:"#aaaaaa","font-style":"normal"}},[e._v("（例：9.8折，输入98）")])])],1),a("el-form-item",{attrs:{label:"套餐价格",required:""}},[a("el-input",{staticClass:"gb-ipt",attrs:{placeholder:"请输入套餐价格"},model:{value:e.computedPrice,callback:function(t){e.computedPrice=t},expression:"computedPrice"}})],1),a("el-form-item",{attrs:{label:"套餐组合",prop:"combo"}},e._l(e.ruleForm.combo,(function(t,s){return a("div",{key:s,staticClass:"groupBox"},[a("el-autocomplete",{staticClass:"inline-input",attrs:{"fetch-suggestions":e.querySearch,placeholder:"请输入商品名称","trigger-on-focus":!1},on:{select:e.handleSelect,input:function(t){return e.inputFun(s)}},model:{value:e.ruleForm.combo[s].name,callback:function(t){e.$set(e.ruleForm.combo[s],"name",t)},expression:"ruleForm.combo[i].name"}}),a("div",[a("el-input-number",{staticClass:"num-ipt",attrs:{"controls-position":"right",min:1},on:{change:e.handleChange},model:{value:e.ruleForm.combo[s].num,callback:function(t){e.$set(e.ruleForm.combo[s],"num",t)},expression:"ruleForm.combo[i].num"}})],1),a("el-input",{staticClass:"danwei-ipt",attrs:{placeholder:"单位"},model:{value:e.ruleForm.combo[s].unit,callback:function(t){e.$set(e.ruleForm.combo[s],"unit",t)},expression:"ruleForm.combo[i].unit"}}),s==e.ruleForm.combo.length-1?a("i",{staticClass:"add-icon el-icon-circle-plus",on:{click:function(t){return e.addGoodsDetail(s)}}}):a("i",{staticClass:"close-icon el-icon-error",on:{click:function(t){return e.removeGoodsDetail(s)}}})],1)})),0),a("el-form-item",{attrs:{label:"图片",prop:"image"}},[a("uploadFiles",{staticClass:"uploadTemp",attrs:{limit:e.limit,fileList:e.fileList,option:{boxHeigth:600,cutWidth:500,cutHeight:500,sizeChange:!1},root:"goods"},on:{upload:e.uploadTheImages}}),a("span",{staticClass:"zhushi"},[e._v("（请上传100*100的图片尺寸，不得超过2M，不得超过 "+e._s(e.limit)+" 张）")])],1),a("el-form-item",{attrs:{label:"排序",prop:"sort"}},[a("el-input",{staticClass:"gb-ipt",attrs:{placeholder:"请输入套餐排序"},model:{value:e.ruleForm.sort,callback:function(t){e.$set(e.ruleForm,"sort",t)},expression:"ruleForm.sort"}})],1),a("el-form-item",{attrs:{label:"状态",prop:"status"}},[a("el-radio-group",{model:{value:e.ruleForm.status,callback:function(t){e.$set(e.ruleForm,"status",t)},expression:"ruleForm.status"}},[a("el-radio",{attrs:{label:1}},[e._v("上架")]),a("el-radio",{attrs:{label:2}},[e._v("下架")])],1)],1)],1)],1),a("div",{staticClass:"btnBox"},[a("el-button",{attrs:{type:""},on:{click:function(t){return e.$emit("close",e.ruleForm,!1)}}},[e._v("取消")]),a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.handleSubmitForm("ruleForm")}}},[e._v("保存")])],1)])},W=[],J={name:"editGroupGoods",components:{uploadFiles:$["a"]},props:{merchants:{type:Object},goodsClass:{type:Array}},data:function(){return{ruleForm:{goods_id:"",class_id:"",name:"",alias:"",price:"",discount:"",unit:"",image:"",images:1,status:1,market_price:"",m_price:"",sort:0,combo:[],is_combo:1},rules:{name:[{required:!0,message:"请输入套餐名称",trigger:"blur"}],class_id:[{required:!0,message:"请选择商品分类",trigger:"change"}],market_price:[{required:!0,message:"请输入套餐原价",trigger:"blur"}],price:[{required:!0,message:"请输入套餐价格",trigger:"blur"}],combo:[{required:!0,message:"请输入套餐组合信息",trigger:"blur"}],image:[{required:!0,message:"请上传套餐图片",trigger:"on-change"}]},value1:[],value2:[],limit:6,restaurants:[],imgArr:[],fileList:[],isAddImg:!1}},created:function(){},computed:{computedPrice:function(){return""==this.ruleForm.discount?this.ruleForm.market_price:Number(this.ruleForm.market_price)*Number(this.ruleForm.discount)/100}},methods:{iniPageParam:function(){this.merchant_id=this.$route.query.merchant_id,this.shop_id=this.$route.query.shop_id},getGoodsDetaile:function(e){var t=this;this.$store.dispatch("goods/getGoodsDetail",e).then((function(e){t.ruleForm=e.data;var a=t.ruleForm.image;t.imgArr=a.split(","),t.imgArr.forEach((function(e){var a=new Object;a.url=e,t.fileList.push(a)})),t.ruleForm.combo=t.ruleForm.combo?JSON.parse(t.ruleForm.combo):"",t.ruleForm.price=Number(t.ruleForm.price)/100,t.ruleForm.market_price=Number(t.ruleForm.market_price)/100,t.ruleForm.class_id=Number(t.ruleForm.class_id)}))},querySearch:function(e,t){var a=this.restaurants;t(a)},handleSelect:function(e){},inputFun:function(e){var t=this,a={name:this.ruleForm.combo[e].name};this.$store.dispatch("goods/getGroupBuySelectGoods",a).then((function(e){var a=[];e.data.map((function(e){a.push({value:e.name})})),t.restaurants=a}))},handleChange:function(e){},uploadTheImages:function(e){console.info(e),this.isAddImg=!0;var t=[];for(var a in e)t.push(e[a]["url"]);this.ruleForm.image=t.join(",")},handleSubmitForm:function(e){var t=this;this.$confirm("确认提交套餐数据吗？","提示").then((function(){t.submitForm(e)}))},submitForm:function(e){var t=this;this.$refs[e].validate((function(e){if(!e)return console.log("error submit!!"),!1;var a=V.a.cloneDeep(t.ruleForm);if(a.merchant_id=t.merchants.merchant_id,a.shop_id=t.merchants.shop_id,a.class_id=Number(a.class_id),a.discount=Number(a.discount),a.market_price=100*Number(a.market_price),a.sort=Number(a.sort),a.price=Number(t.computedPrice),a.image.constructor==Array)a.image=a.image.join(",");else{for(var s=[],i=(s=a.image.split(","),0);i<s.length;i++)s[i]=t.GetImageUrl(s[i]);a.image=s.join(",")}console.info("提交编辑数据：",a),t.$store.dispatch("goods/updateGoods",a).then((function(e){t.$emit("reload"),t.$message({message:""+e.msg,type:"success"})}))}))},resetForm:function(e){this.$refs[e].resetFields()},parentFun:function(e,t){var a=[];if(a=e,""==this.ruleForm.image)this.ruleForm.image=a.join(",");else if(t){this.isAddImg=!0;var s=[],i=[];s=this.ruleForm.image.split(",");for(var o=0;o<s.length;o++)i=s[o].split("/upload"),s[o]="/upload"+i[1];this.ruleForm.image=s.join(",")+","+a.join(",")}else this.isAddImg=!0,this.ruleForm.image=a.join(",")},addGoodsDetail:function(e){this.ruleForm.combo.push({name:"",num:1,unit:""})},removeGoodsDetail:function(e){this.ruleForm.combo.splice(e,1)},addSummary:function(e){this.ruleForm.summary.push({item_name:"",item_content:""})},removeSummary:function(e){this.ruleForm.summary.splice(e,1)}}},K=J,Q=(a("f716"),Object(p["a"])(K,H,W,!1,null,"629c84f8",null)),Y=Q.exports,X={name:"Goods",components:{goodsItem:x["a"],addGoods:A,editGoods:B,addGroup:E,editGroup:Y},props:{enable:{type:Boolean,default:!1},merchants:{type:Object}},data:function(){return{addGoodsDialog:!1,editGoodsDialog:!1,addGroupDialog:!1,editGroupDialog:!1,goodsData:{},pageSign:0,soVal:"",options:[],multipleSelection:"",value:!0,page:1,count:0,detaileData:[],dialogVisible:!1,title:"",goods_id:0,sortStatus:!1,f_status:1,dataForm:{goods_id:0,name:"",price:0,vip_price:0,unit:"",image:"",images:"",status:0},rules:{class_name:[{required:!0,message:"请输入分类名称",trigger:"blur"}]},classFormAdd:{class_name:"",class_sort:"",status:!0},classForm:{class_id:0,class_name:"",class_sort:"",status:!1},deldialogVisible:!1,deldialogClass:!1,delClasstitle:"",deltitle:"",dialogVisibleAdd:!1,dataFormAdd:{name:"",price:0,vip_price:0,unit:"",image:"",images:"",status:0},batchdialogVisible:!1,nameArr:[],statusArr:[{text:"下架",value:"0"},{text:"售完",value:"1"},{text:"正常",value:"2"},{text:"删除",value:"3"}],order:"asc",sortVal:"",GoodsClass:[],class_id:0,editableTabsValue:"52",tabStatus:"0",goods_status:1}},watch:{enable:{immediate:!0,handler:function(e){e&&this.reloadData()}}},created:function(){},methods:{draggableChangeClass:function(e){var t=this,a=[];for(var s in this.GoodsClass)this.GoodsClass[s].class_sort=this.GoodsClass.length-1-s,a.push({class_id:this.GoodsClass[s].class_id,class_sort:Number(this.GoodsClass[s].class_sort)});var i={merchant_id:this.merchants.merchant_id,shop_id:this.merchants.shop_id,class:a};this.api.goods.goodsClassSetSort(i).then((function(e){var a=e.data;a.data;t.getGoodsClass()}))},reloadData:function(){var e=this;this.getGoodsClass((function(){e.getGoodsList()}))},parentFun:function(e,t,a,s){1==s?(this.sortVal=e,this.order=t,this.sortDataFun()):2==s?(this.f_status=e,"status"==a&&e?this.filterGetGoodsList():this.getGoodsList()):3==s?(this.deldialogVisible=!0,this.goods_id=e,this.deltitle=a):4==s&&(0==e.length?(this.multipleSelection="",this.nameArr=[]):(this.multipleSelection=e,this.nameArr=a))},filterGetGoodsList:function(){var e=this;this.pageSign=2;var t={page:this.page,status:this.f_status,class_id:this.class_id,merchant_id:this.merchants.merchant_id,shop_id:this.merchants.shop_id};this.$store.dispatch("goods/getGoodsList",t).then((function(t){e.setOptions(t.data),e.count=t.count}))},setOptions:function(e){for(var t in this.options=[],e)this.options[t]=e[t],this.options[t]["sortIsEdit"]=!1},sortDataFun:function(){var e=this;this.pageSign=3;var t={page:this.page,status:this.goods_status,sort:this.sortVal,order:this.order,class_id:this.class_id,merchant_id:this.merchants.merchant_id,shop_id:this.merchants.shop_id};0==this.class_id&&delete datas.class_id,this.$store.dispatch("goods/getGoodsList",t).then((function(t){e.setOptions(t.data),e.count=t.count}))},tabFun:function(e){this.page=1,this.class_id=Number(e),"1"==this.tabStatus?this.getSoldOutList():this.getGoodsList()},oneTabFun:function(e){"1"==e.index?this.getSoldOutList():this.getGoodsList()},getGoodsList:function(){var e=this;this.goods_status=1,this.pageSign=0;var t={page:this.page,class_id:this.class_id,status:this.goods_status,merchant_id:this.merchants.merchant_id,shop_id:this.merchants.shop_id};0==this.class_id&&delete t.class_id,this.$store.dispatch("goods/getGoodsList",t).then((function(t){e.setOptions(t.data),e.count=t.count,e.$refs.pagination.internalCurrentPage=e.page}))},getSoldOutList:function(){var e=this;this.goods_status=2,this.pageSign=4;var t={page:this.page,class_id:this.class_id,status:this.goods_status,merchant_id:this.merchants.merchant_id,shop_id:this.merchants.shop_id};0==this.class_id&&delete t.class_id,this.$store.dispatch("goods/getGoodsList",t).then((function(t){e.setOptions(t.data),e.count=t.count,e.$refs.pagination.internalCurrentPage=e.page}))},addOpen:function(e){this.addGoodsDialog||0!=this.GoodsClass.length?(this.addGoodsDialog=!this.addGoodsDialog,!0===e&&this.getGoodsList()):this.$message({message:"尚未设置商品分类，请先新建商品分类...",type:"warning",duration:0,showClose:!0})},addGroupOpen:function(e){this.addGoodsDialog||0!=this.GoodsClass.length?(this.addGroupDialog=!this.addGroupDialog,!0===e&&this.getGoodsList()):this.$message({message:"尚未设置商品分类，请先新建商品分类...",type:"warning",duration:0,showClose:!0})},showEditGoods:function(){var e={id:this.goodsData.goods_id,merchant_id:this.goodsData.merchant_id,shop_id:this.goodsData.shop_id};this.$refs["editGoodsRef"].getGoodsDetaile(e)},showEditGroup:function(){var e={id:this.goodsData.goods_id,merchant_id:this.goodsData.merchant_id,shop_id:this.goodsData.shop_id};this.$refs["editGroupRef"].getGoodsDetaile(e)},editOpen:function(e,t){this.goodsData=e,0==e.is_combo&&(this.editGoodsDialog=!this.editGoodsDialog),1==e.is_combo&&(this.editGroupDialog=!this.editGroupDialog),t&&this.getGoodsList()},resetForm:function(e){this.$refs[e].resetFields()},confirmDelFun:function(){var e=this,t=[];t.push(this.goods_id);var a={id:t,merchant_id:this.merchants.merchant_id,shop_id:this.merchants.shop_id};this.$store.dispatch("goods/deleteGoods",a).then((function(t){e.$message({message:""+t.msg,type:"success"}),e.getGoodsList(),e.deldialogVisible=!1}))},batchDelete:function(){this.multipleSelection?this.batchdialogVisible=!0:this.$message({message:"请先勾选要删除的商品",type:"warning"})},confirmDelbatch:function(){var e=this,t={id:this.multipleSelection,merchant_id:this.merchants.merchant_id,shop_id:this.merchants.shop_id};this.$store.dispatch("goods/deleteGoods",t).then((function(t){e.$message({message:""+t.msg,type:"success"}),e.getGoodsList(),e.batchdialogVisible=!1}))},putawayFun:function(e){var t=this,a=e;if(this.multipleSelection){var s={id:this.multipleSelection,status:Number(e),merchant_id:this.merchants.merchant_id,shop_id:this.merchants.shop_id};this.$store.dispatch("goods/goodsUpDown",s).then((function(e){t.$message({message:""+e.msg,type:"success"}),1==a&&(t.tabStatus="0"),t.getGoodsList(),t.batchdialogVisible=!1}))}else this.$message({message:"请先勾选要操作的商品",type:"warning"})},pageChange:function(e){this.page=e,0==this.pageSign?this.getGoodsList():1==this.pageSign?this.seachFun():2==this.pageSign?this.filterGetGoodsList():3==this.pageSign?this.sortDataFun():4==this.pageSign&&this.getSoldOutList()},seachFun:function(){var e=this;this.pageSign=1;var t={page:this.page,name:this.soVal,merchant_id:this.merchants.merchant_id,shop_id:this.merchants.shop_id,class_id:this.class_id};0==this.class_id&&delete t.class_id,this.$store.dispatch("goods/getGoodsList",t).then((function(t){e.setOptions(t.data),e.count=t.count}))},getGoodsClass:function(e){var t=this,a={page_size:1e4,merchant_id:this.merchants.merchant_id,shop_id:this.merchants.shop_id};this.$store.dispatch("goods/getGoodsClass",a).then((function(a){t.GoodsClass=a.data,e&&e()}))},editClass:function(e){this.classForm=Object.assign({},e),1==this.classForm.status?this.classForm.status=!0:this.classForm.status=!1,this.dialogVisible=!0,this.title="编辑-"+this.classForm.class_name},changeStatusClass:function(e,t){var a=this,s="",i={};t?(this.classForm=Object.assign({},e),this.classForm.status=t,i=Object.assign({},this.classForm),i.status=t?1:0,i.merchant_id=Number(this.merchants.merchant_id),i.shop_id=Number(this.merchants.shop_id),i.class_sort=Number(i.class_sort),i.class_id=Number(i.class_id),delete i.class_name,delete i.class_count,delete i.delete_time,s="goods/updateGoodsClass"):(i={id:String(e.class_id),merchant_id:Number(this.merchants.merchant_id),shop_id:Number(this.merchants.shop_id)},s="goods/deleteGoodsClass"),this.$store.dispatch(s,i).then((function(e){a.$message({message:""+e.msg,type:"success"}),a.getGoodsClass((function(){a.getGoodsList()}))}))},submitForm:function(e){var t=this;this.$refs[e].validate((function(e){if(!e)return console.log("error submit!!"),!1;var a=Object.assign({},t.classForm);1==a.status?a.status=1:a.status=0,a.merchant_id=Number(t.merchants.merchant_id),a.shop_id=Number(t.merchants.shop_id),a.class_sort=Number(a.class_sort),a.class_id=Number(a.class_id),delete a.class_count,delete a.delete_time,t.$store.dispatch("goods/updateGoodsClass",a).then((function(e){t.$message({message:""+e.msg,type:"success"}),t.getGoodsClass((function(){t.getGoodsList()})),t.dialogVisible=!1}))}))},addGoodsClassOpen:function(){this.classFormAdd={class_name:"",class_sort:"",status:!0},this.dialogVisibleAdd=!0},submitFormAdd:function(e){var t=this;this.$refs[e].validate((function(e){if(!e)return console.log("error submit!!"),!1;var a=Object.assign({},t.classFormAdd);a.class_sort=Number(a.class_sort),1==a.status?a.status=1:a.status=0,a.merchant_id=Number(t.merchants.merchant_id),a.shop_id=Number(t.merchants.shop_id),t.$store.dispatch("goods/addGoodsClass",a).then((function(e){t.$message({message:""+e.msg,type:"success"}),t.getGoodsClass(),t.dialogVisibleAdd=!1}))}))},delClass:function(e,t){this.deldialogClass=!0,this.class_id=e,this.delClasstitle=t},confirmDelClassFun:function(){var e=this,t={id:String(this.class_id),merchant_id:Number(this.merchants.merchant_id),shop_id:Number(this.merchants.shop_id)};this.api.goods.goodsClassRealDelete(t).then((function(t){var a=t.data,s=a;e.$message({message:""+s.msg,type:"success"}),e.getGoodsClass(),e.deldialogClass=!1,e.dialogVisible=!1}))}}},Z=X,ee=(a("ec4f"),Object(p["a"])(Z,F,w,!1,null,"ad82befe",null)),te=ee.exports,ae=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"shopSet"},[a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:4}},[0==e.PlaceType.length?a("el-alert",{attrs:{title:"目前没有座位的分类信息，请先去新增座位的分类信息……",type:"warning",closable:!1}}):e._e(),a("el-card",{attrs:{shadow:0==e.type_id?"never":"always"}},[a("div",{class:"goods-class-list-left"+(0==e.type_id?" goods-class-list-selected":""),on:{click:function(t){return e.tabFun(0)}}},[a("i",{staticClass:"el-icon-folder-opened"},[e._v("显示全部")])])]),e._l(e.PlaceType,(function(t,s){return a("el-card",{key:"placeType_"+s,attrs:{shadow:e.type_id==t.type_id?"never":"always"}},[a("div",{class:"goods-class-list-left"+(e.type_id==t.type_id?" goods-class-list-selected":""),on:{click:function(a){return e.tabFun(t.type_id)}}},[e._v(" "+e._s(t.name)+" ")])])}))],2),a("el-col",{attrs:{span:20}},[a("div",{staticClass:"add-box"},[a("div",{staticClass:"btn-nav"},[a("el-button",{attrs:{type:"primary"},on:{click:e.addOpen}},[e._v("新增套餐")])],1),a("div",{staticClass:"so-nav"},[a("div",{staticClass:"btnBox"},[a("div",{staticClass:"g-btn jia-btn",on:{click:function(t){return e.putawayFun(1)}}},[e._v("上架")]),a("div",{staticClass:"g-btn jia-btn",on:{click:function(t){return e.putawayFun(0)}}},[e._v("下架")]),a("div",{staticClass:"g-btn",on:{click:e.batchDelete}},[e._v("删除")])]),a("el-input",{staticClass:"so-ipt",attrs:{placeholder:"请输入套餐名","suffix-icon":"el-icon-search"},on:{change:e.seachFun},model:{value:e.soVal,callback:function(t){e.soVal=t},expression:"soVal"}}),a("el-button",{staticClass:"sosuo",attrs:{type:"primary"},on:{click:e.seachFun}},[e._v("搜索")])],1)]),a("el-tabs",{attrs:{type:"border-card"},on:{"tab-click":e.oneTabFun},model:{value:e.tabStatus,callback:function(t){e.tabStatus=t},expression:"tabStatus"}},[a("el-tab-pane",{attrs:{label:"已上架套餐"}},[a("div",[a("groupbuy-item",{attrs:{options:e.options,merchants:e.merchants},on:{childFun:e.parentFun,edit:e.editGroupBuyOpenAndClose}})],1)]),a("el-tab-pane",{attrs:{label:"已下架套餐"}},[a("div",[a("groupbuy-item",{attrs:{options:e.options,merchants:e.merchants},on:{childFun:e.parentFun,edit:e.editGroupBuyOpenAndClose}})],1)])],1),a("div",{staticClass:"pagebox"},[a("el-pagination",{ref:"pagination",attrs:{"hide-on-single-page":!0,background:"",layout:"prev, pager, next",total:e.count},on:{"current-change":e.pageChange}})],1)],1)],1),a("div"),a("el-dialog",{attrs:{title:e.deltitle,visible:e.deldialogVisible,width:"30%"},on:{"update:visible":function(t){e.deldialogVisible=t}}},[a("span",[e._v("确定要删除此套餐吗")]),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.deldialogVisible=!1}}},[e._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:e.confirmDelFun}},[e._v("确定")])],1)]),a("el-dialog",{attrs:{title:"批量删除",visible:e.batchdialogVisible,width:"30%"},on:{"update:visible":function(t){e.batchdialogVisible=t}}},[a("span",{staticClass:"s-title"},[e._v("确定要删除以下套餐吗?")]),e._l(e.nameArr,(function(t,s){return a("div",{key:s,staticClass:"gz-name"},[e._v(" "+e._s(t)+" ")])})),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.batchdialogVisible=!1}}},[e._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:e.confirmDelbatch}},[e._v("确定")])],1)],2),a("el-dialog",{attrs:{title:"添加套餐",visible:e.addGroupBuyDialogVisible,"destroy-on-close":"","close-on-press-escape":!1,"close-on-click-modal":!1,width:"70%"},on:{"update:visible":function(t){e.addGroupBuyDialogVisible=t}}},[a("add-group-buy",{attrs:{merchants:e.merchants,"place-type":e.PlaceType},on:{close:e.addGroupBuyOpenAndClose,reload:e.getGroupBuyList}})],1),a("el-dialog",{attrs:{title:"编辑套餐",visible:e.editGroupBuyDialogVisible,"destroy-on-close":"","close-on-press-escape":!1,"close-on-click-modal":!1,width:"70%"},on:{"update:visible":function(t){e.editGroupBuyDialogVisible=t},opened:e.showEditGroupBy}},[a("edit-group-buy",{ref:"editGroupBuyRef",attrs:{merchants:e.merchants,"place-type":e.PlaceType},on:{close:e.editGroupBuyOpenAndClose,reload:e.getGroupBuyList}})],1)],1)},se=[],ie=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-table",{ref:"multipleTable",staticStyle:{width:"100%"},attrs:{data:e.options,stripe:"","tooltip-effect":"dark"},on:{"selection-change":e.handleSelectionChange,"sort-change":e.sortFilterFun}},[a("el-table-column",{attrs:{type:"selection",width:"55"}}),a("el-table-column",{attrs:{fixed:"",prop:"gb_id",label:"全选/ID",width:"150"}}),a("el-table-column",{attrs:{prop:"title",label:"名称",width:"300"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",{staticClass:"imgnav"},[a("el-image",{staticClass:"groupBuyImg",staticStyle:{width:"50px",height:"50px"},attrs:{src:t.row.image,fit:"fill"}}),a("span",{staticClass:"title-s"},[e._v(e._s(t.row.title))])],1)]}}])}),a("el-table-column",{attrs:{prop:"goods_detail",label:"套餐组合",width:"400"},scopedSlots:e._u([{key:"default",fn:function(t){return e._l(t.row.goods_detail,(function(t,s){return a("span",{key:s},[e._v(e._s(t.goods_name)+"，"+e._s(t.goods_num)+"，"+e._s(t.goods_price/100)+"，"+e._s(t.goods_unit)+",")])}))}}])}),a("el-table-column",{attrs:{prop:"total_price",sortable:"custom",label:"价格",width:"90"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",{staticClass:"yellow-t"},[e._v(e._s(t.row.total_price/100))])]}}])}),a("el-table-column",{attrs:{prop:"sales",sortable:"custom",label:"近30天销售",width:"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",{staticClass:"green-t"},[e._v(e._s(t.row.sales))])]}}])}),a("el-table-column",{attrs:{prop:"create_time",sortable:"custom",label:"发布时间",width:"180"}}),a("el-table-column",{attrs:{prop:"expire_time",sortable:"custom",label:"到期时间"}}),a("el-table-column",{attrs:{fixed:"right",label:"操作",width:"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"text",size:"small"},on:{click:function(a){return e.handleClick(t.row)}}},[e._v("查看/编辑")]),a("el-button",{attrs:{type:"text",size:"small"},on:{click:function(a){return e.delClick(t.row)}}},[e._v("删除")])]}}])})],1)],1)},oe=[],re=(a("a630"),a("6062"),a("3ca3"),a("ddb0"),{name:"goodsItem",props:{options:Array,merchants:Object},data:function(){return{sortVal:"",sortStatus:!1,order:"asc",multipleSelection:"",nameArr:[]}},mounted:function(){},methods:{filterTagTable:function(e){this.filterMethod(e)},filterMethod:function(e){var t=[],a=[];for(var s in e)t.push(s),a.push(e[s]);t=t.join(","),a=a.join(","),this.f_status=a,this.$emit("childFun",this.f_status,"",t,2)},sortMethod:function(e){this.sortVal=e,this.sortStatus=!this.sortStatus,this.sortStatus?this.order="asc":this.order="desc",this.$emit("childFun",this.sortVal,this.order,"",1)},sortFilterFun:function(e){this.sortMethod(e.prop)},handleSelectionChange:function(e){for(var t=[],a=0;a<e.length;a++)t.push(e[a].gb_id),this.nameArr.push(e[a].title);this.multipleSelection=t,this.nameArr=Array.from(new Set(this.nameArr)),this.$emit("childFun",this.multipleSelection,"",this.nameArr,4)},handleClick:function(e){this.$emit("edit",e,!1)},delClick:function(e){this.$emit("childFun",e.gb_id,!0,"删除-"+e.title,3)}}}),le=re,ne=Object(p["a"])(le,ie,oe,!1,null,"a9cf9234",null),ce=ne.exports,ue=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"shopSet"},[a("div",{staticClass:"formBox"},[a("el-form",{ref:"ruleForm",staticClass:"demo-ruleForm",staticStyle:{height:"500px",overflow:"auto"},attrs:{model:e.ruleForm,rules:e.rules,"label-width":"130px"}},[a("el-form-item",{attrs:{label:"套餐名称",prop:"title"}},[a("el-input",{staticClass:"gb-ipt",attrs:{placeholder:"请输入套餐名"},model:{value:e.ruleForm.title,callback:function(t){e.$set(e.ruleForm,"title",t)},expression:"ruleForm.title"}})],1),a("el-form-item",{attrs:{label:"副标题",prop:"subtitle"}},[a("el-input",{staticClass:"gb-ipt",attrs:{placeholder:"请输入套餐副标题"},model:{value:e.ruleForm.subtitle,callback:function(t){e.$set(e.ruleForm,"subtitle",t)},expression:"ruleForm.subtitle"}})],1),a("el-form-item",{attrs:{label:"套餐原价",prop:"original_price"}},[a("el-input",{staticClass:"gb-ipt",attrs:{placeholder:"请输入套餐原价"},model:{value:e.ruleForm.original_price,callback:function(t){e.$set(e.ruleForm,"original_price",t)},expression:"ruleForm.original_price"}})],1),a("el-form-item",{attrs:{label:"套餐价格",prop:"total_price"}},[a("el-input",{staticClass:"gb-ipt",attrs:{placeholder:"请输入套餐价格"},model:{value:e.ruleForm.total_price,callback:function(t){e.$set(e.ruleForm,"total_price",t)},expression:"ruleForm.total_price"}})],1),a("el-form-item",{attrs:{label:"时间段",required:""}},[a("div",{staticClass:"timeBox"},[a("el-time-picker",{attrs:{"picker-options":{selectableRange:"00:00:00 - 23:59:59"},placeholder:"任意时间点","value-format":"HH:mm"},model:{value:e.ruleForm.start_time,callback:function(t){e.$set(e.ruleForm,"start_time",t)},expression:"ruleForm.start_time"}}),a("span",{staticClass:"time-span"},[e._v("-")]),a("el-time-picker",{attrs:{"picker-options":{selectableRange:"00:00:00 - 23:59:59"},placeholder:"任意时间点","value-format":"HH:mm"},model:{value:e.ruleForm.end_time,callback:function(t){e.$set(e.ruleForm,"end_time",t)},expression:"ruleForm.end_time"}})],1)]),a("el-form-item",{attrs:{label:"使用时长",prop:"max_duration"}},[a("el-input",{staticClass:"gb-ipt",attrs:{placeholder:"请输入使用时长"},model:{value:e.ruleForm.max_duration,callback:function(t){e.$set(e.ruleForm,"max_duration",t)},expression:"ruleForm.max_duration"}}),a("span",{staticClass:"uni-span"},[e._v("小时")])],1),a("el-form-item",{attrs:{label:"包厢类型",prop:"type_id"}},[a("el-select",{attrs:{placeholder:"请选择包厢类型"},model:{value:e.ruleForm.type_id,callback:function(t){e.$set(e.ruleForm,"type_id",t)},expression:"ruleForm.type_id"}},e._l(e.placeType,(function(e,t){return a("el-option",{key:t,attrs:{label:e.name,value:e.type_id}})})),1)],1),a("el-form-item",{attrs:{label:"开放日期",prop:"week_price"}},e._l(e.ruleForm.week_price,(function(t,s){return a("div",{key:s,staticClass:"checkBoxnav"},[1==t.week?a("div",[a("el-checkbox",{attrs:{"v-model":t.checked},on:{change:function(t){return e.checkboxFun(s)}}},[e._v("周一")])],1):e._e(),2==t.week?a("div",[a("el-checkbox",{attrs:{"v-model":t.checked},on:{change:function(t){return e.checkboxFun(s)}}},[e._v("周二")])],1):e._e(),3==t.week?a("div",[a("el-checkbox",{attrs:{"v-model":t.checked},on:{change:function(t){return e.checkboxFun(s)}}},[e._v("周三")])],1):e._e(),4==t.week?a("div",[a("el-checkbox",{attrs:{"v-model":t.checked},on:{change:function(t){return e.checkboxFun(s)}}},[e._v("周四")])],1):e._e(),5==t.week?a("div",[a("el-checkbox",{attrs:{"v-model":t.checked},on:{change:function(t){return e.checkboxFun(s)}}},[e._v("周五")])],1):e._e(),6==t.week?a("div",[a("el-checkbox",{attrs:{"v-model":t.checked},on:{change:function(t){return e.checkboxFun(s)}}},[e._v("周六")])],1):e._e(),7==t.week?a("div",[a("el-checkbox",{attrs:{"v-model":t.checked},on:{change:function(t){return e.checkboxFun(s)}}},[e._v("周日")])],1):e._e(),a("div",{staticClass:"mar-num"},[a("el-input",{staticClass:"price-ipt",attrs:{placeholder:"金额"},model:{value:e.ruleForm.week_price[s].price,callback:function(t){e.$set(e.ruleForm.week_price[s],"price",t)},expression:"ruleForm.week_price[index].price"}})],1),a("span",{staticClass:"t-01"},[e._v("元")]),a("div",{staticClass:"mar-num"},[a("el-input",{staticClass:"price-ipt",attrs:{placeholder:"份数"},model:{value:e.ruleForm.week_price[s].allow_buy,callback:function(t){e.$set(e.ruleForm.week_price[s],"allow_buy",t)},expression:"ruleForm.week_price[index].allow_buy"}})],1),a("span",{staticClass:"t-01"},[e._v("份")])])})),0),a("el-form-item",{attrs:{label:"套餐组合",prop:"goods_detail"}},e._l(e.ruleForm.goods_detail,(function(t,s){return a("div",{key:s,staticClass:"groupBox"},[a("el-autocomplete",{staticClass:"inline-input",attrs:{"fetch-suggestions":e.querySearch,placeholder:"请输入商品名称","trigger-on-focus":!1},on:{select:e.handleSelect,input:function(t){return e.inputFun(s)}},model:{value:e.ruleForm.goods_detail[s].goods_name,callback:function(t){e.$set(e.ruleForm.goods_detail[s],"goods_name",t)},expression:"ruleForm.goods_detail[i].goods_name"}}),a("div",[a("el-input-number",{staticClass:"num-ipt",attrs:{"controls-position":"right",min:1},on:{change:e.handleChange},model:{value:e.ruleForm.goods_detail[s].goods_num,callback:function(t){e.$set(e.ruleForm.goods_detail[s],"goods_num",t)},expression:"ruleForm.goods_detail[i].goods_num"}})],1),a("el-input",{staticClass:"danwei-ipt",attrs:{placeholder:"单位"},model:{value:e.ruleForm.goods_detail[s].goods_unit,callback:function(t){e.$set(e.ruleForm.goods_detail[s],"goods_unit",t)},expression:"ruleForm.goods_detail[i].goods_unit"}}),a("el-input",{staticClass:"danwei-ipt",attrs:{placeholder:"金额"},model:{value:e.ruleForm.goods_detail[s].goods_price,callback:function(t){e.$set(e.ruleForm.goods_detail[s],"goods_price",t)},expression:"ruleForm.goods_detail[i].goods_price"}}),a("span",[e._v("元")]),s==e.ruleForm.goods_detail.length-1?a("i",{staticClass:"add-icon el-icon-circle-plus",on:{click:function(t){return e.addGoodsDetail(s)}}}):a("i",{staticClass:"close-icon el-icon-error",on:{click:function(t){return e.removeGoodsDetail(s)}}})],1)})),0),a("el-form-item",{attrs:{label:"套餐图片",prop:"image"}},[a("uploadFiles",{ref:"uploadImages",staticClass:"uploadTemp",attrs:{limit:e.limit,fileList:e.imageUrl,option:{boxHeigth:600,cutWidth:500,cutHeight:500,sizeChange:!1},root:"goods"},on:{upload:e.uploadTheImages}}),a("span",{staticClass:"zhushi"},[e._v("（请上传100*100的图片尺寸，不得超过2M，不得超过6张）")])],1),a("el-form-item",{attrs:{label:"购买须知",prop:"summary"}},e._l(e.ruleForm.summary,(function(t,s){return a("div",{key:s,staticClass:"groupBox"},[a("el-input",{staticClass:"n-ipt2",attrs:{placeholder:"请输入小标题"},model:{value:e.ruleForm.summary[s].item_name,callback:function(t){e.$set(e.ruleForm.summary[s],"item_name",t)},expression:"ruleForm.summary[i].item_name"}}),a("el-input",{staticClass:"danwei-ipt2",attrs:{placeholder:"请输入内容"},model:{value:e.ruleForm.summary[s].item_content,callback:function(t){e.$set(e.ruleForm.summary[s],"item_content",t)},expression:"ruleForm.summary[i].item_content"}}),s==e.ruleForm.summary.length-1?a("i",{staticClass:"add-icon el-icon-circle-plus",on:{click:function(t){return e.addSummary(s)}}}):a("i",{staticClass:"close-icon el-icon-error",on:{click:function(t){return e.removeSummary(s)}}})],1)})),0)],1),a("div",{staticClass:"btnBox"},[a("el-button",{attrs:{type:"warning"},on:{click:function(t){return e.resetForm("ruleForm")}}},[e._v("清除输入")]),a("el-button",{attrs:{type:""},on:{click:function(t){return e.$emit("close",!1)}}},[e._v("取消")]),a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitForm("ruleForm")}}},[e._v("添加")])],1)],1)])},de=[],me=(a("4de4"),{name:"addGroupBuyComponents",components:{uploadFiles:$["a"]},props:{merchants:{type:Object},placeType:{type:Array}},data:function(){return{isLoading:!1,imageUrl:[],ruleForm:{shop_id:0,merchant_id:0,title:"",subtitle:"",original_price:"",total_price:"",image:"",images:1,type_id:"",type_name:"",start_time:"",end_time:"",max_duration:"",week_price:[{week:1,price:"",allow_buy:"",checked:!1},{week:2,price:"",allow_buy:"",checked:!1},{week:3,price:"",allow_buy:"",checked:!1},{week:4,price:"",allow_buy:"",checked:!1},{week:5,price:"",allow_buy:"",checked:!1},{week:6,price:"",allow_buy:"",checked:!1},{week:7,price:"",allow_buy:"",checked:!1}],goods_detail:[{goods_name:"",goods_num:1,goods_unit:"",goods_price:""}],summary:[{item_name:"",item_content:""}]},rules:{title:[{required:!0,message:"请输入套餐名称",trigger:"blur"}],original_price:[{required:!0,message:"请输入套餐原价",trigger:"blur"}],total_price:[{required:!0,message:"请输入套餐价格",trigger:"blur"}],type_id:[{required:!0,message:"请选择包厢类型",trigger:"change"}],goods_detail:[{required:!0,type:"array",message:"请输入套餐组合信息",trigger:"blur"}],image:[{required:!0,message:"请上传套餐图片",trigger:"on-change"}],summary:[{required:!0,type:"array",message:"请填写购买须知",trigger:"blur"}],week_price:[{required:!0,message:"请选择预定星期",trigger:"change"}],start_time:[{required:!0,message:"请选择开始时间",trigger:"change"}],end_time:[{required:!0,message:"请选择结束时间",trigger:"change"}],max_duration:[{required:!0,message:"请输入使用时长",trigger:"blur"}]},limit:6,restaurants:[],options:[],checked:!1}},created:function(){},methods:{uploadTheImages:function(e){console.info(e);var t=[];for(var a in e)t.push(this.GetImageUrl(e[a]["url"]));this.ruleForm.image=t.join(",")},checkboxFun:function(e){for(var t=0;t<this.ruleForm.week_price.length;t++)t==e&&(this.ruleForm.week_price[t].checked=!this.ruleForm.week_price[t].checked)},timeFun:function(e){this.ruleForm.allow_hours=e.join("-")},querySearch:function(e,t){var a=this.restaurants;t(a)},handleSelect:function(e){},inputFun:function(e){var t=this,a={name:this.ruleForm.goods_detail[e].goods_name,merchant_id:this.merchants.merchant_id,shop_id:this.merchants.shop_id};this.$store.dispatch("goods/getGroupBuySelectGoods",a).then((function(e){var a=[];e.data.map((function(e){a.push({value:e.name})})),t.restaurants=a}))},handleChange:function(e){console.log(e)},submitForm:function(e){var t=this;this.$refs[e].validate((function(e){if(!e)return console.log("error submit!!"),!1;var a=V.a.cloneDeep(t.ruleForm);a.original_price=100*Number(a.original_price),a.total_price=100*Number(a.total_price);for(var s=0;s<a.goods_detail.length;s++)a.goods_detail[s].goods_price=100*Number(a.goods_detail[s].goods_price);for(s=0;s<a.week_price.length;s++)0==a.week_price[s].checked?delete a.week_price[s]:(delete a.week_price[s].checked,a.week_price[s].price=100*Number(a.week_price[s].price),a.week_price[s].allow_buy=Number(a.week_price[s].allow_buy));a.week_price=a.week_price.filter(Boolean);for(s=0;s<t.options.length;s++)t.options[s].type_id==a.type_id&&(a.type_name=t.options[s].name);if(a.max_duration=Number(a.max_duration),a.image.constructor==Array)a.image=a.image.join(",");else{var i=[];for(i=a.image.split(","),s=0;s<i.length;s++)i[s]=t.GetImageUrl(i[s]);a.image=i.join(",")}a.type_id=Number(a.type_id),a.merchant_id=Number(t.merchants.merchant_id),a.shop_id=Number(t.merchants.shop_id),console.info("提交的数据：",a),t.isLoading=!0,t.$store.dispatch("goods/addGroupBuy",a).then((function(e){t.isLoading=!1,t.ruleForm.title="",t.ruleForm.subtitle="",t.ruleForm.image="",t.imageUrl=[],t.$refs.uploadImages.clearAllImage(),t.$emit("reload"),t.$message({message:e.msg+" 你可以继续添加。",type:"success"})})).catch((function(e){console.error(e),t.isLoading=!1}))}))},resetForm:function(e){this.$refs[e].resetFields()},theIMG:function(e){this.ruleForm.image=e},addGoodsDetail:function(e){this.ruleForm.goods_detail.push({goods_name:"",goods_num:1,goods_unit:"",goods_price:""})},removeGoodsDetail:function(e){this.ruleForm.goods_detail.splice(e,1)},addSummary:function(e){this.ruleForm.summary.push({item_name:"",item_content:""})},removeSummary:function(e){this.ruleForm.summary.splice(e,1)}}}),pe=me,he=(a("5e49"),Object(p["a"])(pe,ue,de,!1,null,"577c454b",null)),fe=he.exports,_e=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"shopSet"},[a("div",{staticClass:"formBox"},[a("el-form",{ref:"ruleForm",staticClass:"demo-ruleForm",staticStyle:{height:"500px",overflow:"auto"},attrs:{model:e.ruleForm,rules:e.rules,"label-width":"130px"}},[a("el-form-item",{attrs:{label:"套餐名称",prop:"title"}},[a("el-input",{staticClass:"gb-ipt",attrs:{placeholder:"请输入套餐名"},model:{value:e.ruleForm.title,callback:function(t){e.$set(e.ruleForm,"title",t)},expression:"ruleForm.title"}})],1),a("el-form-item",{attrs:{label:"副标题",prop:"subtitle"}},[a("el-input",{staticClass:"gb-ipt",attrs:{placeholder:"请输入套餐副标题"},model:{value:e.ruleForm.subtitle,callback:function(t){e.$set(e.ruleForm,"subtitle",t)},expression:"ruleForm.subtitle"}})],1),a("el-form-item",{attrs:{label:"套餐原价",prop:"original_price"}},[a("el-input",{staticClass:"gb-ipt",attrs:{placeholder:"请输入套餐原价"},model:{value:e.ruleForm.original_price,callback:function(t){e.$set(e.ruleForm,"original_price",t)},expression:"ruleForm.original_price"}})],1),a("el-form-item",{attrs:{label:"套餐价格",prop:"total_price"}},[a("el-input",{staticClass:"gb-ipt",attrs:{placeholder:"请输入套餐价格"},model:{value:e.ruleForm.total_price,callback:function(t){e.$set(e.ruleForm,"total_price",t)},expression:"ruleForm.total_price"}})],1),a("el-form-item",{attrs:{label:"时间段",required:""}},[a("div",{staticClass:"timeBox"},[a("el-time-picker",{attrs:{"picker-options":{selectableRange:"00:00:00 - 23:59:59"},placeholder:"任意时间点","value-format":"HH:mm"},model:{value:e.ruleForm.start_time,callback:function(t){e.$set(e.ruleForm,"start_time",t)},expression:"ruleForm.start_time"}}),a("span",{staticClass:"time-span"},[e._v("-")]),a("el-time-picker",{attrs:{"picker-options":{selectableRange:"00:00:00 - 23:59:59"},placeholder:"任意时间点","value-format":"HH:mm"},model:{value:e.ruleForm.end_time,callback:function(t){e.$set(e.ruleForm,"end_time",t)},expression:"ruleForm.end_time"}})],1)]),a("el-form-item",{attrs:{label:"使用时长",prop:"max_duration"}},[a("el-input",{staticClass:"gb-ipt",attrs:{placeholder:"请输入使用时长"},model:{value:e.ruleForm.max_duration,callback:function(t){e.$set(e.ruleForm,"max_duration",t)},expression:"ruleForm.max_duration"}}),a("span",{staticClass:"uni-span"},[e._v("小时")])],1),a("el-form-item",{attrs:{label:"包厢类型",prop:"type_id"}},[a("el-select",{attrs:{placeholder:"请选择包厢类型"},model:{value:e.ruleForm.type_name,callback:function(t){e.$set(e.ruleForm,"type_name",t)},expression:"ruleForm.type_name"}},e._l(e.options,(function(e,t){return a("el-option",{key:t,attrs:{label:e.name,value:e.name}})})),1)],1),a("el-form-item",{attrs:{label:"开放日期",prop:"week_price"}},e._l(e.week_price,(function(t,s){return a("div",{key:s,staticClass:"checkBoxnav"},[1==t.week?a("div",[a("el-checkbox",{on:{change:function(t){return e.checkboxFun(s)}},model:{value:e.week_price[s].checked,callback:function(t){e.$set(e.week_price[s],"checked",t)},expression:"week_price[index].checked"}},[e._v("周一")])],1):e._e(),2==t.week?a("div",[a("el-checkbox",{on:{change:function(t){return e.checkboxFun(s)}},model:{value:e.week_price[s].checked,callback:function(t){e.$set(e.week_price[s],"checked",t)},expression:"week_price[index].checked"}},[e._v("周二")])],1):e._e(),3==t.week?a("div",[a("el-checkbox",{on:{change:function(t){return e.checkboxFun(s)}},model:{value:e.week_price[s].checked,callback:function(t){e.$set(e.week_price[s],"checked",t)},expression:"week_price[index].checked"}},[e._v("周三")])],1):e._e(),4==t.week?a("div",[a("el-checkbox",{on:{change:function(t){return e.checkboxFun(s)}},model:{value:e.week_price[s].checked,callback:function(t){e.$set(e.week_price[s],"checked",t)},expression:"week_price[index].checked"}},[e._v("周四")])],1):e._e(),5==t.week?a("div",[a("el-checkbox",{on:{change:function(t){return e.checkboxFun(s)}},model:{value:e.week_price[s].checked,callback:function(t){e.$set(e.week_price[s],"checked",t)},expression:"week_price[index].checked"}},[e._v("周五")])],1):e._e(),6==t.week?a("div",[a("el-checkbox",{on:{change:function(t){return e.checkboxFun(s)}},model:{value:e.week_price[s].checked,callback:function(t){e.$set(e.week_price[s],"checked",t)},expression:"week_price[index].checked"}},[e._v("周六")])],1):e._e(),7==t.week?a("div",[a("el-checkbox",{on:{change:function(t){return e.checkboxFun(s)}},model:{value:e.week_price[s].checked,callback:function(t){e.$set(e.week_price[s],"checked",t)},expression:"week_price[index].checked"}},[e._v("周日")])],1):e._e(),a("div",{staticClass:"mar-num"},[a("el-input",{staticClass:"price-ipt",attrs:{placeholder:"金额"},model:{value:e.week_price[s].price,callback:function(t){e.$set(e.week_price[s],"price",t)},expression:"week_price[index].price"}})],1),a("span",{staticClass:"t-01"},[e._v("元")]),a("div",{staticClass:"mar-num"},[a("el-input",{staticClass:"price-ipt",attrs:{placeholder:"份数"},model:{value:e.week_price[s].allow_buy,callback:function(t){e.$set(e.week_price[s],"allow_buy",t)},expression:"week_price[index].allow_buy"}})],1),a("span",{staticClass:"t-01"},[e._v("份")])])})),0),a("el-form-item",{attrs:{label:"套餐组合",prop:"goods_detail"}},e._l(e.ruleForm.goods_detail,(function(t,s){return a("div",{key:s,staticClass:"groupBox"},[a("el-autocomplete",{staticClass:"inline-input",attrs:{"fetch-suggestions":e.querySearch,placeholder:"请输入商品名称","trigger-on-focus":!1},on:{select:e.handleSelect,input:function(t){return e.inputFun(s)}},model:{value:e.ruleForm.goods_detail[s].goods_name,callback:function(t){e.$set(e.ruleForm.goods_detail[s],"goods_name",t)},expression:"ruleForm.goods_detail[i].goods_name"}}),a("div",[a("el-input-number",{staticClass:"num-ipt",attrs:{"controls-position":"right",min:1},on:{change:e.handleChange},model:{value:e.ruleForm.goods_detail[s].goods_num,callback:function(t){e.$set(e.ruleForm.goods_detail[s],"goods_num",t)},expression:"ruleForm.goods_detail[i].goods_num"}})],1),a("el-input",{staticClass:"danwei-ipt",attrs:{placeholder:"单位"},model:{value:e.ruleForm.goods_detail[s].goods_unit,callback:function(t){e.$set(e.ruleForm.goods_detail[s],"goods_unit",t)},expression:"ruleForm.goods_detail[i].goods_unit"}}),a("el-input",{staticClass:"danwei-ipt",attrs:{placeholder:"金额"},model:{value:e.ruleForm.goods_detail[s].goods_price,callback:function(t){e.$set(e.ruleForm.goods_detail[s],"goods_price",t)},expression:"ruleForm.goods_detail[i].goods_price"}}),a("span",[e._v("元")]),s==e.ruleForm.goods_detail.length-1?a("i",{staticClass:"add-icon el-icon-circle-plus",on:{click:function(t){return e.addGoodsDetail(s)}}}):a("i",{staticClass:"close-icon el-icon-error",on:{click:function(t){return e.removeGoodsDetail(s)}}})],1)})),0),a("el-form-item",{attrs:{label:"套餐图片",prop:"image"}},[a("uploadFiles",{staticClass:"uploadTemp",attrs:{limit:e.limit,fileList:e.fileList,option:{boxHeigth:600,cutWidth:500,cutHeight:500,sizeChange:!1},root:"goods"},on:{upload:e.uploadTheImages}}),a("span",{staticClass:"zhushi"},[e._v("（请上传100*100的图片尺寸，不得超过2M，不得超过6张）")])],1),a("el-form-item",{attrs:{label:"购买须知",prop:"summary"}},e._l(e.ruleForm.summary,(function(t,s){return a("div",{key:s,staticClass:"groupBox"},[a("el-input",{staticClass:"n-ipt2",attrs:{placeholder:"请输入小标题"},model:{value:e.ruleForm.summary[s].item_name,callback:function(t){e.$set(e.ruleForm.summary[s],"item_name",t)},expression:"ruleForm.summary[i].item_name"}}),a("el-input",{staticClass:"danwei-ipt2",attrs:{placeholder:"请输入内容"},model:{value:e.ruleForm.summary[s].item_content,callback:function(t){e.$set(e.ruleForm.summary[s],"item_content",t)},expression:"ruleForm.summary[i].item_content"}}),s==e.ruleForm.summary.length-1?a("i",{staticClass:"add-icon el-icon-circle-plus",on:{click:function(t){return e.addSummary(s)}}}):a("i",{staticClass:"close-icon el-icon-error",on:{click:function(t){return e.removeSummary(s)}}})],1)})),0)],1)],1),a("div",{staticClass:"btnBox"},[a("el-button",{on:{click:function(t){return e.$emit("close",!1)}}},[e._v("取消")]),a("el-button",{attrs:{type:"primary",loading:e.isLoading},on:{click:function(t){return e.handleSubmitForm("ruleForm")}}},[e._v("保存")])],1)])},ge=[],be={name:"editGroupBuyComponent",components:{uploadFiles:$["a"]},props:{merchants:{type:Object},placeType:{type:Array}},data:function(){return{isLoading:!1,logos:[],ruleForm:{shop_id:0,merchant_id:0,gb_id:"",week_price:[]},week_price:[],rules:{title:[{required:!0,message:"请输入套餐名称",trigger:"blur"}],original_price:[{required:!0,message:"请输入套餐原价",trigger:"blur"}],total_price:[{required:!0,message:"请输入套餐价格",trigger:"blur"}],type_id:[{required:!0,message:"请选择包厢类型",trigger:"change"}],goods_detail:[{type:"array",required:!0,message:"请输入套餐组合信息",trigger:"blur"}],image:[{required:!0,message:"请上传套餐图片",trigger:"on-change"}],summary:[{required:!0,message:"请填写购买须知",trigger:"blur"}],start_time:[{required:!0,message:"请选择开始时间",trigger:"change"}],end_time:[{required:!0,message:"请选择结束时间",trigger:"change"}],max_duration:[{required:!0,message:"请输入使用时长",trigger:"blur"}]},limit:6,hasImg:!1,restaurants:[],options:[],imgArr:[],fileList:[],isAddImg:!1}},created:function(){},methods:{uploadTheImages:function(e){console.info(e);var t=[];for(var a in e)t.push(e[a]["url"]);this.ruleForm.image=t.join(",")},checkboxFun:function(e){},querySearch:function(e,t){var a=this.restaurants;t(a)},handleSelect:function(e){},inputFun:function(e){var t=this,a={name:this.ruleForm.goods_detail[e].goods_name,shop_id:this.ruleForm.merchant_id,merchant_id:this.ruleForm.shop_id};this.$store.dispatch("goods/getGroupBuySelectGoods",a).then((function(e){var a=[];e.data.map((function(e){a.push({value:e.name})})),t.restaurants=a}))},getGroudbuyDetaile:function(e){var t=this;this.$store.dispatch("goods/getGroupBuyDetail",e).then((function(e){t.ruleForm=e.data;var a=t.ruleForm.image;t.imgArr=a.split(","),t.imgArr.forEach((function(e){var a=new Object;a.url=e,t.fileList.push(a)})),t.ruleForm.original_price=Number(t.ruleForm.original_price)/100,t.ruleForm.total_price=Number(t.ruleForm.total_price)/100;for(var s=0;s<t.ruleForm.goods_detail.length;s++)t.ruleForm.goods_detail[s].goods_price=Number(t.ruleForm.goods_detail[s].goods_price)/100;t.week_price=[{week:1,price:"",allow_buy:"",checked:!1},{week:2,price:"",allow_buy:"",checked:!1},{week:3,price:"",allow_buy:"",checked:!1},{week:4,price:"",allow_buy:"",checked:!1},{week:5,price:"",allow_buy:"",checked:!1},{week:6,price:"",allow_buy:"",checked:!1},{week:7,price:"",allow_buy:"",checked:!1}];var i=[],o=[],r=[];i=e.data.allow_week_days.split(","),o=e.data.allow_week_price.split(","),r=e.data.allow_week_buy.split(",");var l={};l.week=i,l.price=o,l.allow_buy=r;var n=[];for(s=0;s<l.week.length;s++)l.week[s]=Number(l.week[s]),l.price[s]=Number(l.price[s])/100,l.allow_buy[s]=Number(l.allow_buy[s]),n.push({week:1,price:"",allow_buy:"",checked:!0}),n[s].week=l.week[s],n[s].price=l.price[s],n[s].allow_buy=l.allow_buy[s];for(s=0;s<n.length;s++)for(var c=0;c<t.week_price.length;c++)n[s].week==t.week_price[c].week&&(t.week_price[c].checked=!0,t.week_price[c].price=n[s].price,t.week_price[c].allow_buy=n[s].allow_buy)}))},handleChange:function(e){this.ruleForm.sum=e},checkWeekPrice:function(e){if(!e.length)return!1;for(var t in e){var a=e[t],s=a.allow_buy>0&&a.price>0&&a.week>0;if(!s)return!1}return!0},handleSubmitForm:function(e){var t=this;this.$confirm("确认提交套餐数据吗？","提示").then((function(){t.submitForm(e)}))},submitForm:function(e){var t=this;this.$refs[e].validate((function(e){if(!e)return console.log("error submit!!"),!1;var a=V.a.cloneDeep(t.ruleForm);a.original_price=100*Number(a.original_price),a.total_price=100*Number(a.total_price);for(var s=0;s<a.goods_detail.length;s++)a.goods_detail[s].goods_price=100*Number(a.goods_detail[s].goods_price);a.week_price=[];for(s=t.week_price.length-1;s>=0;s--)t.week_price[s].checked&&(t.week_price[s].price=Number(t.week_price[s].price),t.week_price[s].allow_buy=Number(t.week_price[s].allow_buy),a.week_price.push({allow_buy:t.week_price[s].allow_buy,price:100*t.week_price[s].price,week:t.week_price[s].week}));if(t.checkWeekPrice(a.week_price)){for(s=0;s<t.options.length;s++)t.options[s].name==a.type_name&&(a.type_id=t.options[s].type_id);delete a.allow_week_buy,delete a.allow_week_days,delete a.allow_week_price,a.merchant_id=Number(t.merchants.merchant_id),a.shop_id=Number(t.merchants.shop_id),a.image.constructor==Array?a.image=a.image.join(","):a.image=t.GetImageUrl(a.image),t.isLoading=!0,t.$store.dispatch("goods/updateGroupBuy",a).then((function(e){t.isLoading=!1,t.$emit("reload"),t.$message({message:""+e.msg,type:"success"})})).catch((function(e){console.error(e),t.isLoading=!1}))}else t.$message.error("必须设置开放日期...")}))},resetForm:function(e){this.$refs[e].resetFields()},theIMG:function(e){this.ruleForm.image=e},addGoodsDetail:function(e){this.ruleForm.goods_detail.push({goods_name:"",goods_num:1,goods_unit:"",goods_price:0})},removeGoodsDetail:function(e){this.ruleForm.goods_detail.splice(e,1)},addSummary:function(e){this.ruleForm.summary.push({item_name:"",item_content:""})},removeSummary:function(e){this.ruleForm.summary.splice(e,1)}}},ve=be,ye=(a("9d09"),Object(p["a"])(ve,_e,ge,!1,null,"2d7ed84c",null)),ke=ye.exports,Fe={name:"GroupBuy",components:{groupbuyItem:ce,addGroupBuy:fe,editGroupBuy:ke},props:{enable:{type:Boolean,default:!1},merchants:{type:Object}},data:function(){return{groupByData:{},addGroupBuyDialogVisible:!1,editGroupBuyDialogVisible:!1,pageSign:0,soVal:"",options:[],multipleSelection:"",value:!0,page:1,count:0,detaileData:[],title:"",gb_id:0,rules:{class_name:[{required:!0,message:"请输入分类名称",trigger:"blur"}]},classFormAdd:{class_name:"",class_sort:"",status:1},classForm:{type_id:0,class_name:"",class_sort:"",status:!1},deldialogVisible:!1,deltitle:"",dialogVisibleAdd:!1,deldialogClass:!1,delClasstitle:"",dataFormAdd:{name:"",price:0,vip_price:0,unit:"",image:"",images:"",status:0},batchdialogVisible:!1,nameArr:[],order:"asc",sortVal:"",sortStatus:!1,PlaceType:[],type_id:0,editableTabsValue:"1",tabStatus:"0",group_status:1}},watch:{enable:{immediate:!0,handler:function(e){e&&this.reloadData()}}},created:function(){},methods:{addOpen:function(){this.PlaceType.length>0?this.addGroupBuyOpenAndClose():this.$message({message:"目前没有座位的分类信息，请先去新增座位的分类信息才能继续操作。",type:"warning",duration:0,showClose:!0})},addGroupBuyOpenAndClose:function(e){this.addGroupBuyDialogVisible=!this.addGroupBuyDialogVisible,!0===e&&this.getGroupBuyList()},showEditGroupBy:function(){var e={shop_id:this.merchants.merchant_id,merchant_id:this.merchants.shop_id,id:this.groupByData.gb_id};this.$refs["editGroupBuyRef"].getGroudbuyDetaile(e)},editGroupBuyOpenAndClose:function(e,t){this.groupByData=e,this.editGroupBuyDialogVisible=!this.editGroupBuyDialogVisible,!0===t&&this.getGroupBuyList()},reloadData:function(){var e=this;console.info("重载数据..."),this.getPlaceType((function(){e.getGroupBuyList()}))},parentFun:function(e,t,a,s){1==s?(this.sortVal=e,this.order=t,this.sortDataFun()):3==s?(this.deldialogVisible=!0,this.gb_id=e,this.deltitle=a):4==s&&(0==e.length?(this.multipleSelection="",this.nameArr=[]):(this.multipleSelection=e,this.nameArr=a))},sortDataFun:function(){var e=this;this.pageSign=2;var t={page:this.page,sort:this.sortVal,order:this.order,type_id:this.type_id,status:this.group_status,merchant_id:this.merchants.merchant_id,shop_id:this.merchants.shop_id};0==this.type_id&&delete t.type_id,this.$store.dispatch("goods/getGroupBuyList",t).then((function(t){e.options=t.data,e.count=t.count}))},handleClick:function(e){this.$router.push({path:"/goods/editGroupBuy",qeruy:{gb_id:e.gb_id,merchant_id:this.merchants.merchant_id,shop_id:this.merchants.shop_id}})},resetForm:function(e){this.$refs[e].resetFields()},delClick:function(e){this.deldialogVisible=!0,this.gb_id=e.gb_id,this.deltitle="删除-"+e.title},confirmDelFun:function(){var e=this,t=[];t.push(this.gb_id);var a={id:t,merchant_id:this.merchants.merchant_id,shop_id:this.merchants.shop_id};this.$store.dispatch("goods/deleteGroupBuy",a).then((function(t){e.$message({message:""+t.msg,type:"success"}),e.getGroupBuyList(),e.deldialogVisible=!1}))},batchDelete:function(){this.multipleSelection?this.batchdialogVisible=!0:this.$message({message:"请先勾选要删除的分类",type:"warning"})},confirmDelbatch:function(){var e=this,t={id:this.multipleSelection,merchant_id:this.merchants.merchant_id,shop_id:this.merchants.shop_id};this.$store.dispatch("goods/deleteGroupBuy",t).then((function(t){e.$message({message:""+t.msg,type:"success"}),e.getGroupBuyList(),e.batchdialogVisible=!1}))},putawayFun:function(e){var t=this,a=e;if(this.multipleSelection.length>0){var s={gb_id:this.multipleSelection,status:Number(e),merchant_id:this.merchants.merchant_id,shop_id:this.merchants.shop_id};this.api.goods.groupUpDown(s).then((function(e){var s=e.data,i=s;t.$message({message:""+i.msg,type:"success"}),1==a&&(t.tabStatus="0"),t.getGroupBuyList(),t.batchdialogVisible=!1}))}else this.$message({message:"请先勾选要操作的商品",type:"warning"})},getGroupBuyList:function(){var e=this;this.pageSign=0,this.group_status=1;var t={page:this.page,type_id:this.type_id,status:this.group_status,merchant_id:this.merchants.merchant_id,shop_id:this.merchants.shop_id};0==this.type_id&&delete t.type_id,this.$store.dispatch("goods/getGroupBuyList",t).then((function(t){e.options=t.data,e.count=t.count,e.$refs.pagination.internalCurrentPage=e.page}))},getSoldOutList:function(){var e=this;this.pageSign=3,this.group_status=0;var t={page:this.page,type_id:this.type_id,status:this.group_status,merchant_id:this.merchants.merchant_id,shop_id:this.merchants.shop_id};0==this.type_id&&delete t.type_id,this.$store.dispatch("goods/getGroupBuyList",t).then((function(t){e.options=t.data,e.count=t.count,e.$refs.pagination.internalCurrentPage=e.page}))},pageChange:function(e){this.page=e,0==this.pageSign?this.getGroupBuyList():1==this.pageSign?this.seachFun():2==this.pageSign?this.sortDataFun():3==this.pageSign&&this.getSoldOutList()},seachFun:function(){var e=this;this.pageSign=1;var t={page:this.page,title:this.soVal,type_id:this.type_id,merchant_id:this.merchants.merchant_id,shop_id:this.merchants.shop_id};0==this.type_id&&delete t.type_id,this.$store.dispatch("goods/getGroupBuyList",t).then((function(t){e.options=t.data,e.count=t.count}))},getPlaceType:function(e){var t=this,a={page_size:1e4,merchant_id:this.merchants.merchant_id,shop_id:this.merchants.shop_id};this.api.shop.getPlaceType(a).then((function(a){var s=a.data,i=s;t.PlaceType=i.data,e()}))},tabFun:function(e){this.type_id=Number(e),this.page=1,"1"==this.tabStatus?this.getSoldOutList():this.getGroupBuyList()},oneTabFun:function(e){"1"==e.index?this.getSoldOutList():this.getGroupBuyList()}}},we=Fe,xe=(a("58cb"),Object(p["a"])(we,ae,se,!1,null,"4abe2726",null)),Ce=xe.exports,De=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[e.showRuleBox?e._e():a("div",{staticClass:"shopSet"},[a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:4}},[a("el-card",[a("div",{staticClass:"goods-class-list-left",on:{click:e.addNewPlaceType}},[a("i",{staticClass:"el-icon-plus"},[e._v("新建分类")])])]),a("el-card",{attrs:{shadow:0==e.type_id?"never":"always"}},[a("div",{class:"goods-class-list-left"+(0==e.type_id?" goods-class-list-selected":""),on:{click:function(t){return e.tabFun(0)}}},[a("i",{staticClass:"el-icon-folder-opened"},[e._v("显示全部")])])]),a("draggable",{staticClass:"list-group",attrs:{options:{animation:20}},on:{change:e.draggableChangeClass},model:{value:e.placeTypeData,callback:function(t){e.placeTypeData=t},expression:"placeTypeData"}},e._l(e.placeTypeData,(function(t,s){return a("el-card",{key:"class"+s,attrs:{shadow:e.type_id==t.type_id?"never":"always"}},[a("div",{class:"goods-class-list-left"+(e.type_id==t.type_id?" goods-class-list-selected":""),on:{click:function(a){return e.tabFun(t.type_id)}}},[e._v(" "+e._s(t.name)+" ")]),1==t.status?a("span",{staticClass:"goods-class-list-right"},[a("el-button",{attrs:{type:"warning",size:"mini"},on:{click:function(a){return e.changeStatusClass(t,!1)}}},[e._v("禁用")])],1):e._e(),0==t.status?a("span",{staticClass:"goods-class-list-right"},[a("el-button",{attrs:{type:"",size:"mini"},on:{click:function(a){return e.editClass(t)}}},[e._v("编辑")]),a("el-button",{attrs:{type:"",size:"mini"},on:{click:function(a){return e.changeStatusClass(t,!0)}}},[e._v("启用")])],1):e._e()])})),1)],1),a("el-col",{attrs:{span:20}},[a("div",{staticClass:"add-box"},[e.is_delete?e._e():a("div",{staticClass:"btn-nav"},[a("el-button",{attrs:{type:"primary"},on:{click:e.handleNewPlace}},[e._v("新增座位")]),a("el-button",{attrs:{type:"primary",disabled:!e.multipleSelection.length>0},on:{click:e.handleDeletePlace}},[e._v("删除")]),a("el-button",{attrs:{type:"warning",plain:""},on:{click:function(t){return e.handleDeleteBox(!0)}}},[e._v("回收站")]),a("el-button",{attrs:{type:"warning",plain:""},on:{click:e.handleRuleBox}},[e._v("座位规则")])],1),e.is_delete?a("div",{staticClass:"btn-nav"},[a("el-button",{attrs:{type:"primary",disabled:!e.multipleSelection.length>0},on:{click:e.handleRecoveryPlace}},[e._v("还原")]),a("el-button",{attrs:{type:"warning",plain:""},on:{click:function(t){return e.handleDeleteBox(!1)}}},[e._v("返回")])],1):e._e(),a("div",{staticClass:"so-nav"},[a("el-input",{staticClass:"so-ipt",attrs:{placeholder:"请输入座位名称","suffix-icon":"el-icon-search",clearable:!0},on:{change:e.getAllPlace},model:{value:e.soVal,callback:function(t){e.soVal=t},expression:"soVal"}}),a("el-button",{staticClass:"sosuo",attrs:{type:"primary"},on:{click:e.getAllPlace}},[e._v("搜索")])],1)]),a("Place-Area",{attrs:{merchants:e.merchants},on:{selectedArea:e.selectedArea,getPlaceAreaData:e.getPlaceAreaData}}),a("Place-Item",{attrs:{merchants:e.merchants,options:e.placListData,"is-delete":e.is_delete},on:{editPlace:e.handleEditPlace,deleteFun:e.deletePlace,recoveryFun:e.recoveryPlace,sortFun:e.sortPlace}}),a("div",{staticClass:"pagebox"},[a("el-pagination",{ref:"pagination",attrs:{"hide-on-single-page":e.value,background:"",layout:"prev, pager, next",total:e.count},on:{"current-change":e.pageChange}})],1)],1)],1),a("el-dialog",{attrs:{title:0==e.placeForm.type_id?"新建座位":"编辑座位",visible:e.placePlaceDialog,"destroy-on-close":"","close-on-press-escape":!1,"close-on-click-modal":!1},on:{"update:visible":function(t){e.placePlaceDialog=t}}},[a("el-form",{ref:"placeForm",staticClass:"addType",attrs:{model:e.placeForm,"label-width":"80px",rules:e.placeRules}},[a("el-form-item",{attrs:{label:"名称",prop:"place_name"}},[a("el-input",{model:{value:e.placeForm.place_name,callback:function(t){e.$set(e.placeForm,"place_name",t)},expression:"placeForm.place_name"}})],1),a("el-form-item",{attrs:{label:"分类",prop:"type_id"}},[a("el-select",{attrs:{placeholder:"请选择"},model:{value:e.placeForm.type_id,callback:function(t){e.$set(e.placeForm,"type_id",t)},expression:"placeForm.type_id"}},e._l(e.placeTypeData,(function(e){return a("el-option",{key:e.type_id,attrs:{label:e.name,value:e.type_id}})})),1)],1),a("el-form-item",{attrs:{label:"区域",prop:"area_id"}},[a("el-select",{attrs:{placeholder:"请选择"},model:{value:e.placeForm.area_id,callback:function(t){e.$set(e.placeForm,"area_id",t)},expression:"placeForm.area_id"}},e._l(e.placeAreaData,(function(e){return a("el-option",{key:e.area_id,attrs:{label:e.area_name,value:e.area_id}})})),1)],1),a("el-form-item",{attrs:{label:"最少人数",prop:"min_people_num"}},[a("el-input",{model:{value:e.placeForm.min_people_num,callback:function(t){e.$set(e.placeForm,"min_people_num",e._n(t))},expression:"placeForm.min_people_num"}})],1),a("el-form-item",{attrs:{label:"最多人数",prop:"max_people_num"}},[a("el-input",{model:{value:e.placeForm.max_people_num,callback:function(t){e.$set(e.placeForm,"max_people_num",e._n(t))},expression:"placeForm.max_people_num"}})],1),a("el-form-item",{attrs:{label:"低消",prop:"basic_price"}},[a("el-input",{model:{value:e.placeForm.basic_price,callback:function(t){e.$set(e.placeForm,"basic_price",e._n(t))},expression:"placeForm.basic_price"}}),a("div",[e._v("注：若座位单独设置低消，一座位低消为准。")])],1),a("el-form-item",{attrs:{label:"订金",prop:"deposit"}},[a("el-input",{model:{value:e.placeForm.deposit,callback:function(t){e.$set(e.placeForm,"deposit",e._n(t))},expression:"placeForm.deposit"}}),a("div",[e._v("注：若座位单独设置订金，一座位订金为准。")])],1),a("el-form-item",{attrs:{label:"规则",prop:"rule_id"}},[a("el-select",{attrs:{placeholder:"请选择"},model:{value:e.placeForm.rule_id,callback:function(t){e.$set(e.placeForm,"rule_id",t)},expression:"placeForm.rule_id"}},e._l(e.placeRuleData,(function(e){return a("el-option",{key:e.rule_id,attrs:{label:e.name,value:e.rule_id}})})),1)],1),a("el-form-item",{attrs:{label:"排序",prop:"sort"}},[a("el-input",{model:{value:e.placeForm.place_sort,callback:function(t){e.$set(e.placeForm,"place_sort",e._n(t))},expression:"placeForm.place_sort"}})],1),a("el-form-item",{attrs:{label:"是否启用"}},[a("el-switch",{attrs:{"active-value":1,"inactive-value":0},model:{value:e.placeForm.place_status,callback:function(t){e.$set(e.placeForm,"place_status",t)},expression:"placeForm.place_status"}})],1),a("div",{staticStyle:{"text-align":"right"}},[a("el-button",{attrs:{type:""},on:{click:function(t){e.placePlaceDialog=!1}}},[e._v("取消")]),a("el-button",{attrs:{type:"primary",loading:e.isLoading},on:{click:e.submitPlace}},[e._v("保存")])],1)],1)],1),a("el-dialog",{attrs:{title:0==e.typeForm.type_id?"新建分类":"编辑分类",visible:e.placeDialog,"destroy-on-close":"","close-on-click-modal":!1},on:{"update:visible":function(t){e.placeDialog=t}}},[a("el-form",{ref:"typeForm",staticClass:"addType",attrs:{model:e.typeForm,"label-width":"80px",rules:e.typeRules}},[a("el-form-item",{attrs:{label:"类型名称",prop:"name"}},[a("el-input",{model:{value:e.typeForm.name,callback:function(t){e.$set(e.typeForm,"name",t)},expression:"typeForm.name"}})],1),a("el-form-item",{attrs:{label:"最少人数",prop:"min_people_num"}},[a("el-input",{model:{value:e.typeForm.min_people_num,callback:function(t){e.$set(e.typeForm,"min_people_num",e._n(t))},expression:"typeForm.min_people_num"}})],1),a("el-form-item",{attrs:{label:"最多人数",prop:"max_people_num"}},[a("el-input",{model:{value:e.typeForm.max_people_num,callback:function(t){e.$set(e.typeForm,"max_people_num",e._n(t))},expression:"typeForm.max_people_num"}})],1),a("el-form-item",{attrs:{label:"低消",prop:"basic_price"}},[a("el-input",{model:{value:e.typeForm.basic_price,callback:function(t){e.$set(e.typeForm,"basic_price",e._n(t))},expression:"typeForm.basic_price"}})],1),a("el-form-item",{attrs:{label:"订金",prop:"deposit"}},[a("el-input",{model:{value:e.typeForm.deposit,callback:function(t){e.$set(e.typeForm,"deposit",e._n(t))},expression:"typeForm.deposit"}})],1),a("el-form-item",{attrs:{label:"排序",prop:"sort"}},[a("el-input",{model:{value:e.typeForm.sort,callback:function(t){e.$set(e.typeForm,"sort",e._n(t))},expression:"typeForm.sort"}})],1),a("el-form-item",{attrs:{label:"是否启用"}},[a("el-switch",{attrs:{"active-value":1,"inactive-value":0},model:{value:e.typeForm.status,callback:function(t){e.$set(e.typeForm,"status",t)},expression:"typeForm.status"}})],1),a("div",{staticStyle:{"text-align":"right"}},[e.typeForm.type_id>0?a("el-button",{attrs:{type:"danger"},on:{click:e.deleteType}},[e._v("删除")]):e._e(),a("el-button",{on:{click:function(t){e.placeDialog=!1}}},[e._v("取消")]),a("el-button",{attrs:{type:"primary",loading:e.isLoading},on:{click:e.submitType}},[e._v("保存")])],1)],1)],1)],1),e.showRuleBox&&e.enable?a("placeRule",{attrs:{merchants:e.merchants},on:{handleRuleBox:e.handleRuleBox}}):e._e()],1)},$e=[],Se=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",[a("el-button",{staticStyle:{float:"left",margin:"0px 10px 10px 0px",cursor:"pointer"},on:{click:function(t){return e.handleSelectedArea("newArea")}}},[e._v("新建区域")]),a("el-button",{staticStyle:{float:"left",margin:"0px 10px 10px 0px",cursor:"pointer"},attrs:{plain:"",type:0==e.cAreaId?"info":""},on:{click:function(t){return e.handleSelectedArea(0)}}},[e._v("全部区域")]),a("draggable",{staticClass:"list-group",staticStyle:{float:"left","margin-left":"10px"},attrs:{options:{animation:20}},on:{change:e.draggableChangeClass},model:{value:e.placeAreaData,callback:function(t){e.placeAreaData=t},expression:"placeAreaData"}},e._l(e.placeAreaData,(function(t,s){return a("el-button",{key:s,staticStyle:{margin:"0px 10px 10px 0px"},attrs:{plain:"",type:t.area_id==e.cAreaId?"info":""},on:{click:function(a){return e.handleSelectedArea(t)}}},[e._v(e._s(t.area_name)+" "),e.cAreaId==t.area_id?a("i",{staticClass:"edit-icon el-icon-edit-outline",staticStyle:{color:"#e6a23c"},on:{click:function(a){return e.editArea(t)}}}):e._e()])})),1)],1),a("el-dialog",{attrs:{title:0==e.areaForm.area_id?"新建区域":"编辑区域",visible:e.areaDialog},on:{"update:visible":function(t){e.areaDialog=t},closed:function(t){e.selectedArea="0"}}},[a("el-form",{ref:"areaForm",staticClass:"addArea",attrs:{model:e.areaForm,"label-width":"80px",rules:e.areaRules}},[a("el-form-item",{attrs:{label:"区域名称",prop:"area_name"}},[a("el-input",{model:{value:e.areaForm.area_name,callback:function(t){e.$set(e.areaForm,"area_name",t)},expression:"areaForm.area_name"}})],1),a("el-form-item",{attrs:{label:"排序",prop:"sort"}},[a("el-input",{model:{value:e.areaForm.sort,callback:function(t){e.$set(e.areaForm,"sort",e._n(t))},expression:"areaForm.sort"}})],1),a("el-form-item",{attrs:{label:"是否启用"}},[a("el-switch",{attrs:{"active-value":1,"inactive-value":0},model:{value:e.areaForm.status,callback:function(t){e.$set(e.areaForm,"status",t)},expression:"areaForm.status"}})],1),a("div",{staticStyle:{"text-align":"right"}},[a("el-button",{attrs:{type:""},on:{click:function(t){e.areaDialog=!1}}},[e._v("取消")]),e.areaForm.area_id>0?a("el-button",{attrs:{type:"danger"},on:{click:e.deleteArea}},[e._v("删除")]):e._e(),a("el-button",{attrs:{type:"primary",loading:e.isLoading},on:{click:e.submitArea}},[e._v("保存")])],1)],1)],1)],1)},Le=[],Pe={name:"PlaceArea",props:{merchants:{type:Object}},data:function(){return{isLoading:!1,placeAreaData:[],selectedArea:"0",cAreaId:0,areaForm:{area_id:0,area_name:"",sort:0,status:1},areaDialog:!1,areaRules:{area_name:[{required:!0,message:"请输入分类名称",trigger:"blur"}],sort:[{required:!0,message:"必须排序",trigger:"blur"},{type:"number",message:"必须为数字值"}]}}},methods:{draggableChangeClass:function(e){var t=this,a=[];for(var s in this.placeAreaData)this.placeAreaData[s].sort=this.placeAreaData.length-1-s,a.push({area_id:this.placeAreaData[s].area_id,sort:Number(this.placeAreaData[s].sort)});var i={merchant_id:this.merchants.merchant_id,shop_id:this.merchants.shop_id,area:a};this.api.shop.placetareaSetSort(i).then((function(e){var a=e.data;a.data;t.getPlaceAreaData()}))},submitArea:function(){var e=this;this.$refs["areaForm"].validate((function(t){if(t){e.areaForm.area_id=Number(e.areaForm.area_id);var a=V.a.cloneDeep(e.areaForm);a.shop_id=Number(e.merchants.shop_id),a.merchant_id=Number(e.merchants.merchant_id),e.isLoading=!0,0==a.area_id?(delete a.type_id,e.$store.dispatch("shop/createPlaceArea",a).then((function(t){e.$message({message:t.msg,type:0==t.code?"success":"error"}),e.reloadData()}))):e.$store.dispatch("shop/updatePlaceArea",a).then((function(t){e.$message({message:t.msg,type:0==t.code?"success":"error"}),e.reloadData()}))}}))},reloadData:function(){this.isLoading=!1,this.areaDialog=!1,this.getPlaceAreaData()},editArea:function(e){this.isLoading=!1,this.areaForm=e,this.areaDialog=!0},getPlaceAreaData:function(){var e=this,t=this.merchants;this.$store.dispatch("shop/getPlaceArea",t).then((function(t){e.placeAreaData=t.data,e.$emit("getPlaceAreaData",e.placeAreaData)}))},handleSelectedArea:function(e){if("newArea"==e)this.isLoading=!1,this.areaForm={area_id:0,area_name:"",sort:0,status:1},this.areaDialog=!0;else{var t="0"==e?{area_name:"",area_id:0}:e;this.cAreaId=Number(t.area_id),this.$emit("selectedArea",t)}},getAareaLabel:function(e){var t={name:e.area_name,id:e.area_id};return JSON.stringify(t)},deleteArea:function(){var e=this;Number(this.areaForm.area_id)>0&&this.$confirm("确定要删除吗？","提示",{type:"warning"}).then((function(){var t={id:[Number(e.areaForm.area_id)],merchant_id:Number(e.merchants.merchant_id),shop_id:Number(e.merchants.shop_id)};e.$store.dispatch("shop/deletePlaceArea",t).then((function(t){e.$message({message:t.msg,type:0==t.code?"success":"error"}),e.reloadData()}))}))}},created:function(){this.getPlaceAreaData()}},Ae=Pe,Ne=(a("43fd"),Object(p["a"])(Ae,Se,Le,!1,null,"5feba541",null)),Ge=Ne.exports,Ie=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-table",{ref:"multipleTable",staticStyle:{width:"100%"},attrs:{data:e.options,stripe:"","tooltip-effect":"dark"},on:{"selection-change":e.handleSelectionChange,"sort-change":e.sortFilterFun}},[a("el-table-column",{attrs:{type:"selection",width:"55"}}),a("el-table-column",{attrs:{fixed:"",prop:"place_id",label:"全选/ID",width:"150"}}),a("el-table-column",{attrs:{prop:"place_name",label:"座位名称",width:"300",sortable:"true"}}),a("el-table-column",{attrs:{prop:"deposit",label:"预定金额",width:"200",sortable:"true"}}),a("el-table-column",{attrs:{prop:"max_people_num",label:"容纳人数"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.min_people_num)+" ~ "+e._s(t.row.max_people_num)+" ")]}}])}),a("el-table-column",{attrs:{prop:"basic_price",sortable:"custom",label:"人均消费"}}),a("el-table-column",{attrs:{fixed:"right",label:"操作",width:"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"text",size:"small"},on:{click:function(a){return e.handleClick(t.row)}}},[e._v("查看/编辑")]),e.isDelete?e._e():a("el-button",{attrs:{type:"text",size:"small"},on:{click:function(a){return e.delClick(t.row)}}},[e._v("删除")]),e.isDelete?a("el-button",{attrs:{type:"text",size:"small"},on:{click:function(a){return e.recoveryClick(t.row)}}},[e._v("还原")]):e._e()]}}])})],1)],1)},Ve=[],Te={name:"placeItem",props:{options:Array,merchants:Object,isDelete:Boolean},data:function(){return{sortVal:"",sortStatus:!1,order:"asc",multipleSelection:"",nameArr:[]}},mounted:function(){},methods:{filterTagTable:function(e){this.filterMethod(e)},filterMethod:function(e){var t=[],a=[];for(var s in e)t.push(s),a.push(e[s]);t=t.join(","),a=a.join(","),this.f_status=a,this.$emit("childFun",this.f_status,"",t,2)},sortFilterFun:function(e){console.info(e),this.$emit("sortFun",e)},handleSelectionChange:function(e){var t=this;this.multipleSelection=[],this.nameArr=[],e.forEach((function(e,a){t.multipleSelection.push(e.place_id),t.nameArr.push(e.name)})),this.$emit("deleteFun",{list:this.multipleSelection,isDelete:!1})},handleClick:function(e){this.$emit("editPlace",e)},delClick:function(e){this.$emit("deleteFun",{list:[e.place_id],isDelete:!0})},recoveryClick:function(e){this.$emit("recoveryFun",{list:[e.place_id],isRecovery:!0})}}},qe=Te,Oe=Object(p["a"])(qe,Ie,Ve,!1,null,"7b4e309c",null),Be=Oe.exports,je=a("2c32"),Ue={name:"PlaceMain",components:{PlaceArea:Ge,PlaceItem:Be,placeRule:je["a"]},data:function(){return{isLoading:!1,placeDialog:!1,placePlaceDialog:!1,showRuleBox:!1,soVal:"",options:[],multipleSelection:[],value:!0,page:1,count:0,detaileData:[],title:"",gb_id:0,placeFormType:"",placeFormArea:"",placeFormRule:"",placeAreaData:[],is_delete:!1,sortableList:{ascending:"asc",descending:"desc",asc:"ascending",desc:"descending"},order:"",sort:"",typeRules:{name:[{required:!0,message:"请输入分类名称",trigger:"blur"}],min_people_num:[{required:!0,message:"请输入最少人数",trigger:"blur"},{type:"number",message:"必须为数字值"}],max_people_num:[{required:!0,message:"请输入最大人数",trigger:"blur"},{type:"number",message:"必须为数字值"}],basic_price:[{required:!0,message:"必须设置抵消数",trigger:"blur"},{type:"number",message:"必须为数字值"}],deposit:[{required:!0,message:"必须设置订金数",trigger:"blur"},{type:"number",message:"必须为数字值"}],sort:[{required:!0,message:"必须排序",trigger:"blur"},{type:"number",message:"必须为数字值"}]},placeRules:{place_name:[{required:!0,message:"请输入名称",trigger:"blur"}],type_id:[{required:!0,message:"请选择分类",trigger:"blur"}],area_id:[{required:!0,message:"请选择区域",trigger:"blur"}],min_people_num:[{required:!0,message:"请输入最少人数",trigger:"blur"},{type:"number",message:"必须为数字值"}],max_people_num:[{required:!0,message:"请输入最大人数",trigger:"blur"},{type:"number",message:"必须为数字值"}],basic_price:[{required:!0,message:"必须设置抵消数",trigger:"blur"},{type:"number",message:"必须为数字值"}],deposit:[{required:!0,message:"必须设置订金数",trigger:"blur"},{type:"number",message:"必须为数字值"}]},placeRuleData:[],placeForm:Object(o["a"])({place_id:0,merchant_id:0,shop_id:0,type_id:null,area_id:null,place_name:"",place_desc:"",min_people_num:null,max_people_num:null,basic_price:null,deposit:null,rule_id:null,place_sort:0,place_status:1},"place_desc",""),placListData:[Object(o["a"])({place_id:0,merchant_id:0,shop_id:0,type_id:0,type_name:"",area_id:0,area_name:"",place_name:"",place_desc:"",min_people_num:0,max_people_num:0,basic_price:0,deposit:0,rule_id:0,rule_name:"",place_sort:0,place_status:0},"place_desc","")],placeTypeData:[{type_id:"",name:"",sort:0,min_people_num:"",max_people_num:"",basic_price:"",deposit:""}],type_id:0,area_id:"",editableTabsValue:"0",tabStatus:"0",typeForm:{type_id:0,name:"",ename:"",min_people_num:"",max_people_num:"",basic_price:"",deposit:"",sort:0,status:1}}},props:{merchants:Object,enable:{type:Boolean,default:!1}},methods:{draggableChangeClass:function(e){var t=this,a=[];for(var s in this.placeTypeData)this.placeTypeData[s].sort=this.placeTypeData.length-1-s,a.push({type_id:this.placeTypeData[s].type_id,sort:Number(this.placeTypeData[s].sort)});var i={merchant_id:this.merchants.merchant_id,shop_id:this.merchants.shop_id,place_type:a};this.api.shop.placetypeSetSort(i).then((function(e){var a=e.data;a.data;t.getPlaceType()}))},handleNewPlace:function(){this.placeForm=Object(o["a"])({place_id:0,merchant_id:0,shop_id:0,type_id:null,area_id:null,place_name:"",place_desc:"",min_people_num:null,max_people_num:null,basic_price:null,deposit:null,rule_id:null,place_sort:0,place_status:1},"place_desc",""),this.isLoading=!1,this.placePlaceDialog=!0},handleEditPlace:function(e){console.info(e),this.placeForm=e,this.placeForm.type_id=String(e.type_id),this.isLoading=!1,this.placePlaceDialog=!0},handleRuleBox:function(){this.showRuleBox=!this.showRuleBox},changePlaceType:function(e){this.placeFormType=e},changePlaceArea:function(e){this.placeFormArea=e},changePlaceRule:function(e){this.placeFormRule=e},editClass:function(e){this.isLoading=!1,this.typeForm=Object.assign({},e),delete this.typeForm.icon,delete this.typeForm.place_count,this.typeForm.basic_price=this.CalculateData(this.typeForm.basic_price,"/"),this.typeForm.deposit=this.CalculateData(this.typeForm.deposit,"/"),console.info(this.typeForm),this.placeDialog=!0},selectedArea:function(e){this.area_id=Number(e.area_id),this.getAllPlace()},tabFun:function(e){this.page=1,this.type_id=Number(e),this.getAllPlace()},addNewPlaceType:function(){this.typeForm={type_id:0,name:"",ename:"",min_people_num:"",max_people_num:"",basic_price:"",deposit:"",sort:0,status:1},this.placeDialog=!0},getAllPlace:function(){var e=this,t={page:this.page,type_id:this.type_id,merchant_id:this.merchants.merchant_id,shop_id:this.merchants.shop_id,area_id:this.area_id,sort:this.sort,order:this.order,place_name:this.soVal};0==Number(this.type_id)&&delete t.type_id,0==Number(this.area_id)&&delete t.area_id,this.is_delete?t.is_delete=1:delete t.is_delete,this.api.shop.placeList(t).then((function(t){var a=t.data,s=a;if(e.placListData=s.data,e.count=s.count,e.$refs.pagination.internalCurrentPage=e.page,e.placListData)for(var i=0;i<e.placListData.length;i++)e.placListData[i].basic_price=e.CalculateData(e.placListData[i].basic_price,"/"),e.placListData[i].deposit=e.CalculateData(e.placListData[i].deposit,"/")}))},getPlaceType:function(e){var t=this,a={page_size:1e4,merchant_id:this.merchants.merchant_id,shop_id:this.merchants.shop_id};this.api.shop.getPlaceType(a).then((function(a){var s=a.data,i=s;t.placeTypeData=i.data,e&&e()}))},submitPlace:function(){var e=this;this.$refs["placeForm"].validate((function(t){if(t){var a=V.a.cloneDeep(e.placeForm);delete a.operator_id,delete a.type_name,delete a.area_name,delete a.rule_name,a.type_id=Number(e.placeForm.type_id),a.min_people_num=Number(a.min_people_num),a.max_people_num=Number(a.max_people_num),a.basic_price=e.CalculateData(a.basic_price,"*"),a.deposit=e.CalculateData(a.deposit,"*"),a.merchant_id=Number(e.merchants.merchant_id),a.shop_id=Number(e.merchants.shop_id),console.info(a),e.isLoading=!0,0==a.place_id?(delete a.place_id,e.$store.dispatch("shop/addPlaceList",a).then((function(t){e.isLoading=!1,e.$message({message:t.msg,type:0==t.code?"success":"error"}),e.reloadData()})).catch((function(t){console.error(t),e.isLoading=!1}))):e.$store.dispatch("shop/updatPlaceList",a).then((function(t){e.isLoading=!1,e.$message({message:t.msg,type:0==t.code?"success":"error"}),e.reloadData()})).catch((function(t){console.error(t),e.isLoading=!1}))}}))},changeStatusClass:function(e,t){var a=this,s={shop_id:Number(this.merchants.shop_id),merchant_id:Number(this.merchants.merchant_id),type_id:this.type_id,status:t?1:0};this.isLoading=!0,this.$store.dispatch("shop/updatePlaceType",s).then((function(e){a.$message({message:e.msg,type:0==e.code?"success":"error"}),a.reloadData()})).catch((function(e){a.isLoading=!1}))},submitType:function(){var e=this;this.$refs["typeForm"].validate((function(t){if(t){e.typeForm.type_id=Number(e.typeForm.type_id);var a=V.a.cloneDeep(e.typeForm);a.basic_price=e.CalculateData(a.basic_price,"*"),a.deposit=e.CalculateData(a.deposit,"*"),a.shop_id=Number(e.merchants.shop_id),a.merchant_id=Number(e.merchants.merchant_id),e.isLoading=!0,0==a.type_id?(delete a.type_id,e.$store.dispatch("shop/createPlaceType",a).then((function(t){e.$message({message:t.msg,type:0==t.code?"success":"error"}),e.reloadData()})).catch((function(t){console.error(t),e.isLoading=!1}))):e.$store.dispatch("shop/updatePlaceType",a).then((function(t){e.$message({message:t.msg,type:0==t.code?"success":"error"}),e.reloadData()})).catch((function(t){console.error(t),e.isLoading=!1}))}}))},deleteType:function(){var e=this;Number(this.typeForm.type_id)>0&&this.$confirm("确定要删除吗？","提示",{type:"warning"}).then((function(){var t={id:[Number(e.typeForm.type_id)],merchant_id:Number(e.merchants.merchant_id),shop_id:Number(e.merchants.shop_id)};e.$store.dispatch("shop/deletePlaceType",t).then((function(t){e.$message({message:t.msg,type:0==t.code?"success":"error"}),e.reloadData()}))}))},getAllRule:function(){var e=this,t={page_size:1e6,merchant_id:Number(this.merchants.merchant_id),shop_id:Number(this.merchants.shop_id),status:1};this.$store.dispatch("shop/getPlaceRule",t).then((function(t){e.placeRuleData=t.data}))},pageChange:function(e){this.page=e,this.getAllPlace()},reloadRule:function(){this.getAllRule()},reloadData:function(){var e=this;this.isLoading=!1,this.placeDialog=!1,this.placePlaceDialog=!1,this.getPlaceType((function(){e.getAllPlace(),e.getAllRule()}))},getPlaceAreaData:function(e){this.placeAreaData=e},handleDeleteBox:function(e){this.is_delete=e,this.reloadData()},deletePlace:function(e){this.multipleSelection=e.list,e.isDelete&&this.handleDeletePlace()},handleDeletePlace:function(){var e=this;this.multipleSelection.length>0&&this.$confirm("确定删除吗？","提示").then((function(){var t={id:e.multipleSelection,merchant_id:Number(e.merchants.merchant_id),shop_id:Number(e.merchants.shop_id)};e.$store.dispatch("shop/deletePlaceList",t).then((function(t){e.multipleSelection=[],e.getAllPlace()}))}))},recoveryPlace:function(e){this.multipleSelection=e.list,e.isRecovery&&this.handleRecoveryPlace()},handleRecoveryPlace:function(){var e=this;this.multipleSelection.length>0&&this.$confirm("确定还原吗？","提示").then((function(){var t={id:e.multipleSelection,merchant_id:Number(e.merchants.merchant_id),shop_id:Number(e.merchants.shop_id)};e.$store.dispatch("shop/recoveryPlaceList",t).then((function(t){e.multipleSelection=[],e.getAllPlace()}))}))},sortPlace:function(e){this.sort=e.order?e.prop:"",this.order=e.order?this.sortableList[e.order]:"",this.page=1,this.getAllPlace()}},watch:{enable:{immediate:!0,handler:function(e){e&&this.reloadData()}}},created:function(){}},Re=Ue,ze=(a("4689"),Object(p["a"])(Re,De,$e,!1,null,"256fd233",null)),Me=ze.exports,Ee=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[e.showRoleBox?e._e():a("div",{staticClass:"shopSet"},[a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:4}},[a("el-card",[a("div",{staticClass:"goods-class-list-left",on:{click:e.addNewDept}},[a("i",{staticClass:"el-icon-plus"},[e._v("新建部门")])])]),a("el-card",{attrs:{shadow:0==e.dept_id?"never":"always"}},[a("div",{class:"goods-class-list-left"+(0==e.dept_id?" goods-class-list-selected":""),on:{click:function(t){return e.tabFun(0)}}},[a("i",{staticClass:"el-icon-folder-opened"},[e._v("显示全部")])])]),a("draggable",{staticClass:"list-group",attrs:{options:{animation:20}},on:{change:e.draggableChangeClass},model:{value:e.deptListData,callback:function(t){e.deptListData=t},expression:"deptListData"}},e._l(e.deptListData,(function(t,s){return a("el-card",{key:"class"+s,attrs:{shadow:e.dept_id==t.dept_id?"never":"always"}},[a("div",{class:"goods-class-list-left"+(e.dept_id==t.dept_id?" goods-class-list-selected":""),on:{click:function(a){return e.tabFun(t.dept_id)}}},[e._v(" "+e._s(t.dept_name)+" ")]),1==t.dept_status?a("span",{staticClass:"goods-class-list-right"},[a("el-button",{attrs:{type:"warning",size:"mini"},on:{click:function(a){return e.changeStatusClass(t,!1)}}},[e._v("禁用")])],1):e._e(),0==t.dept_status?a("span",{staticClass:"goods-class-list-right"},[a("el-button",{attrs:{type:"",size:"mini"},on:{click:function(a){return e.editClass(t)}}},[e._v("编辑")]),a("el-button",{attrs:{type:"",size:"mini"},on:{click:function(a){return e.changeStatusClass(t,!0)}}},[e._v("启用")])],1):e._e()])})),1)],1),a("el-col",{attrs:{span:20}},[a("div",{staticClass:"add-box"},[e.is_delete?e._e():a("div",{staticClass:"btn-nav"},[a("el-button",{attrs:{type:"primary"},on:{click:e.handleNewStaff}},[e._v("新增员工")]),a("el-button",{attrs:{type:"primary",disabled:!e.multipleSelection.length>0},on:{click:e.handleDeleteStaff}},[e._v("删除")]),a("el-button",{attrs:{type:"warning",plain:""},on:{click:function(t){return e.handleDeleteBox(!0)}}},[e._v("回收站")]),a("el-button",{attrs:{type:"warning",plain:""},on:{click:e.handleRoleBox}},[e._v("角色权限")])],1),e.is_delete?a("div",{staticClass:"btn-nav"},[a("el-button",{attrs:{type:"primary",disabled:!e.multipleSelection.length>0},on:{click:e.handleRecoveryStaff}},[e._v("还原")]),a("el-button",{attrs:{type:"warning",plain:""},on:{click:function(t){return e.handleDeleteBox(!1)}}},[e._v("返回")])],1):e._e(),a("div",{staticClass:"so-nav"},[a("el-input",{staticClass:"so-ipt",attrs:{placeholder:"请输入员工名称","suffix-icon":"el-icon-search"},on:{change:function(t){return e.getAllStaff(0)}},model:{value:e.soVal,callback:function(t){e.soVal=t},expression:"soVal"}}),a("el-button",{staticClass:"sosuo",attrs:{type:"primary"},on:{click:function(t){return e.getAllStaff(0)}}},[e._v("搜索")])],1)]),a("staff-item",{attrs:{options:e.staffListData,merchants:e.merchants,"is-delete":e.is_delete},on:{editStaff:e.handleEditStaff,deleteFun:e.deleteStaff,recoveryFun:e.recoveryStaff,sortFun:e.sortStaff}}),a("div",{staticClass:"pagebox"},[a("el-pagination",{ref:"pagination",attrs:{"hide-on-single-page":e.value,background:"",layout:"prev, pager, next",total:e.count},on:{"current-change":e.pageChange}})],1)],1)],1),a("el-dialog",{attrs:{title:0==e.staffForm.staff_id?"新建员工":"编辑员工",visible:e.staffDialog},on:{"update:visible":function(t){e.staffDialog=t}}},[a("el-form",{ref:"staffForm",staticClass:"addType",attrs:{model:e.staffForm,"label-width":"80px",rules:e.staffRules}},[a("el-form-item",{attrs:{label:"姓名",prop:"staff_name"}},[a("el-input",{model:{value:e.staffForm.staff_name,callback:function(t){e.$set(e.staffForm,"staff_name",t)},expression:"staffForm.staff_name"}})],1),a("el-form-item",{attrs:{label:"手机",prop:"staff_phone"}},[a("el-input",{model:{value:e.staffForm.staff_phone,callback:function(t){e.$set(e.staffForm,"staff_phone",t)},expression:"staffForm.staff_phone"}})],1),a("el-form-item",{attrs:{label:"工号",prop:"staff_account"}},[a("el-input",{attrs:{placeholder:"请输入内容"},model:{value:e.staffForm.staff_account,callback:function(t){e.$set(e.staffForm,"staff_account",t)},expression:"staffForm.staff_account"}},[a("template",{slot:"prepend"},[e._v("YD")])],2)],1),a("el-form-item",{attrs:{label:"密码",prop:"staff_password"}},[a("el-input",{model:{value:e.staffForm.staff_password,callback:function(t){e.$set(e.staffForm,"staff_password",t)},expression:"staffForm.staff_password"}})],1),a("el-form-item",{attrs:{label:"部门",prop:"dept_id"}},[a("el-select",{attrs:{placeholder:"请选择"},model:{value:e.staffForm.dept_id,callback:function(t){e.$set(e.staffForm,"dept_id",t)},expression:"staffForm.dept_id"}},e._l(e.deptListData,(function(e){return a("el-option",{key:e.dept_id,attrs:{label:e.dept_name,value:e.dept_id}})})),1)],1),a("el-form-item",{attrs:{label:"角色",prop:"role_id"}},[a("el-select",{attrs:{placeholder:"请选择"},model:{value:e.staffForm.role_id,callback:function(t){e.$set(e.staffForm,"role_id",t)},expression:"staffForm.role_id"}},e._l(e.roleListData,(function(e){return a("el-option",{key:e.role_id,attrs:{label:e.name,value:e.id}})})),1)],1),a("el-form-item",{attrs:{label:"提成",prop:"staff_commission"}},[a("el-input",{model:{value:e.staffForm.staff_commission,callback:function(t){e.$set(e.staffForm,"staff_commission",e._n(t))},expression:"staffForm.staff_commission"}},[a("template",{slot:"append"},[e._v("%")])],2)],1),a("el-form-item",{attrs:{label:"赠送金额",prop:"staff_gift_amount"}},[a("el-input",{model:{value:e.staffForm.staff_gift_amount,callback:function(t){e.$set(e.staffForm,"staff_gift_amount",e._n(t))},expression:"staffForm.staff_gift_amount"}}),a("div",[e._v("注：每月自动重置。")])],1),a("el-form-item",{attrs:{label:"是否启用"}},[a("el-switch",{attrs:{"active-value":1,"inactive-value":0},model:{value:e.staffForm.staff_status,callback:function(t){e.$set(e.staffForm,"staff_status",t)},expression:"staffForm.staff_status"}})],1),a("div",{staticStyle:{"text-align":"right"}},[a("el-button",{attrs:{type:""},on:{click:function(t){e.staffDialog=!1}}},[e._v("取消")]),a("el-button",{attrs:{type:"primary",loading:e.isLoading},on:{click:e.submitStaff}},[e._v("保存")])],1)],1)],1),a("el-dialog",{attrs:{title:0==e.deptForm.dept_id?"新建部门":"编辑部门",visible:e.deptDialog},on:{"update:visible":function(t){e.deptDialog=t}}},[a("el-form",{ref:"deptForm",staticClass:"addType",attrs:{model:e.deptForm,"label-width":"80px",rules:e.deptRules}},[a("el-form-item",{attrs:{label:"部门名称",prop:"dept_name"}},[a("el-input",{model:{value:e.deptForm.dept_name,callback:function(t){e.$set(e.deptForm,"dept_name",t)},expression:"deptForm.dept_name"}})],1),a("el-form-item",{attrs:{label:"是否启用"}},[a("el-switch",{attrs:{"active-value":1,"inactive-value":0},model:{value:e.deptForm.dept_status,callback:function(t){e.$set(e.deptForm,"dept_status",t)},expression:"deptForm.dept_status"}})],1),a("div",{staticStyle:{"text-align":"right"}},[a("el-button",{attrs:{type:""},on:{click:function(t){e.deptDialog=!1}}},[e._v("取消")]),e.deptForm.dept_id>0?a("el-button",{attrs:{type:"danger"},on:{click:e.deleteDept}},[e._v("删除")]):e._e(),a("el-button",{attrs:{type:"primary",loading:e.isLoading},on:{click:e.submitDept}},[e._v("提交")])],1)],1)],1)],1),e.showRoleBox&&e.enable?a("staff-role",{attrs:{merchants:e.merchants},on:{handleRoleBox:e.handleRoleBox}}):e._e()],1)},He=[],We=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-table",{ref:"multipleTable",staticStyle:{width:"100%"},attrs:{data:e.options,stripe:"","tooltip-effect":"dark"},on:{"selection-change":e.handleSelectionChange,"sort-change":e.sortFilterFun}},[a("el-table-column",{attrs:{type:"selection",width:"55"}}),a("el-table-column",{attrs:{fixed:"",prop:"staff_id",label:"全选/ID",width:"80"}}),a("el-table-column",{attrs:{prop:"staff_name",label:"员工名称",sortable:"true"}}),a("el-table-column",{attrs:{prop:"staff_account",label:"工号",sortable:"true"}}),a("el-table-column",{attrs:{prop:"role_id",label:"角色"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.role_name)+" ")]}}])}),a("el-table-column",{attrs:{prop:"staff_gift_balance",label:"剩余赠送额度"}}),a("el-table-column",{attrs:{prop:"staff_gift_amount",label:"赠送额度"}}),a("el-table-column",{attrs:{prop:"staff_commission",label:"提成"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.staff_commission)+" %")]}}])}),a("el-table-column",{attrs:{prop:"staff_create_time",sortable:"custom",label:"加入时间"}}),a("el-table-column",{attrs:{fixed:"right",label:"操作",width:"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"text",size:"small"},on:{click:function(a){return e.handleClick(t.row)}}},[e._v("查看/编辑")]),e.isDelete?e._e():a("el-button",{attrs:{type:"text",size:"small"},on:{click:function(a){return e.delClick(t.row)}}},[e._v("删除")]),e.isDelete?a("el-button",{attrs:{type:"text",size:"small"},on:{click:function(a){return e.recoveryClick(t.row)}}},[e._v("还原")]):e._e()]}}])})],1)],1)},Je=[],Ke={name:"staffItem",props:{options:Array,merchants:Object,isDelete:Boolean},data:function(){return{sortVal:"",sortStatus:!1,order:"asc",multipleSelection:"",nameArr:[]}},mounted:function(){},methods:{filterTagTable:function(e){this.filterMethod(e)},filterMethod:function(e){var t=[],a=[];for(var s in e)t.push(s),a.push(e[s]);t=t.join(","),a=a.join(","),this.f_status=a,this.$emit("childFun",this.f_status,"",t,2)},sortFilterFun:function(e){console.info(e),this.$emit("sortFun",e)},handleSelectionChange:function(e){var t=this;this.multipleSelection=[],this.nameArr=[],e.forEach((function(e,a){t.multipleSelection.push(e.staff_id),t.nameArr.push(e.name)})),this.$emit("deleteFun",{list:this.multipleSelection,isDelete:!1})},handleClick:function(e){this.$emit("editStaff",e)},delClick:function(e){this.$emit("deleteFun",{list:[e.staff_id],isDelete:!0})},recoveryClick:function(e){this.$emit("recoveryFun",{list:[e.staff_id],isRecovery:!0})}}},Qe=Ke,Ye=Object(p["a"])(Qe,We,Je,!1,null,"21892cac",null),Xe=Ye.exports,Ze=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"shopSet"},[a("div",{staticClass:"add-box"},[a("div",{staticClass:"btn-nav"},[a("el-button",{attrs:{type:"warning",plain:""},on:{click:e.handleRoleBox}},[e._v("返回")]),a("el-button",{attrs:{type:"danger"},on:{click:e.batchDelete}},[e._v("删除")]),a("el-button",{attrs:{type:"primary"},on:{click:e.insertItemtk}},[e._v("新增")]),a("el-select",{staticStyle:{"margin-right":"10px"},attrs:{placeholder:"请选择状态"},model:{value:e.status,callback:function(t){e.status=t},expression:"status"}},[a("el-option",{key:"0",attrs:{label:"停用",value:"0"}}),a("el-option",{key:"1",attrs:{label:"启用",value:"1"}})],1),a("el-button",{attrs:{type:"primary"},on:{click:e.screening}},[e._v("筛选")]),a("el-button",{attrs:{type:"info"},on:{click:e.resetData}},[e._v("重置")])],1),a("div",{staticClass:"so-nav"},[a("el-input",{staticClass:"searchInput",attrs:{placeholder:"请输入要搜索的内容","prefix-icon":"el-icon-search"},on:{change:e.searchDatas},model:{value:e.searchValue,callback:function(t){e.searchValue=t},expression:"searchValue"}}),a("el-button",{staticClass:"sosuo",attrs:{type:"primary"}},[e._v("搜索")])],1)]),a("el-table",{ref:"multipNum",staticStyle:{width:"100%"},attrs:{stripe:"",data:e.tableListData,"tooltip-effect":"dark"},on:{"selection-change":e.selectItem}},[a("el-table-column",{attrs:{type:"selection",width:"55"}}),a("el-table-column",{attrs:{label:"全选/角色ID",width:"120"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row.id))])]}}])}),a("el-table-column",{attrs:{prop:"name",label:"角色名称",width:"150"}}),a("el-table-column",{attrs:{prop:"commission",label:"提成",width:"150"}}),a("el-table-column",{attrs:{prop:"gift_amount",label:"赠送额度",width:"150"}}),a("el-table-column",{attrs:{label:"员工状态",width:"120"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",{directives:[{name:"show",rawName:"v-show",value:0==t.row.status,expression:"scope.row.status == 0"}]},[e._v("停用")]),a("span",{directives:[{name:"show",rawName:"v-show",value:1==t.row.status,expression:"scope.row.status == 1"}]},[e._v("正常")])]}}])}),a("el-table-column",{attrs:{align:"right",label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{size:"mini"},on:{click:function(a){e.openUpdateDialog(t.$index,JSON.parse(JSON.stringify(t.row)),"edit")}}},[e._v("修改")]),a("el-button",{attrs:{size:"mini"},on:{click:function(a){e.openUpdateDialog(t.$index,JSON.parse(JSON.stringify(t.row)),"role")}}},[e._v("权限")]),a("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(a){return e.openDelDialog(t.row)}}},[e._v("删除")])]}}])})],1),a("div",{staticClass:"pagination"},[a("el-pagination",{attrs:{"current-page":e.curPage,"hide-on-single-page":!0,background:"",layout:"prev, pager, next",total:e.total},on:{"current-change":e.pageChange}})],1),a("el-dialog",{attrs:{title:"新增",visible:e.insertDialog},on:{"update:visible":function(t){e.insertDialog=t}}},[a("el-form",{ref:"formName",staticClass:"updateArea",attrs:{model:e.addItem,"label-width":"80px"}},[a("el-form-item",{attrs:{label:"角色名称",prop:"name"}},[a("el-input",{model:{value:e.addItem.name,callback:function(t){e.$set(e.addItem,"name",t)},expression:"addItem.name"}})],1),a("el-form-item",{attrs:{label:"提成",prop:"commission"}},[a("el-input",{model:{value:e.addItem.commission,callback:function(t){e.$set(e.addItem,"commission",t)},expression:"addItem.commission"}}),e._v("(0至99) ")],1),a("el-form-item",{attrs:{label:"赠送额度",prop:"gift_amount"}},[a("el-input",{model:{value:e.addItem.gift_amount,callback:function(t){e.$set(e.addItem,"gift_amount",t)},expression:"addItem.gift_amount"}})],1),a("el-form-item",{attrs:{label:"状态",prop:"status"}},[a("el-switch",{attrs:{"active-color":"#13ce66"},model:{value:e.status_ui,callback:function(t){e.status_ui=t},expression:"status_ui"}})],1),a("el-form-item",{attrs:{label:"是否锁定",prop:"lock"}},[a("el-switch",{attrs:{"active-color":"#13ce66"},model:{value:e.lock_ui,callback:function(t){e.lock_ui=t},expression:"lock_ui"}})],1),a("el-form-item",{attrs:{label:"权限设置"}},[a("el-tree",{ref:"tree",attrs:{data:e.menuData,"show-checkbox":"","node-key":"id","default-expand-all":!0,props:e.defaultProps}})],1)],1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.insertDialog=!1}}},[e._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:e.insertItem}},[e._v("确定")])],1)],1),a("el-dialog",{attrs:{title:"修改",visible:e.updateDialog},on:{"update:visible":function(t){e.updateDialog=t}}},[a("el-form",{ref:"updateArea",staticClass:"updateArea",attrs:{"label-width":"80px"}},[a("el-form-item",{attrs:{label:"角色名称"}},[a("el-input",{directives:[{name:"show",rawName:"v-show",value:"edit"==e.curOpenType,expression:"curOpenType == 'edit'"}],model:{value:e.currenItem.name,callback:function(t){e.$set(e.currenItem,"name",t)},expression:"currenItem.name"}}),a("span",{directives:[{name:"show",rawName:"v-show",value:"role"==e.curOpenType,expression:"curOpenType == 'role'"}]},[e._v(e._s(e.currenItem.name))])],1),a("div",{directives:[{name:"show",rawName:"v-show",value:"edit"==e.curOpenType,expression:"curOpenType == 'edit'"}]},[a("el-form-item",{attrs:{label:"提成"}},[a("el-input",{model:{value:e.currenItem.commission,callback:function(t){e.$set(e.currenItem,"commission",t)},expression:"currenItem.commission"}}),e._v("(0至99) ")],1),a("el-form-item",{attrs:{label:"赠送额度"}},[a("el-input",{model:{value:e.currenItem.gift_amount,callback:function(t){e.$set(e.currenItem,"gift_amount",t)},expression:"currenItem.gift_amount"}})],1),a("el-form-item",{attrs:{label:"状态"}},[a("el-switch",{attrs:{"active-color":"#13ce66"},model:{value:e.status_ui,callback:function(t){e.status_ui=t},expression:"status_ui"}})],1),a("el-form-item",{attrs:{label:"是否锁定"}},[a("el-switch",{attrs:{"active-color":"#13ce66"},model:{value:e.lock_ui,callback:function(t){e.lock_ui=t},expression:"lock_ui"}})],1)],1),a("div",{directives:[{name:"show",rawName:"v-show",value:"role"==e.curOpenType,expression:"curOpenType == 'role'"}]},[a("el-form-item",{attrs:{label:"权限设置"}},[a("el-tree",{ref:"tree",attrs:{data:e.menuData,"show-checkbox":"","node-key":"id","default-expand-all":!0,props:e.defaultProps,"default-checked-keys":e.updateQ}})],1)],1)],1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.updateDialog=!1}}},[e._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:e.multiUpdate}},[e._v("确定")])],1)],1),a("el-dialog",{attrs:{title:"删除-"+e.currenDeleteRow.name,visible:e.deleteDialog,width:"30%"},on:{"update:visible":function(t){e.deleteDialog=t}}},[a("span",[e._v("确定要删除此项吗")]),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.deleteDialog=!1}}},[e._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.deleteItem("one")}}},[e._v("确定")])],1)]),a("el-dialog",{attrs:{title:"删除",visible:e.mutilDeleteDialog,width:"50%"},on:{"update:visible":function(t){e.mutilDeleteDialog=t}}},[a("span",{staticClass:"s-title"},[e._v("确定要删除以下内容吗?")]),e._l(e.nameArr,(function(t,s){return a("div",{key:s,staticClass:"gz-name"},[e._v(" "+e._s(t)+" ")])})),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.mutilDeleteDialog=!1}}},[e._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.deleteItem("mutil")}}},[e._v("确定")])],1)],2)],1)},et=[],tt=(a("99af"),{name:"staffRole",props:{merchants:Object},data:function(){return{status:"",allQL:!1,updateDialog:!1,insertDialog:!1,mutilDeleteDialog:!1,deleteDialog:!1,curPage:1,total:13,rulesForm:{name:[{required:!0,message:"请输入名称",trigger:"blur"}]},tableListData:[],status_ui:!0,lock_ui:!1,addItem:{shop_id:"",merchant_id:"",name:"",commission:"",gift_amount:"",status:1,lock:0,menu_ids:[]},currenItem:{},currenDeleteRow:"",multipleSelection:[],nameArr:[],searchValue:"",defaultProps:{children:"children",label:"label"},menuData:[],updateQ:[],curOpenType:"edit"}},created:function(){this.addItem.shop_id=Number(this.merchants.shop_id),this.addItem.merchant_id=Number(this.merchants.merchant_id),this.currenItem.merchant_id=Number(this.merchants.merchant_id),this.currenItem.shop_id=Number(this.merchants.shop_id),this.getTableList(),this.menuAllTree()},methods:{handleRoleBox:function(){this.$emit("handleRoleBox",!1)},getCheckedNodes:function(){var e=this.$refs.tree.getCheckedKeys(),t=this.$refs.tree.getHalfCheckedKeys();return""!=t?e.concat(t):e},resetData:function(){this.status="",this.curPage=1,this.getTableList()},screening:function(){this.curPage=1,this.getTableList()},getTableList:function(){var e=this,t={merchant_id:this.merchants.merchant_id,shop_id:this.merchants.shop_id,status:this.status,page:this.curPage,name:this.searchValue};this.api.staff.juesList(t).then((function(t){e.tableListData=t.data.data,e.total=t.data.count}))},menuAllTree:function(){var e=this;this.api.staff.menuAllTree().then((function(t){e.menuData=t.data.data}))},searchDatas:function(){this.curPage=1,this.getTableList()},insertItemtk:function(){this.insertDialog=!0,this.status_ui=!0,this.lock_ui=!1},insertItem:function(){var e=this,t=this.addItem;this.status_ui?t.status=1:t.status=0,this.lock_ui?t.lock=1:t.lock=0,t.menu_ids=this.getCheckedNodes(),t.gift_amount=Number(t.gift_amount),t.commission=Number(t.commission),this.api.staff.juesInsert(t).then((function(t){e.$refs["formName"].resetFields(),e.getTableList(),e.insertDialog=!1}))},openUpdateDialog:function(e,t,a){this.curOpenType=a,this.updateDialog=!0,this.currenItem=t,this.permissionsID(this.currenItem.id),1==this.currenItem.status?this.status_ui=!0:this.status_ui=!1,1==this.currenItem.lock?this.lock_ui=!0:this.lock_ui=!1},permissionsID:function(e){var t=this,a={role_id:e,merchant_id:this.merchants.merchant_id,shop_id:this.merchants.shop_id};this.api.staff.RoleMenuIDList(a).then((function(e){for(var a=e.data.data.menu_id,s=0;s<a.length;s++)if(1==a[s]){a.splice(s,1);break}t.updateQ=a}))},multiUpdate:function(){var e=this,t=this.currenItem;this.status_ui?t.status=1:t.status=0,this.lock_ui?t.lock=1:t.lock=0,t.gift_amount=Number(t.gift_amount),t.commission=Number(t.commission),this.UpdateQ(t.id),this.api.staff.juesUpdate(t).then((function(t){e.getTableList(),e.updateDialog=!1}))},UpdateQ:function(e){var t={role_id:e,menu_ids:this.getCheckedNodes(),merchant_id:this.merchants.merchant_id,shop_id:this.merchants.shop_id};this.api.staff.setRoleMenu(t).then((function(e){}))},batchDelete:function(){""!=this.multipleSelection?this.mutilDeleteDialog=!0:this.$message({message:"请先勾选要删除的数据",type:"warning"})},openDelDialog:function(e){this.currenDeleteRow=e,this.deleteDialog=!0},deleteItem:function(e){var t=this,a=[];"one"==e?a[0]=this.currenDeleteRow.id:"mutil"==e&&(a=this.multipleSelection);var s={id:a,merchant_id:this.merchants.merchant_id,shop_id:this.merchants.shop_id};this.api.staff.juesDelete(s).then((function(e){t.getTableList(),t.mutilDeleteDialog=!1,t.deleteDialog=!1}))},selectItem:function(e){var t=this;this.multipleSelection=[],this.nameArr=[],e.forEach((function(e,a){t.multipleSelection.push(e.id),t.nameArr.push(e.name)}))},pageChange:function(e){this.curPage=e,this.getTableList()}}}),at=tt,st=(a("2153"),Object(p["a"])(at,Ze,et,!1,null,"2e52c48b",null)),it=st.exports,ot={name:"staffMain",components:{staffItem:Xe,staffRole:it},data:function(){return{showRoleBox:!1,isLoading:!1,deptDialog:!1,staffDialog:!1,soVal:"",options:[],multipleSelection:[],value:!0,page:1,count:0,detaileData:[],title:"",gb_id:0,is_delete:!1,sortableList:{ascending:"asc",descending:"desc",asc:"ascending",desc:"descending"},order:"",sort:"",deptRules:{name:[{required:!0,message:"请输入分类名称",trigger:"blur"}],sort:[{required:!0,message:"必须排序",trigger:"blur"},{type:"number",message:"必须为数字值"}]},staffRules:{staff_name:[{required:!0,message:"请输入名称",trigger:"blur"}],staff_phone:[{required:!0,message:"请输入手机",trigger:"blur"}],staff_account:[{required:!0,message:"请输入工号",trigger:"blur"}],dept_id:[{required:!0,message:"请选择部门",trigger:"blur"}],role_id:[{required:!0,message:"请选择角色",trigger:"blur"}],min_people_num:[{required:!0,message:"请输入最少人数",trigger:"blur"},{type:"number",message:"必须为数字值"}],staff_commission:[{required:!0,message:"请输入提成",trigger:"blur"},{type:"number",message:"必须为数字值"}],staff_gift_amount:[{required:!0,message:"请输入可赠送金额",trigger:"blur"},{type:"number",message:"必须为数字值"}]},deptForm:{dept_id:0,dept_name:"",dept_status:1},staffForm:{staff_id:0,staff_name:"",staff_phone:"",staff_account:"",staff_password:"",dept_id:null,role_id:null,staff_commission:null,staff_gift_amount:0,staff_status:1},deptListData:[],roleListData:[],staffListData:[],dept_id:0,editableTabsValue:"0",tabStatus:"0"}},props:{merchants:Object,enable:{type:Boolean,default:!1}},methods:{draggableChangeClass:function(e){var t=this,a=[];for(var s in this.deptListData)this.deptListData[s].dept_sort=this.deptListData.length-1-s,a.push({dept_id:this.deptListData[s].dept_id,dept_sort:Number(this.deptListData[s].dept_sort)});var i={merchant_id:this.merchants.merchant_id,shop_id:this.merchants.shop_id,dept:a};this.api.staff.deptSetSort(i).then((function(e){var a=e.data;a.data;t.getDept()}))},handleRoleBox:function(){this.showRoleBox=!this.showRoleBox},handleEditStaff:function(e){console.info(e),this.staffForm=e,this.isLoading=!1,this.staffDialog=!0},editDept:function(e){this.isLoading=!1,this.deptForm=e,this.deptDialog=!0},tabFun:function(e){this.dept_id=Number(e),this.dept_id>0?this.getAllStaff(this.dept_id):0==this.dept_id&&this.getAllStaff(0)},addNewDept:function(){this.deptForm={dept_id:0,dept_name:"",dept_status:1},this.deptDialog=!0},getDept:function(e){var t=this,a={merchant_id:this.merchants.merchant_id,shop_id:this.merchants.shop_id};this.api.staff.deptList(a).then((function(a){var s=a.data,i=s;t.deptListData=i.data,t.editableTabsValue="0",e&&e()}))},getAllStaff:function(e){var t=this,a={page:this.page,merchant_id:this.merchants.merchant_id,shop_id:this.merchants.shop_id,sort:this.sort,order:this.order,dept_id:e,query:this.soVal};0==e&&delete a.dept_id,this.is_delete?a.is_delete=1:delete a.is_delete,this.api.staff.userList(a).then((function(e){var a=e.data,s=a;if(t.staffListData=s.data,t.count=s.count,t.$refs.pagination.internalCurrentPage=t.page,t.staffListData)for(var i=0;i<t.staffListData.length;i++)t.staffListData[i].staff_gift_amount=t.CalculateData(t.staffListData[i].staff_gift_amount,"/"),t.staffListData[i].staff_gift_balance=t.CalculateData(t.staffListData[i].staff_gift_balance,"/")}))},submitStaff:function(){var e=this;this.$refs["staffForm"].validate((function(t){if(t){var a=V.a.cloneDeep(e.staffForm);a.staff_id=Number(e.staffForm.staff_id),a.staff_gift_amount=e.CalculateData(a.staff_gift_amount,"*"),delete a.operator_id,delete a.operator_name,delete a.staff_gift_balance,delete a.staff_create_time,a.staff_id=Number(e.staffForm.staff_id),a.dept_id=Number(e.staffForm.dept_id),a.merchant_id=Number(e.merchants.merchant_id),a.shop_id=Number(e.merchants.shop_id),e.isLoading=!0,0==a.staff_id?(delete a.place_id,e.api.staff.userInsert(a).then((function(t){var a=t.data,s=a;e.$message({message:s.msg,type:0==s.code?"success":"error"}),e.reloadData()})).catch((function(t){e.isLoading=!1}))):e.api.staff.userUpdate(a).then((function(t){var a=t.data,s=a;e.$message({message:s.msg,type:0==s.code?"success":"error"}),e.reloadData()})).catch((function(t){e.isLoading=!1}))}else e.isLoading=!1}))},editClass:function(e){this.deptForm=Object.assign({},e),this.deptDialog=!0},changeStatusClass:function(e,t){var a=this,s=Object.assign({},e);s.status=t?1:0,s.merchant_id=Number(this.merchants.merchant_id),s.shop_id=Number(this.merchants.shop_id),s.dept_id=Number(s.dept_id),s.dept_status=t?1:0,this.isLoading=!0,this.api.staff.deptUpdate(s).then((function(e){var t=e.data;a.isLoading=!1;var s=t;a.$message({message:""+s.msg,type:"success"}),a.reloadData()})).catch((function(e){console.error(e),a.isLoading=!1}))},submitDept:function(){var e=this;this.$refs["deptForm"].validate((function(t){if(t){e.deptForm.dept_id=Number(e.deptForm.dept_id);var a=V.a.cloneDeep(e.deptForm);a.shop_id=Number(e.merchants.shop_id),a.merchant_id=Number(e.merchants.merchant_id),e.isLoading=!0,0==a.dept_id?(delete a.dept_id,e.api.staff.deptInsert(a).then((function(t){var a=t.data,s=a;e.$message({message:s.msg,type:0==s.code?"success":"error"}),e.reloadData()})).catch((function(t){e.isLoading=!1}))):e.api.staff.deptUpdate(a).then((function(t){var a=t.data,s=a;e.$message({message:s.msg,type:0==s.code?"success":"error"}),e.reloadData()})).catch((function(t){e.isLoading=!1}))}}))},deleteDept:function(){var e=this;Number(this.deptForm.dept_id)>0&&this.$confirm("确定要删除吗？","提示",{type:"warning"}).then((function(){var t={id:[Number(e.deptForm.dept_id)],merchant_id:Number(e.merchants.merchant_id),shop_id:Number(e.merchants.shop_id)};e.api.staff.deptDelete(t).then((function(t){var a=t.data,s=a;e.$message({message:s.msg,type:0==s.code?"success":"error"}),e.reloadData()}))}))},getRole:function(){var e=this,t={page_size:1e6,merchant_id:Number(this.merchants.merchant_id),shop_id:Number(this.merchants.shop_id),status:1};this.api.staff.juesList(t).then((function(t){var a=t.data,s=a;e.roleListData=s.data}))},pageChange:function(e){this.page=e,this.getAllStaff(this.dept_id)},reloadData:function(){var e=this;this.isLoading=!1,this.deptDialog=!1,this.staffDialog=!1,this.getDept((function(){e.getAllStaff(0),e.getRole()}))},handleDeleteBox:function(e){this.is_delete=e,this.reloadData()},deleteStaff:function(e){this.multipleSelection=e.list,e.isDelete&&this.handleDeleteStaff()},handleDeleteStaff:function(){var e=this;this.multipleSelection.length>0&&this.$confirm("确定删除吗？","提示").then((function(){var t={id:e.multipleSelection,merchant_id:Number(e.merchants.merchant_id),shop_id:Number(e.merchants.shop_id)};e.api.staff.userDelete(t).then((function(t){t.data;e.multipleSelection=[],e.getAllStaff()}))}))},recoveryStaff:function(e){this.multipleSelection=e.list,e.isRecovery&&this.handleRecoveryStaff()},handleRecoveryStaff:function(){var e=this;this.multipleSelection.length>0&&this.$confirm("确定还原吗？","提示").then((function(){var t={id:e.multipleSelection,merchant_id:Number(e.merchants.merchant_id),shop_id:Number(e.merchants.shop_id)};e.api.staff.userRecovery(t).then((function(t){t.data;e.multipleSelection=[],e.getAllStaff()}))}))},sortStaff:function(e){this.sort=e.order?e.prop:"",this.order=e.order?this.sortableList[e.order]:"",this.page=1,this.getAllStaff()},handleNewStaff:function(){0!=this.deptListData.length?(this.staffForm={staff_id:0,staff_name:"",staff_phone:"",staff_account:"",staff_password:"",dept_id:null,role_id:null,staff_commission:null,staff_gift_amount:0,staff_status:1},this.isLoading=!1,this.staffDialog=!0):this.$message({message:"尚未设置部门，请先新建部门信息...",type:"warning",duration:0,showClose:!0})}},watch:{enable:{immediate:!0,handler:function(e){e&&this.reloadData()}}},created:function(){}},rt=ot,lt=(a("e41a"),Object(p["a"])(rt,Ee,He,!1,null,"63b5c3af",null)),nt=lt.exports,ct=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"shopSet"},[s("div",{staticClass:"add-box"},[s("div",{staticClass:"btn-nav"},[s("el-button",{attrs:{type:"danger",disabled:!e.multipleSelection.length>0},on:{click:e.batchDelete}},[e._v("删除")]),s("el-button",{attrs:{type:"primary"},on:{click:e.addPrinter}},[e._v("新增")])],1),s("div",{staticClass:"so-nav"},[s("el-input",{staticClass:"searchInput",attrs:{placeholder:"请输入要搜索的内容","prefix-icon":"el-icon-search",clearable:""},on:{change:e.searchDatas},model:{value:e.searchValue,callback:function(t){e.searchValue=t},expression:"searchValue"}}),s("el-button",{staticStyle:{"margin-left":"10px"},attrs:{type:"primary"},on:{click:e.searchDatas}},[e._v("搜索")])],1)]),s("el-table",{ref:"multipNum_type",staticStyle:{width:"100%"},attrs:{stripe:"",data:e.printListData,"tooltip-effect":"dark"},on:{"sort-change":e.sortFilterFun,"selection-change":e.selectPrinter}},[s("el-table-column",{attrs:{type:"selection",width:"55"}}),s("el-table-column",{attrs:{label:"全选/ID",width:"120",sortable:"custom"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("span",[e._v(e._s(t.row.printer_id))])]}}])}),s("el-table-column",{attrs:{prop:"name",label:"打印机名称"}}),s("el-table-column",{attrs:{prop:"brand",label:"型号"}}),s("el-table-column",{attrs:{prop:"sn",label:"编号",sortable:"custom"}}),s("el-table-column",{attrs:{prop:"create_time",label:"创建时间",sortable:"custom"}}),s("el-table-column",{attrs:{prop:"status",label:"状态"},scopedSlots:e._u([{key:"default",fn:function(t){return[0==t.row.status?s("span",[e._v("禁用")]):e._e(),1==t.row.status?s("span",[e._v("正常")]):e._e()]}}])}),s("el-table-column",{attrs:{align:"right",label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("el-button",{attrs:{size:"mini"},on:{click:function(a){e.updateDialog(t.$index,JSON.parse(JSON.stringify(t.row)),"type")}}},[e._v("编辑")]),s("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(a){return e.openDelDialog(t.row)}}},[e._v("删除")])]}}])})],1),s("div",{staticClass:"pagination"},[s("el-pagination",{ref:"pagination",attrs:{"current-page":e.curPage,"hide-on-single-page":!0,background:"",layout:"prev, pager, next",total:e.total},on:{"prev-click":e.prePage,"current-change":e.pageChange,"next-click":e.nextPage}})],1),s("el-dialog",{attrs:{title:e.printerDialogTitle,visible:e.printDetail,width:"50%"},on:{"update:visible":function(t){e.printDetail=t}}},[s("el-row",{attrs:{gutter:20}},[s("el-col",{attrs:{span:12}},[s("el-form",{ref:"updateForm",staticClass:"demo-ruleForm",attrs:{model:e.currenPrinter,rules:e.rulesForm,"label-width":"100px"}},[s("el-form-item",{attrs:{label:"型号",prop:"brand"}},[s("el-select",{attrs:{placeholder:"选择商家类型"},model:{value:e.currenPrinter.brand,callback:function(t){e.$set(e.currenPrinter,"brand",t)},expression:"currenPrinter.brand"}},e._l(e.printerBrandType,(function(e,t){return s("el-option",{key:"brand_"+t,attrs:{label:e,value:e}})})),1)],1),s("el-form-item",{attrs:{label:"名称",prop:"name"}},[s("el-input",{model:{value:e.currenPrinter.name,callback:function(t){e.$set(e.currenPrinter,"name",t)},expression:"currenPrinter.name"}})],1),s("el-form-item",{attrs:{label:"编号",prop:"sn"}},[s("el-input",{model:{value:e.currenPrinter.sn,callback:function(t){e.$set(e.currenPrinter,"sn",t)},expression:"currenPrinter.sn"}})],1),s("el-form-item",{attrs:{label:"终端密钥",prop:"key"}},[s("el-input",{model:{value:e.currenPrinter.key,callback:function(t){e.$set(e.currenPrinter,"key",t)},expression:"currenPrinter.key"}})],1),s("el-form-item",{attrs:{label:"打印联数",prop:"times"}},[s("el-input",{model:{value:e.currenPrinter.times,callback:function(t){e.$set(e.currenPrinter,"times",t)},expression:"currenPrinter.times"}})],1),s("el-form-item",{attrs:{label:"自定义信息",prop:"custom_info"}},[s("el-input",{model:{value:e.currenPrinter.custom_info,callback:function(t){e.$set(e.currenPrinter,"custom_info",t)},expression:"currenPrinter.custom_info"}}),s("br"),s("el-checkbox",{model:{value:e.currenPrinter.custom_info_larger,callback:function(t){e.$set(e.currenPrinter,"custom_info_larger",t)},expression:"currenPrinter.custom_info_larger"}},[e._v("放大自定义信息")])],1),s("el-form-item",{attrs:{label:""}},[s("el-checkbox",{model:{value:e.currenPrinter.show_qr,callback:function(t){e.$set(e.currenPrinter,"show_qr",t)},expression:"currenPrinter.show_qr"}},[e._v("是否显示二维码")])],1),s("el-form-item",{attrs:{label:""}},[s("el-checkbox",{model:{value:e.currenPrinter.show_phone,callback:function(t){e.$set(e.currenPrinter,"show_phone",t)},expression:"currenPrinter.show_phone"}},[e._v("是否显示商家信息")])],1),s("el-form-item",{attrs:{label:"是否启用"}},[s("el-checkbox",{model:{value:e.currenPrinter.status,callback:function(t){e.$set(e.currenPrinter,"status",t)},expression:"currenPrinter.status"}})],1),s("el-form-item",[s("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.updatePrinter("updateForm")}}},[e._v("保存")]),s("el-button",{on:{click:function(t){e.resetForm("updateForm"),e.printDetail=!1}}},[e._v("取消")])],1),s("el-form-item",{staticClass:"printerImg"})],1)],1),s("el-col",{attrs:{span:12}},[s("div",[e._v("打印例图：")]),s("img",{staticStyle:{width:"418px",height:"530px"},attrs:{src:a("a023")}})])],1)],1),s("el-dialog",{ref:"addForm",attrs:{title:"新增打印机",visible:e.showAddDialog,width:"50%"},on:{"update:visible":function(t){e.showAddDialog=t}}},[s("el-row",{attrs:{gutter:20}},[s("el-col",{attrs:{span:12}},[s("el-form",{ref:"updateForm",staticClass:"demo-ruleForm",attrs:{model:e.addPrinterData,rules:e.rulesForm,"label-width":"100px"}},[s("el-form-item",{attrs:{label:"型号",prop:"brand"}},[s("el-select",{attrs:{placeholder:"选择商家类型"},model:{value:e.addPrinterData.brand,callback:function(t){e.$set(e.addPrinterData,"brand",t)},expression:"addPrinterData.brand"}},e._l(e.printerBrandType,(function(e,t){return s("el-option",{key:"brand_"+t,attrs:{label:e,value:e}})})),1)],1),s("el-form-item",{attrs:{label:"名称",prop:"name"}},[s("el-input",{model:{value:e.addPrinterData.name,callback:function(t){e.$set(e.addPrinterData,"name",t)},expression:"addPrinterData.name"}})],1),s("el-form-item",{attrs:{label:"编号",prop:"sn"}},[s("el-input",{model:{value:e.addPrinterData.sn,callback:function(t){e.$set(e.addPrinterData,"sn",t)},expression:"addPrinterData.sn"}})],1),s("el-form-item",{attrs:{label:"终端密钥",prop:"key"}},[s("el-input",{model:{value:e.addPrinterData.key,callback:function(t){e.$set(e.addPrinterData,"key",t)},expression:"addPrinterData.key"}})],1),s("el-form-item",{attrs:{label:"打印联数",prop:"times"}},[s("el-input",{model:{value:e.addPrinterData.times,callback:function(t){e.$set(e.addPrinterData,"times",t)},expression:"addPrinterData.times"}})],1),s("el-form-item",{attrs:{label:"自定义信息"}},[s("el-input",{model:{value:e.addPrinterData.custom_info,callback:function(t){e.$set(e.addPrinterData,"custom_info",t)},expression:"addPrinterData.custom_info"}}),s("el-checkbox",{model:{value:e.addPrinterData.custom_info_larger,callback:function(t){e.$set(e.addPrinterData,"custom_info_larger",t)},expression:"addPrinterData.custom_info_larger"}},[e._v("放大自定义信息")])],1),s("el-form-item",{attrs:{label:""}},[s("el-checkbox",{model:{value:e.addPrinterData.show_qr,callback:function(t){e.$set(e.addPrinterData,"show_qr",t)},expression:"addPrinterData.show_qr"}},[e._v("是否显示二维码")])],1),s("el-form-item",{attrs:{label:""}},[s("el-checkbox",{model:{value:e.addPrinterData.show_phone,callback:function(t){e.$set(e.addPrinterData,"show_phone",t)},expression:"addPrinterData.show_phone"}},[e._v("是否显示商家信息")])],1),s("el-form-item",{attrs:{label:"是否启用"}},[s("el-checkbox",{model:{value:e.currenPrinter.status,callback:function(t){e.$set(e.currenPrinter,"status",t)},expression:"currenPrinter.status"}})],1),s("el-form-item",[s("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.insertPrinter("updateForm")}}},[e._v("保存")]),s("el-button",{on:{click:function(t){e.resetForm("updateForm"),e.showAddDialog=!1}}},[e._v("取消")])],1)],1)],1),s("el-col",{attrs:{span:12}},[s("div",[e._v("打印例图：")]),s("img",{staticStyle:{width:"418px",height:"530px"},attrs:{src:a("a023")}})])],1)],1),s("el-dialog",{attrs:{title:"删除打印机-"+e.deltitle,visible:e.deleteDialog,width:"30%"},on:{"update:visible":function(t){e.deleteDialog=t}}},[s("span",[e._v("确定要删除此打印机吗")]),s("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:function(t){e.deleteDialog=!1}}},[e._v("取 消")]),s("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.deletePrinter("one")}}},[e._v("确定")])],1)]),s("el-dialog",{attrs:{title:"删除打印机",visible:e.mutilDeletePrinterBox,width:"50%"},on:{"update:visible":function(t){e.mutilDeletePrinterBox=t}}},[s("span",{staticClass:"s-title"},[e._v("确定要删除以下打印机吗?")]),e._l(e.nameArr,(function(t,a){return s("div",{key:a,staticClass:"gz-name"},[e._v(" "+e._s(t)+" ")])})),s("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:function(t){e.mutilDeletePrinterBox=!1}}},[e._v("取 消")]),s("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.deletePrinter("mutil")}}},[e._v("确定")])],1)],2)],1)},ut=[],dt={name:"printManage",props:{enable:{type:Boolean,default:!1},merchants:Object},data:function(){return{msg:"店铺打印机",srcList:[],searchValue:"",printDetail:!1,mutilDeletePrinterBox:!1,deleteDialog:!1,showUpdateDialog:!1,showAddDialog:!1,printerDialogTitle:"",currenDeleteRow:{},deltitle:"",curPage:1,total:0,multipleSelection:[],nameArr:[],printerBrandType:[],printListData:[Object(o["a"])({printer_id:"",name:"",brand:"",sn:"",status:""},"printer_id","")],addPrinterData:{merchant_id:0,printer_id:"",name:"",brand:"",sn:"",status:"",key:"",times:null,custom_info:"",custom_info_larger:"",show_qr:"",show_phone:""},currenPrinter:{shop_id:0,merchant_id:0,printer_id:"",name:"",brand:"",sn:"",status:"",key:"",times:null,custom_info:"",custom_info_larger:"",show_qr:"",show_phone:""},rulesForm:{name:[{required:!0,message:"请输入打印机名称",trigger:"blur"}],brand:[{required:!0,message:"请输入品牌名称",trigger:"blur"}],sn:[{required:!0,message:"请输入终端编号",trigger:"blur"}],times:[{required:!0,message:"请输入打印联数",trigger:"blur"}],key:[{required:!0,message:"请输入终端密钥",trigger:"blur"}],custom_info:[{required:!0,message:"请输入自定义信息",trigger:"blur"}]}}},watch:{enable:{immediate:!0,handler:function(e){e&&this.iniPage()}}},created:function(){},methods:{iniPage:function(){this.$store.dispatch("updateVuex",{key:"merchantsData",value:this.merchants}),this.getPrinterList(this.curPage),this.getPrinterBrandType()},getPrinterBrandType:function(){var e=this,t={merchant_id:Number(this.merchants.merchant_id),shop_id:Number(this.merchants.shop_id)};this.api.shop.printerBrandType(t).then((function(t){var a=t.data;e.printerBrandType=a.data.printer_brand_type}))},getPrinterList:function(e){var t=this;this.multipleSelection=[],this.curPage=e;var a={merchant_id:Number(this.merchants.merchant_id),shop_id:Number(this.merchants.shop_id),page:e};this.$store.dispatch("shop/printerList",a).then((function(e){t.printListData=e.data,t.total=e.count,t.$refs.pagination.internalCurrentPage=t.curPage}))},updatePrinter:function(e){var t=this;this.currenPrinter.times=parseInt(this.currenPrinter.times),this.currenPrinter.custom_info_larger=!0===this.currenPrinter.custom_info_larger?1:0,this.currenPrinter.show_qr=!0===this.currenPrinter.show_qr?1:0,this.currenPrinter.show_phone=!0===this.currenPrinter.show_phone?1:0,this.currenPrinter.shop_id=Number(this.merchants.shop_id),this.currenPrinter.merchant_id=Number(this.merchants.merchant_id),this.currenPrinter.status=this.currenPrinter.status?1:0,this.$refs[e].validate((function(e){if(!e)return console.log("error submit!!"),!1;t.$store.dispatch("shop/updatePrinter",t.currenPrinter).then((function(e){t.$message({message:e.msg,type:"success"}),t.getPrinterList(t.curPage),t.printDetail=!1}))}))},sortMethod:function(e){var t=this,a="asc";this.sortStatus=!this.sortStatus,a=this.sortStatus?"asc":"desc";var s={page:this.curPage,sort:e,order:a,merchant_id:Number(this.merchants.merchant_id),shop_id:Number(this.merchants.shop_id)};this.$store.dispatch("shop/printerList",s).then((function(e){t.printListData=e.data,t.total=e.count,t.$refs.pagination.internalCurrentPage=t.curPage}))},sortFilterFun:function(e){this.sortMethod(e.prop)},searchDatas:function(){var e=this;this.curPage=1;var t={name:this.searchValue,merchant_id:Number(this.merchants.merchant_id),shop_id:Number(this.merchants.shop_id)};this.$store.dispatch("shop/printerList",t).then((function(t){e.printListData=t.data,e.total=t.count,e.$refs.pagination.internalCurrentPage=e.curPage}))},openDelDialog:function(e){this.deltitle=e.name,this.currenDeleteRow=e,this.deleteDialog=!0},addPrinter:function(){this.showAddDialog=!0},insertPrinter:function(){var e=this,t={merchant_id:Number(this.merchants.merchant_id),shop_id:Number(this.merchants.shop_id),name:this.addPrinterData.name,brand:this.addPrinterData.brand,sn:this.addPrinterData.sn,key:this.addPrinterData.key,times:parseInt(this.addPrinterData.times),custom_info:this.addPrinterData.custom_info,custom_info_larger:this.addPrinterData.custom_info_larger?1:0,show_qr:this.addPrinterData.show_qr?1:0,show_phone:this.addPrinterData.show_phone?1:0,status:this.addPrinterData.status?1:0};this.$store.dispatch("shop/insertPrinter",t).then((function(t){e.$message({message:"添加成功",type:"success"}),e.getPrinterList(e.curPage),e.resetForm("updateForm"),e.showAddDialog=!1}))},batchDelete:function(){this.multipleSelection.length>0?this.mutilDeletePrinterBox=!0:this.$message({message:"请先勾选要删除的打印机",type:"warning"})},deletePrinter:function(e){var t=this,a=[];a.push(this.currenDeleteRow.printer_id);var s="one"===e?a:this.multipleSelection;console.info(s);var i={merchant_id:Number(this.merchants.merchant_id),shop_id:Number(this.merchants.shop_id),id:s};this.$store.dispatch("shop/deletePrinter",i).then((function(e){t.$message({message:""+e.msg,type:"success"}),t.getPrinterList(t.curPage),t.mutilDeletePrinterBox=!1,t.deleteDialog=!1}))},updateDialog:function(e,t){this.printDetail=!0,this.printerDialogTitle="打印机管理-"+t.name,this.currenPrinter={printer_id:t.printer_id,name:t.name,sn:t.sn,brand:t.brand,status:1===t.status,key:t.key,times:t.times,custom_info:t.custom_info,custom_info_larger:1===t.custom_info_larger,show_qr:1===t.show_qr,show_phone:1===t.show_phone}},selectPrinter:function(e){var t=this;this.multipleSelection=[],this.nameArr=[],e.forEach((function(e,a){t.multipleSelection.push(e.printer_id),t.nameArr.push(e.name)}))},prePage:function(){this.curPage-=1,this.getPrinterList(this.curPage)},pageChange:function(e){this.curPage=e,this.getPrinterList(this.curPage)},nextPage:function(){this.curPage+=1,this.getPrinterList(this.curPage)},resetForm:function(e){this.$refs[e].resetFields()}}},mt=dt,pt=(a("c755"),Object(p["a"])(mt,ct,ut,!1,null,"0db863d5",null)),ht=pt.exports,ft=a("81ed"),_t={name:"ShopSet",components:{citySelect:k,uploadFiles:l["a"],uploadVideo:f,goods:te,group:Ce,PlaceMain:Me,staffMain:nt,printManage:ht,amap:ft["a"]},data:function(){var e;return e={showBack:!1,video_limit:3,photo_limit:9,imgIndex:0,header:{headers:{"Content-Type":"multipart/form-data; boundary=--------------------------AAAAA",AccessToken:Object(r["a"])()}},imageUrl:"",showPanle:{shopAlbum:!1,shopGoods:!1,shopGroups:!1,shopPlace:!1,shopStaff:!1,shopPrint:!1},activeName:"shopInfo",shop_id:"",merchant_id:"",isNothing:!1,imgDialogVisible:!1,imgUrl:"",msg:"商家设置",shopInfoData:{},logos:[],form:{type_id:"",type_name:"",name:"",ename:"",phone:"",province_id:"",city_id:"",area_id:"",address:"",summary:"",longitude:"",latitude:"",logo:"",notice:"",basic_price:"",business_start_time:"",business_stop_time:"",reserve_max_duration:"",reserve_time_interval:"",reserve_auto_audit:"",shopping_auto_audit:"",shopping_pay_online:"",reserve_latest_arrive:"",reserve_choose_place:0,business_status:1,status_desc:"",status:null},rules:{business_start_time:[{required:!0,message:"请选择营业开始时间",trigger:"change"}],business_stop_time:[{required:!0,message:"请选择营业结束时间",trigger:"change"}],address:[{required:!0,message:"请填写地址",trigger:"blur"}],phone:[{required:!0,message:"请输入电话号码",trigger:"blur"}],reserve_max_duration:[{required:!0,message:"请输入预订最大的时间时长",trigger:"blur"}],reserve_time_interval:[{required:!0,message:"请输入预订最大的时间间隔",trigger:"blur"}],basic_price:[{required:!0,message:"请输入人均消费",trigger:"blur"}],reserve_latest_arrive:[{required:!0,message:"请输入预定最迟到达时间",trigger:"blur"}],reserve_auto_audit:[{required:!0,message:"请勾选自动审核预订",trigger:"change"}],shopping_auto_audit:[{required:!0,message:"请勾选自动审核下单",trigger:"change"}],shopping_pay_online:[{required:!0,message:"请选择下单是否开启在线支付",trigger:"change"}],reserve_choose_place:[{required:!0,message:"请选择预订是否支持选位",trigger:"change"}],business_status:[{required:!0,message:"请设置营业状态",trigger:"change"}],status:[{required:!0,message:"请设置审核状态",trigger:"change"}]},mapForAdd:{dialogVisible:!1,mapHeight:450,height:"80%",width:"85%",longitude:"",latitude:"",title:"选择目标位置"},openTimeArea:[new Date(2016,9,10,0,11),new Date(2016,9,10,23,59)],shopTypeList:[],shopAlbumSort:{fileList:[],videoList:[]},uploadData:{},locationData:{},areaTitle:"选择店铺区域",shopAreaName:"",value:"",shopDatas:""},Object(o["a"])(e,"imgUrl",""),Object(o["a"])(e,"dialogImgVisible",!0),Object(o["a"])(e,"dialogImageUrl",[]),Object(o["a"])(e,"drawer",!1),Object(o["a"])(e,"fileList",[]),Object(o["a"])(e,"fileListOne",[]),Object(o["a"])(e,"videoList",[]),Object(o["a"])(e,"limit",100),Object(o["a"])(e,"limitOne",1),Object(o["a"])(e,"isShop",!0),e},mounted:function(){},created:function(){this.showBack=!!this.$route.query.from,this.imgUrl="http://ddhi.oss-cn-hangzhou.aliyuncs.com",this.shop_id=this.$route.query.shop_id,this.merchant_id=this.$route.query.merchant_id,this.activeName=this.$route.query.tab?this.$route.query.tab:"shopInfo",this.showPanle[this.activeName]=!0,this.getShopDetail(),this.getShopType()},methods:{cutDown:function(e){var t=this,a=e.file.size/1024/1024<2;if(a){var s=new FormData;s.append("file[]",e.file),s.append("root","shop"),this.$ajax.post("/api/file/uploads",s,this.header).then((function(a){0==a.data.code?(t.imageUrl=e.dataURL,t.form.logo=a.data.data.url_path[0]):(t.imageUrl="",t.form.logo="",t.$message({message:a.data.msg,type:"warning"}))}))}else this.$message({message:"上传失败，图片不能大于2M，请重新选择图片",type:"warning"})},draggableChangeFile:function(e){var t=this;console.info(e);for(var a=0;a<this.fileList.length;a++)this.fileList[a]["album_sort"]=a;var s={merchant_id:Number(this.merchant_id),shop_id:Number(this.shop_id),album:this.fileList};console.info(s),this.api.shop.PhotoSort(s).then((function(e){t.GetPhotosUrl()}))},draggableChangeVideo:function(e){var t=this;console.info(e);for(var a=[],s=0;s<this.videoList.length;s++)this.videoList[s]["sort"]=s,a.push({video_id:this.videoList[s]["video_id"],sort:this.videoList[s]["sort"]});var i={merchant_id:Number(this.merchant_id),shop_id:Number(this.shop_id),video:a};console.info(i),this.api.shop.VideoSort(i).then((function(e){t.GetVideosUrl()}))},tabsFun:function(e){"1"==e.index?(this.GetPhotosUrl(),this.GetVideosUrl()):"3"==e.index&&this.showPanle["shopGroups"]&&this.$refs.shopGroupComponent.reloadData(),this.showPanle[e.name]=!0},getShopDetail:function(){var e=this;this.fileListOne=[];var t={merchant_id:this.merchant_id,shop_id:this.shop_id};this.api.shop.getShopDetail(t).then((function(t){var a=t.data;e.shopDatas=a.data,e.dialogImageUrl=a.data.album;var s=a.data.logo;e.imageUrl=a.data.logo;var i=s.split(",");i.forEach((function(t){var a=new Object;a.url=t,e.fileListOne.push(a)})),e.form={type_id:e.shopDatas.type_id,type_name:e.shopDatas.type_name,name:e.shopDatas.name,ename:e.shopDatas.ename,phone:e.shopDatas.phone,province_id:e.shopDatas.province_id,city_id:e.shopDatas.city_id,area_id:e.shopDatas.area_id,address:e.shopDatas.address,summary:e.shopDatas.summary,longitude:e.shopDatas.longitude,latitude:e.shopDatas.latitude,logo:e.shopDatas.logo,notice:e.shopDatas.notice,basic_price:e.shopDatas.basic_price/100,reserve_max_duration:e.shopDatas.reserve_max_duration/3600,reserve_time_interval:e.shopDatas.reserve_time_interval/3600,reserve_auto_audit:1===e.shopDatas.reserve_auto_audit,shopping_auto_audit:1===e.shopDatas.shopping_auto_audit,shopping_pay_online:1===e.shopDatas.shopping_pay_online,business_start_time:e.shopDatas.business_start_time,business_stop_time:e.shopDatas.business_stop_time,business_status:e.shopDatas.business_status,reserve_choose_place:e.shopDatas.reserve_choose_place,reserve_latest_arrive:e.shopDatas.reserve_latest_arrive,status_desc:e.shopDatas.status_desc,status:e.shopDatas.status,vr:e.shopDatas.vr,vr_url:e.shopDatas.vr_url,reserve:e.shopDatas.reserve},e.locationData={lng:e.form.longitude,lat:e.form.latitude,name:e.form.name,position:[e.form.longitude,e.form.latitude],address:e.form.address},e.shopAreaName=e.shopDatas.province+e.shopDatas.city+e.shopDatas.area,"shopAlbum"==e.activeName&&(e.GetPhotosUrl(),e.GetVideosUrl()),e.$nextTick((function(){e.$refs.uploadVideo.setUploadInfo({merchant_id:e.merchant_id,shop_id:e.shop_id,title:e.form.name})}))}),(function(t){e.isNothing=!0}))},openCitySelect:function(){this._setVuex("showCitySelectBox",!0)},setCityAreaName:function(e){this.shopAreaName=e.province.name+e.city.name+e.area.name,this.form.province_id=e.province.id,this.form.city_id=e.city.id,this.form.area_id=e.area.id},getShopType:function(){var e=this;this.$store.dispatch("shop/getShopType").then((function(t){sessionStorage.setItem("shopType",JSON.stringify(t.data)),e.shopTypeList=t.data}))},setShopType:function(e){this.form.type_id=e.type_id},updatedShop:function(e,t){var a=this,s=this.form,i={type_id:s.type_id,type_name:s.type_name,name:s.name,ename:s.ename,phone:s.phone,province_id:Number(s.province_id),city_id:Number(s.city_id),area_id:Number(s.area_id),address:s.address,summary:s.summary,longitude:s.longitude,latitude:s.latitude,logo:this.GetImageUrl(s.logo),notice:s.notice,basic_price:100*s.basic_price,reserve_max_duration:3600*Number(s.reserve_max_duration),reserve_time_interval:3600*Number(s.reserve_time_interval),reserve_auto_audit:s.reserve_auto_audit?1:0,shopping_auto_audit:s.shopping_auto_audit?1:0,shopping_pay_online:s.shopping_pay_online?1:0,business_start_time:s.business_start_time,business_stop_time:s.business_stop_time,business_status:s.business_status,reserve_latest_arrive:s.reserve_latest_arrive,reserve_choose_place:s.reserve_choose_place,merchant_id:this.merchant_id,shop_id:this.merchant_id,status_desc:s.status_desc,status:s.status,vr:s.vr,vr_url:s.vr_url,reserve:s.reserve},o={summary:s.summary,merchant_id:this.merchant_id,shop_id:this.merchant_id},r={notice:s.notice,merchant_id:this.merchant_id,shop_id:this.merchant_id},l="info"===e?i:"summary"===e?o:r;"info"===e?this.$refs[t].validate((function(e){if(!e)return console.log("error submit!!"),!1;a.$store.dispatch("shop/updateShop",l).then((function(e){a.$message({message:e.msg,type:"success"}),a.getShopDetail()}))})):this.$store.dispatch("shop/updateShop",l).then((function(e){a.$message({message:e.msg,type:"success"}),a.getShopDetail()}))},selectLocation:function(e){this.mapForAdd.dialogVisible=!this.mapForAdd.dialogVisible},showShopMap:function(){this.$refs.aMap.setLocation({position:[this.form.longitude,this.form.latitude],address:this.form.address,name:this.form.name,lat:this.form.latitude,lng:this.form.longitude})},closeMaps:function(e){this.mapForAdd.dialogVisible=e},logoUrl:function(e){this.form.logo=e},cutDown2:function(e){var t=this,a=e.file.size/1024/1024<2;if(a){var s=new FormData;s.append("file[]",e.file),s.append("root","shop"),this.$ajax.post("/api/file/uploads",s,this.header).then((function(e){0==e.data.code?t.photosTabUrl(e.data.data.url_path[0],0):t.$message({message:e.data.msg,type:"warning"})}))}else this.$message({message:"上传失败，图片不能大于2M，请重新选择图片",type:"warning"})},photosTabUrl:function(e,t){var a=this,s=Number(t),i=[];i=0==s?{merchant_id:this.merchant_id,shop_id:this.shop_id,data:[{album_path:e,album_sort:this.fileList.length,album_type:0}]}:{merchant_id:this.merchant_id,shop_id:this.shop_id,data:[{album_path:e[e.length-1].toString(),album_sort:this.videoList.length,album_type:1}]},this.api.shop.PhotoInsert(i).then((function(e){var t=e.data;a.$message({message:""+t.msg,type:"success"}),a.GetPhotosUrl()}))},GetPhotosUrl:function(e){var t=this;this.fileList=[];var a={page_size:1e4,merchant_id:this.merchant_id,shop_id:this.shop_id};this.api.shop.shopalbumList(a).then((function(e){t.shopAlbumSort.fileList=[];for(var a=e.data,s=a.data,i=0;i<s.length;i++)if(0==s[i].album_type){var o=new Object;o=s[i],o.status=!1,t.fileList.push(o),t.shopAlbumSort["fileList"].push(o.album_sort)}}))},GetVideosUrl:function(){var e=this;this.videoList=[];var t={page_size:1e4,merchant_id:this.merchant_id,shop_id:this.shop_id};this.api.shop.shopVideoList(t).then((function(t){e.shopAlbumSort.videoList=[];var a=t.data;if(a.data)for(var s=a.data,i=0;i<s.length;i++)e.videoList.push(s[i]),e.shopAlbumSort.videoList.push(s[i].sort)}))},videoMouseover:function(e){for(var t=0;t<this.videoList.length;t++)t==e&&(this.videoList[t].status=!0)},videoMouseleave:function(e){for(var t=0;t<this.videoList.length;t++)t==e&&(this.videoList[t].status=!1)},picMouseover:function(e){for(var t=0;t<this.fileList.length;t++)t==e&&(this.fileList[t].status=!0)},picMouseleave:function(e){for(var t=0;t<this.fileList.length;t++)t==e&&(this.fileList[t].status=!1)},deleteVideoFun:function(e){var t=this;this.$confirm("确定要删除吗？","提示").then((function(){var a=[];a.push(e);var s={video_id:a,shop_id:t.shop_id};t.api.shop.shopVideoDelete(s).then((function(e){var a=e.data;t.$message({message:""+a.msg,type:"success"}),t.GetVideosUrl()}))})).catch((function(){}))},deletePotoFun:function(e){var t=this;this.$confirm("确定要删除吗？","提示").then((function(){var a=[];a.push(e);var s={id:a,merchant_id:t.merchant_id,shop_id:t.shop_id};t.api.shop.PhotoDelete(s).then((function(e){var a=e.data;t.$message({message:""+a.msg,type:"success"}),t.GetPhotosUrl()}))})).catch((function(){}))},showImg:function(e,t){console.info(t),this.imgIndex=t,this.imgUrl=e,this.imgDialogVisible=!0},chooseLocation:function(e){this.locationData=e,this.form.latitude=e.lat,this.form.longitude=e.lng,this.form.address=e.address,this.mapForAdd.dialogVisible=!1},resetForm:function(e){this.$refs[e].resetFields()},handleOpenOrder:function(){this.$message.warning("尚未开通...")}}},gt=_t,bt=(a("f29f"),Object(p["a"])(gt,s,i,!1,null,"86d8a5f6",null));t["default"]=bt.exports},2677:function(e,t,a){},"2d79":function(e,t,a){"use strict";var s=a("c312"),i=a.n(s);i.a},"3f0e":function(e,t,a){"use strict";var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"image-box"},[e._l(e.file_list,(function(t,s){return a("div",{key:s,staticClass:"img-div",style:e.option.showImageWidth&&e.option.showImageHeight?"width:"+e.option.showImageWidth+"px;height:"+e.option.showImageHeight+"px;":""},[a("img",{staticClass:"d-img",style:e.option.showImageWidth&&e.option.showImageHeight?"width:"+e.option.showImageWidth+"px;height:"+e.option.showImageHeight+"px;":"",attrs:{src:t.url,alt:""},on:{mouseover:function(t){return e.picMouseover(s)},mouseleave:function(t){return e.picMouseleave()},click:function(a){return e.showImg(t.url)}}}),a("div",{directives:[{name:"show",rawName:"v-show",value:e.showBtnIndex==s,expression:"showBtnIndex == index"}],staticClass:"del-icon",on:{click:function(t){return e.deletePotoFun(s)},mouseover:function(t){return e.picMouseover(s)},mouseleave:function(t){return e.picMouseleave()}}},[a("i",{staticClass:"delete-i el-icon-delete"})])])})),a("el-alert",{directives:[{name:"show",rawName:"v-show",value:e.file_list.length>=e.limit,expression:"file_list.length >= limit"}],attrs:{title:"图片数已经到达限制数："+e.limit+"。 请删掉一些图片后才能上传。",type:"warning",closable:!1}}),a("Imgcutter",{directives:[{name:"show",rawName:"v-show",value:e.file_list.length<e.limit,expression:"file_list.length < limit"}],attrs:{boxHeight:e.option.boxHeight,cutWidth:e.option.cutWidth,cutHeight:e.option.cutHeight,sizeChange:e.option.sizeChange,isModal:void 0==e.option.isModal||e.option.isModal},on:{cutDown:e.cutDown}}),a("el-dialog",{attrs:{visible:e.dialogVisible},on:{"update:visible":function(t){e.dialogVisible=t}}},[a("img",{key:e.dialogImageUrl,attrs:{width:"100%",src:e.dialogImageUrl,alt:""}})])],2)},i=[],o=(a("a434"),a("a9e3"),a("5f87")),r={name:"cutterImageUpload",props:{fileList:{type:Array},option:{type:Object},root:{type:String},limit:{type:Number,default:1}},data:function(){return{header:{headers:{"Content-Type":"multipart/form-data; boundary=--------------------------AAAAA",AccessToken:Object(o["a"])()}},loading:!1,file_list:[],showBtnIndex:null,oss_url:this.GetImageOssUrl(),dialogImageUrl:"",dialogVisible:!1}},watch:{fileList:function(e){this.file_list=e||[]}},methods:{showImg:function(e){this.dialogImageUrl=e,this.dialogVisible=!0},picMouseover:function(e){this.showBtnIndex=e},picMouseleave:function(){this.showBtnIndex=null},deletePotoFun:function(e){var t=this;this.$confirm("确定删除吗？").then((function(){t.file_list.splice(e,1),t.$emit("upload",t.file_list)}))},clearAllImage:function(){this.file_list=[]},getAllImage:function(){return this.file_list},cutDown:function(e){var t=this,a=e.file.size/1024/1024<2;if(a){var s=new FormData;s.append("file[]",e.file),s.append("root",this.root),this.$ajax.post("/api/file/uploads",s,this.header).then((function(e){0==e.data.code?(t.file_list.push({url:t.oss_url+e.data.data.url_path[0]}),t.$emit("upload",t.file_list)):t.$message({message:e.data.msg,type:"warning"})}))}else this.$message({message:"上传失败，图片不能大于2M，请重新选择图片",type:"warning"})}}},l=r,n=(a("8234"),a("2877")),c=Object(n["a"])(l,s,i,!1,null,"210a23de",null);t["a"]=c.exports},4091:function(e,t,a){"use strict";var s=a("b6d3"),i=a.n(s);i.a},"42fc":function(e,t,a){},"43fd":function(e,t,a){"use strict";var s=a("e830"),i=a.n(s);i.a},4689:function(e,t,a){"use strict";var s=a("5685"),i=a.n(s);i.a},"47ec":function(e,t,a){},"4dc5":function(e,t,a){"use strict";var s=a("dc00"),i=a.n(s);i.a},"51c8":function(e,t,a){},"522f":function(e,t,a){},5685:function(e,t,a){},"58cb":function(e,t,a){"use strict";var s=a("773f"),i=a.n(s);i.a},"5e49":function(e,t,a){"use strict";var s=a("df61"),i=a.n(s);i.a},"5f5d":function(e,t,a){"use strict";var s=a("1984"),i=a.n(s);i.a},"6ad9":function(e,t,a){},"773f":function(e,t,a){},"81ed":function(e,t,a){"use strict";var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-row",[a("el-col",{attrs:{span:18}},[a("div",{staticClass:"amap-wrapper"},[a("el-amap",{ref:"searchBox",staticClass:"amap-box",attrs:{vid:"amap-vue",center:e.mapCenter,zoom:e.zoom}},e._l(e.markers,(function(t,s){return a("el-amap-marker",{key:"p_"+s,attrs:{position:t.position,events:t.events,vid:s,draggable:!0,label:e.getLable(t)}})})),1)],1)]),a("el-col",{attrs:{span:6}},[a("div",{staticStyle:{padding:"0px 10px 0px 10px",height:"500px",overflow:"auto"}},[a("el-card",{staticClass:"box-card"},[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("el-input",{attrs:{placeholder:"请输入内容"},on:{change:e.searchPoint},model:{value:e.searchAddress,callback:function(t){e.searchAddress=t},expression:"searchAddress"}},[a("i",{staticClass:"el-input__icon el-icon-search",attrs:{slot:"prefix"},slot:"prefix"})])],1),a("el-collapse",{attrs:{accordion:""},on:{change:e.handleChange},model:{value:e.activeNames,callback:function(t){e.activeNames=t},expression:"activeNames"}},e._l(e.points,(function(t,s){return a("el-collapse-item",{key:"m_"+s,attrs:{title:t.name,name:s}},[a("div",{staticStyle:{color:"#c0c4cc"}},[a("div",[e._v(e._s(t.address))]),a("div",[e._v(e._s(t.type))]),a("div",[e._v(e._s(t.tel))]),a("div",{staticStyle:{"text-align":"right"}},[a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(a){return e.clickPoint(t)}}},[e._v("选定该地址")])],1)])])})),1)],1)],1)])],1)},i=[],o=(a("4160"),a("b0c0"),a("ac1f"),a("841c"),a("159b"),{name:"Amap",props:{},watch:{},data:function(){return{city:"柳州",searchAddress:"",selectIndex:0,activeNames:null,zoom:15,points:[],markers:[],searchOption:{city:"柳州"},mapCenter:[109.428608,24.326292],events:{click:function(e){console.info(e)}}}},methods:{concert:function(e){},newLocation:function(e,t){this.city=e,this.searchAddress=t,this.searchPoint()},setLocation:function(e){var t=this;void 0!=e.position&&(this.markers=[e],this.points=[e],this.mapCenter=[e.lng,e.lat],this.zoom=18,this.markers[0].events={click:function(e){t.submitPoint(t.markers[0])},dragend:function(e){console.log("---event---: dragend",e),t.markers[0].position=[e.lnglat.lng,e.lnglat.lat],t.markers[0].lng=e.lnglat.lng,t.markers[0].lat=e.lnglat.lat,t.mapCenter=[e.lnglat.lng,e.lnglat.lat],t.$message.info("坐标被手动更改，单击标点或者点击地址列表上的“标记该地址”进行确认。!!!!!")}})},searchPoint:function(){var e=this,t=new AMap.PlaceSearch({city:this.city?this.city:"柳州"});t.search(this.searchAddress,(function(t,a){console.info(t,a),"error"!=t&&e.onSearchResult(a.poiList.pois)}))},onSearchResult:function(e){var t=this;this.markers=[],this.points=[];this.activeNames=null,e.length>0&&(e.forEach((function(e){var a=e,s=[e.location.lng,e.location.lat];a.position=s,a.lng=e.location.lng,a.lat=e.location.lat,a.events={click:function(e){t.submitPoint(t.markers[0])},dragend:function(e){console.log("---event---: dragend",e),t.markers[0].position=[e.lnglat.lng,e.lnglat.lat],t.markers[0].lng=e.lnglat.lng,t.markers[0].lat=e.lnglat.lat,t.mapCenter=[e.lnglat.lng,e.lnglat.lat],t.$message.info("坐标被手动更改，单击标点或者点击地址列表上的“标记该地址”进行确认。")}},t.points.push(a)})),this.points.length>0&&this.handleChange(0))},clickPoint:function(e){console.info(e),this.submitPoint(e)},getLable:function(e){return{offset:[30,0],content:'<div style="padding:5px;"><h4 style="margin-top:0px">'+e.name+'</h4><div style="padding:3px;">'+e.address+'</div><div style="padding:3px;">'+(e.type?e.type:"")+'</div><div style="padding:3px;">'+(e.tel?e.type:"")+'</div><div style="margin-top:10px;text-align:right;color:#409EFF">可以拖动标点到达指定位置</div></div></div>',direction:"center"}},submitPoint:function(e){console.info(e),this.$emit("chooseLocation",e)},handleChange:function(e){e&&(this.selectIndex=e),this.markers=[];var t=this.points[this.selectIndex];this.mapCenter=[t.lng,t.lat],this.markers.push(t),this.zoom=18}}}),r=o,l=(a("2d79"),a("2877")),n=Object(l["a"])(r,s,i,!1,null,"168252ca",null);t["a"]=n.exports},8234:function(e,t,a){"use strict";var s=a("51c8"),i=a.n(s);i.a},"83d4":function(e,t,a){"use strict";var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-table",{ref:"multipleTable",staticStyle:{width:"100%"},attrs:{data:e.dataList,stripe:""},on:{"selection-change":e.handleSelectionChange,"filter-change":e.filterTagTable,"sort-change":e.sortFilterFun}},[a("el-table-column",{attrs:{type:"selection",width:"55"}}),a("el-table-column",{attrs:{prop:"goods_id",label:"全选/ID",width:"150"}}),a("el-table-column",{attrs:{prop:"name",label:"商品名称",width:"280"}}),a("el-table-column",{attrs:{prop:"goods_class.class_name",label:"分类",width:"200"}}),a("el-table-column",{attrs:{prop:"market_price",sortable:"custom",label:"原价"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.market_price/100)+" ")]}}])}),a("el-table-column",{attrs:{prop:"discount",sortable:"custom",label:"折扣"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.discount)+" % ")]}}])}),a("el-table-column",{attrs:{prop:"price",sortable:"custom",label:"现价"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.price/100)+" ")]}}])}),a("el-table-column",{attrs:{sortable:"custom",label:"排序"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.$index===e.sortingid?a("el-input",{ref:"saveTagInput_"+t.$index,staticClass:"input_pxcss",on:{blur:function(a){return e.percentF(t.row,t.$index)}},model:{value:t.row.sort,callback:function(a){e.$set(t.row,"sort",a)},expression:"scope.row.sort"}}):a("div",{staticClass:"muzhicss",on:{click:function(a){return e.khaki(t.$index,t.row)}}},[a("span",[e._v(e._s(t.row.sort))])])]}}])}),a("el-table-column",{attrs:{prop:"status",label:"状态","filter-multiple":!1,filters:e.statusArr,"filter-placement":"bottom-end","column-key":"status"},scopedSlots:e._u([{key:"default",fn:function(t){return[0==t.row.status?a("span",[e._v("删除")]):1==t.row.status?a("span",[e._v("正常")]):2==t.row.status?a("span",[e._v("下架")]):3==t.row.status?a("span",[e._v("售完")]):e._e()]}}])}),a("el-table-column",{attrs:{label:"操作",width:"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"text",size:"small"},on:{click:function(a){return e.handleClick(t.row)}}},[e._v("查看/编辑")]),a("el-button",{attrs:{type:"text",size:"small"},on:{click:function(a){return e.delClick(t.row)}}},[e._v("删除")])]}}])})],1)],1)},i=[],o=(a("a630"),a("a15b"),a("b0c0"),a("a9e3"),a("d3b7"),a("6062"),a("3ca3"),a("ddb0"),a("2ef0")),r=a.n(o),l={name:"goodsItem",props:{options:Array,merchants:Object},data:function(){return{dataList:[],sortingid:"",sortVal:"",sortStatus:!1,order:"asc",statusArr:[{text:"下架",value:"0"},{text:"售完",value:"1"},{text:"正常",value:"2"},{text:"删除",value:"3"}],multipleSelection:"",nameArr:[]}},watch:{options:{immediate:!0,handler:function(e){this.dataList=r.a.cloneDeep(this.options)}}},mounted:function(){},methods:{khaki:function(e,t){var a=this;this.sortingid=e,this.sortData=Number(t.sort),this.$nextTick((function(){a.$refs["saveTagInput_"+e].focus()}))},percentF:function(e,t){var a=this;if(this.sortData!=e.sort){var s={id:e.goods_id,sort:Number(e.sort),merchant_id:this.merchants.merchant_id,shop_id:this.merchants.shop_id};console.info(s),this.api.goods.goodsSetSort(s).then((function(e){0==e.data.code?(a.sortingid="",a.$message({message:"修改排序成功",type:"success"})):(a.tableListData[t].sort=a.sortData,a.$message({message:"修改排序失败",type:"warning"}))}))}else this.sortingid=""},filterTagTable:function(e){console.info(e),this.filterMethod(e)},filterMethod:function(e){var t=[],a=[];for(var s in e)t.push(s),a.push(e[s]);t=t.join(","),a=a.join(","),this.f_status=a,this.$emit("childFun",this.f_status,"",t,2)},sortMethod:function(e){this.sortVal=e,this.sortStatus=!this.sortStatus,this.sortStatus?this.order="asc":this.order="desc",this.$emit("childFun",this.sortVal,this.order,"",1)},sortFilterFun:function(e){this.sortMethod(e.prop)},handleSelectionChange:function(e){for(var t=[],a=0;a<e.length;a++)t.push(e[a].goods_id),this.nameArr.push(e[a].name);this.multipleSelection=t,this.nameArr=Array.from(new Set(this.nameArr)),this.$emit("childFun",this.multipleSelection,"",this.nameArr,4)},handleClick:function(e){this.$emit("edit",e,!1)},delClick:function(e){this.$emit("childFun",e.goods_id,!0,"删除-"+e.name,3)}}},n=l,c=a("2877"),u=Object(c["a"])(n,s,i,!1,null,"62f265e0",null);t["a"]=u.exports},"85f7":function(e,t,a){},9857:function(e,t,a){"use strict";var s=a("6ad9"),i=a.n(s);i.a},"9d09":function(e,t,a){"use strict";var s=a("522f"),i=a.n(s);i.a},a023:function(e,t,a){e.exports=a.p+"static/img/print1.a8c30706.png"},a434:function(e,t,a){"use strict";var s=a("23e7"),i=a("23cb"),o=a("a691"),r=a("50c4"),l=a("7b0b"),n=a("65f0"),c=a("8418"),u=a("1dde"),d=a("ae40"),m=u("splice"),p=d("splice",{ACCESSORS:!0,0:0,1:2}),h=Math.max,f=Math.min,_=9007199254740991,g="Maximum allowed length exceeded";s({target:"Array",proto:!0,forced:!m||!p},{splice:function(e,t){var a,s,u,d,m,p,b=l(this),v=r(b.length),y=i(e,v),k=arguments.length;if(0===k?a=s=0:1===k?(a=0,s=v-y):(a=k-2,s=f(h(o(t),0),v-y)),v+a-s>_)throw TypeError(g);for(u=n(b,s),d=0;d<s;d++)m=y+d,m in b&&c(u,d,b[m]);if(u.length=s,a<s){for(d=y;d<v-s;d++)m=d+s,p=d+a,m in b?b[p]=b[m]:delete b[p];for(d=v;d>v-s+a;d--)delete b[d-1]}else if(a>s)for(d=v-s;d>y;d--)m=d+s-1,p=d+a-1,m in b?b[p]=b[m]:delete b[p];for(d=0;d<a;d++)b[d+y]=arguments[d+2];return b.length=v-s+a,u}})},a639:function(e,t,a){},b6d3:function(e,t,a){},b9aa:function(e,t,a){"use strict";var s=a("22fc"),i=a.n(s);i.a},baa5:function(e,t,a){var s=a("23e7"),i=a("e58c");s({target:"Array",proto:!0,forced:i!==[].lastIndexOf},{lastIndexOf:i})},c312:function(e,t,a){},c3fd:function(e,t,a){},c755:function(e,t,a){"use strict";var s=a("cc6c"),i=a.n(s);i.a},cc6c:function(e,t,a){},dc00:function(e,t,a){},df61:function(e,t,a){},e41a:function(e,t,a){"use strict";var s=a("42fc"),i=a.n(s);i.a},e830:function(e,t,a){},ec4f:function(e,t,a){"use strict";var s=a("a639"),i=a.n(s);i.a},f29f:function(e,t,a){"use strict";var s=a("c3fd"),i=a.n(s);i.a},f716:function(e,t,a){"use strict";var s=a("85f7"),i=a.n(s);i.a},ff03:function(e,t,a){"use strict";var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"uploadFiles"},[a("el-upload",{directives:[{name:"show",rawName:"v-show",value:""!=this.root,expression:"this.root != ''"}],ref:"upload_file",attrs:{action:"/api/file/uploads","list-type":"picture-card",limit:e.limit,"file-list":e.TfileList,"on-preview":e.handlePictureCardPreview,"http-request":e.uploadImg,"on-change":e.handleChange,"on-success":e.handleSuccess,"before-upload":e.beforeAvatarUpload,"on-exceed":e.exceedFun,"on-remove":e.removeFun}},[a("i",{staticClass:"el-icon-plus"})]),a("h4",{directives:[{name:"show",rawName:"v-show",value:""==this.root,expression:"this.root == ''"}]},[e._v("没有设置路径“root”...")]),a("el-dialog",{attrs:{visible:e.dialogVisible},on:{"update:visible":function(t){e.dialogVisible=t}}},[a("img",{key:e.dialogImageUrl,attrs:{width:"100%",src:e.dialogImageUrl,alt:""}})]),a("el-dialog",{attrs:{title:"提示",visible:e.chaochudialogVisible,width:"30%"},on:{"update:visible":function(t){e.chaochudialogVisible=t}}},[a("span",[e._v(e._s(e.tishi))]),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.chaochudialogVisible=!1}}},[e._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:function(t){e.chaochudialogVisible=!1}}},[e._v("确 定")])],1)])],1)},i=[],o=(a("4160"),a("baa5"),a("b0c0"),a("a9e3"),a("ac1f"),a("1276"),a("159b"),a("96cf"),a("1da1")),r=a("5f87"),l=a("9b15"),n={name:"newUploadFiles",props:{limit:Number,TfileList:Array,shop:Boolean,root:{type:String,default:""}},data:function(){return{header:{headers:{"Content-Type":"multipart/form-data; boundary=--------------------------AAAAA",AccessToken:Object(r["a"])()}},clentSts:{},fileLists:[],dialogImageUrl:"",dialogVisible:!1,chaochudialogVisible:!1,tishi:"",isAdd:!0}},methods:{removeFun:function(e,t){for(var a=[],s=[],i=[],o=0;o<t.length;o++)a=t[o].url.split("/upload"),i[o]="/upload"+a[1],s.push(i[o]);this.isAdd=!1,this.shop||this.$emit("childrenFun",s,this.isAdd)},exceedFun:function(){1==this.limit?(this.chaochudialogVisible=!0,this.tishi="只能上传1张图片，请先删除原有图片，再上传新的图片"):6==this.limit&&(this.chaochudialogVisible=!0,this.tishi="只能上传6张图片，请先删除要替换的图片，再上传新的图片")},handleChange:function(e,t){this.fileLists.push(e.raw)},uploadImg:function(e){var t=this,a=new FormData,s=this;this.fileLists.forEach((function(e){a.append("file[]",e,e.name),a.append("root",s.root)})),this.$ajax.defaults.headers.common["token"]=Object(r["a"])(),this.$ajax.post("/api/file/uploads",a,this.header).then((function(e){t.isAdd=!0;var a=e.data.data.url_path,s=a[a.length-1];1==t.limit?t.$emit("childrenFun",s,t.isAdd):t.shop?t.$emit("childrenFun",a,"0"):t.$emit("childrenFun",a,t.isAdd)}))},handlePictureCardPreview:function(e){this.dialogImageUrl=e.url,this.dialogVisible=!0},getFileSts:function(){var e=this;this.$store.dispatch("shop/getFileSts").then((function(t){e.clentSts=t.data.Credentials}))},handleUploadSTS:function(e){var t=this;return Object(o["a"])(regeneratorRuntime.mark((function a(){var s,i,r,n,c,u;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.prev=0,a.next=3,t.$store.dispatch("shop/getFileSts").then((function(e){return e.data.Credentials}));case 3:return t.clentSts=a.sent,console.log("this.clentSts:",t.clentSts),console.log("option:",e),s=e.file,i=s.name.lastIndexOf("."),r=s.name.substr(i),n="product/"+Date.parse(new Date)+r,c=new l({accessKeyId:t.clentSts.AccessKeyId,accessKeySecret:t.clentSts.AccessKeySecret,stsToken:t.clentSts.SecurityToken,region:"oss-cn-hangzhou",bucket:"ddhi"}),a.next=13,c.multipartUpload(n,s,{progress:function(){var t=Object(o["a"])(regeneratorRuntime.mark((function t(a){var s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:console.log("p:",a),s={},s.percent=100*a,e.onProgress(s);case 4:case"end":return t.stop()}}),t)})));function a(e){return t.apply(this,arguments)}return a}()});case 13:if(u=a.sent,console.log(u),200!==u.res.statusCode){a.next=19;break}return a.abrupt("return",u);case 19:e.onError("上传失败");case 20:a.next=27;break;case 22:a.prev=22,a.t0=a["catch"](0),console.error(a.t0),e.onError("上传失败"),t.$error(a.t0.message);case 27:case"end":return a.stop()}}),a,null,[[0,22]])})))()},handleSuccess:function(e){console.log("response.res.status:",e),200===e.res.status&&console.log("上传了")},beforeAvatarUpload:function(e){var t=e.size/1024/1024<2;return t||this.$message.error("上传图片大小不能超过 2MB!"),t}}},c=n,u=(a("4091"),a("2877")),d=Object(u["a"])(c,s,i,!1,null,"f2a077e6",null);t["a"]=d.exports}}]);
//# sourceMappingURL=chunk-637bb90d.240ce71d.js.map