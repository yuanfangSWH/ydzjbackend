(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-1673f500"],{4091:function(e,t,r){"use strict";var o=r("b6d3"),i=r.n(o);i.a},"7cdb":function(e,t,r){"use strict";var o=r("f473"),i=r.n(o);i.a},a15b:function(e,t,r){"use strict";var o=r("23e7"),i=r("44ad"),s=r("fc6a"),a=r("a640"),n=[].join,l=i!=Object,c=a("join",",");o({target:"Array",proto:!0,forced:l||!c},{join:function(e){return n.call(s(this),void 0===e?",":e)}})},a434:function(e,t,r){"use strict";var o=r("23e7"),i=r("23cb"),s=r("a691"),a=r("50c4"),n=r("7b0b"),l=r("65f0"),c=r("8418"),u=r("1dde"),m=r("ae40"),d=u("splice"),p=m("splice",{ACCESSORS:!0,0:0,1:2}),h=Math.max,f=Math.min,g=9007199254740991,b="Maximum allowed length exceeded";o({target:"Array",proto:!0,forced:!d||!p},{splice:function(e,t){var r,o,u,m,d,p,v=n(this),F=a(v.length),_=i(e,F),C=arguments.length;if(0===C?r=o=0:1===C?(r=0,o=F-_):(r=C-2,o=f(h(s(t),0),F-_)),F+r-o>g)throw TypeError(b);for(u=l(v,o),m=0;m<o;m++)d=_+m,d in v&&c(u,m,v[d]);if(u.length=o,r<o){for(m=_;m<F-o;m++)d=m+o,p=m+r,d in v?v[p]=v[d]:delete v[p];for(m=F;m>F-o+r;m--)delete v[m-1]}else if(r>o)for(m=F-o;m>_;m--)d=m+o-1,p=m+r-1,d in v?v[p]=v[d]:delete v[p];for(m=0;m<r;m++)v[m+_]=arguments[m+2];return v.length=F-o+r,u}})},b6d3:function(e,t,r){},baa5:function(e,t,r){var o=r("23e7"),i=r("e58c");o({target:"Array",proto:!0,forced:i!==[].lastIndexOf},{lastIndexOf:i})},c04a:function(e,t,r){"use strict";r.r(t);var o=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"shopSet"},[r("div",{staticClass:"page-title"},[e._v(e._s(this._getVuex("pageTitle")))]),r("div",{staticClass:"formBox"},[r("el-form",{ref:"ruleForm",staticClass:"demo-ruleForm",attrs:{model:e.ruleForm,rules:e.rules,"label-width":"130px"}},[r("el-form-item",{attrs:{label:"套餐名称",prop:"name"}},[r("el-input",{staticClass:"gb-ipt",attrs:{placeholder:"请输入套餐名"},model:{value:e.ruleForm.name,callback:function(t){e.$set(e.ruleForm,"name",t)},expression:"ruleForm.name"}})],1),r("el-form-item",{attrs:{label:"副标题",prop:"alias"}},[r("el-input",{staticClass:"gb-ipt",attrs:{placeholder:"请输入套餐副标题"},model:{value:e.ruleForm.alias,callback:function(t){e.$set(e.ruleForm,"alias",t)},expression:"ruleForm.alias"}})],1),r("el-form-item",{attrs:{label:"商品分类",prop:"class_id"}},[r("el-select",{attrs:{placeholder:"请选择商品分类"},model:{value:e.ruleForm.class_id,callback:function(t){e.$set(e.ruleForm,"class_id",t)},expression:"ruleForm.class_id"}},e._l(e.options,(function(e,t){return r("el-option",{key:t,attrs:{label:e.class_name,value:e.class_id}})})),1)],1),r("el-form-item",{attrs:{label:"套餐原价",prop:"m_price"}},[r("el-input",{staticClass:"gb-ipt",attrs:{placeholder:"请输入套餐原价"},model:{value:e.ruleForm.m_price,callback:function(t){e.$set(e.ruleForm,"m_price",t)},expression:"ruleForm.m_price"}})],1),r("el-form-item",{attrs:{label:"折扣",prop:"discount"}},[r("el-input",{staticClass:"gb-ipt",model:{value:e.ruleForm.discount,callback:function(t){e.$set(e.ruleForm,"discount",t)},expression:"ruleForm.discount"}}),r("span",{staticClass:"form-shan"},[e._v("折 "),r("i",{staticStyle:{color:"#aaaaaa","font-style":"normal"}},[e._v("（例：98折，输入98）")])])],1),r("el-form-item",{attrs:{label:"套餐价格",required:""}},[r("el-input",{staticClass:"gb-ipt",attrs:{placeholder:"请输入套餐价格"},model:{value:e.computedPrice,callback:function(t){e.computedPrice=t},expression:"computedPrice"}})],1),r("el-form-item",{attrs:{label:"套餐组合",prop:"combo"}},e._l(e.ruleForm.combo,(function(t,o){return r("div",{key:o,staticClass:"groupBox"},[r("el-autocomplete",{staticClass:"inline-input",attrs:{"fetch-suggestions":e.querySearch,placeholder:"请输入商品名称","trigger-on-focus":!1},on:{select:e.handleSelect,input:function(t){return e.inputFun(o)}},model:{value:e.ruleForm.combo[o].name,callback:function(t){e.$set(e.ruleForm.combo[o],"name",t)},expression:"ruleForm.combo[i].name"}}),r("div",[r("el-input-number",{staticClass:"num-ipt",attrs:{"controls-position":"right",min:1},on:{change:e.handleChange},model:{value:e.ruleForm.combo[o].num,callback:function(t){e.$set(e.ruleForm.combo[o],"num",t)},expression:"ruleForm.combo[i].num"}})],1),r("el-input",{staticClass:"danwei-ipt",attrs:{placeholder:"单位"},model:{value:e.ruleForm.combo[o].unit,callback:function(t){e.$set(e.ruleForm.combo[o],"unit",t)},expression:"ruleForm.combo[i].unit"}}),o==e.ruleForm.combo.length-1?r("i",{staticClass:"add-icon el-icon-circle-plus",on:{click:function(t){return e.addGoodsDetail(o)}}}):r("i",{staticClass:"close-icon el-icon-error",on:{click:function(t){return e.removeGoodsDetail(o)}}})],1)})),0),r("el-form-item",{attrs:{label:"套餐组合",prop:"image"}},[r("uploadFiles",{staticClass:"uploadTemp",attrs:{limit:e.limit,root:"goods"},on:{childrenFun:e.parentFun}}),r("span",{staticClass:"zhushi"},[e._v("（请上传100*100的图片尺寸，不得超过2M，不得超过6张）")])],1),r("el-form-item",{attrs:{label:"排序",prop:"sort"}},[r("el-input",{staticClass:"gb-ipt",attrs:{placeholder:"请输入套餐排序"},model:{value:e.ruleForm.sort,callback:function(t){e.$set(e.ruleForm,"sort",t)},expression:"ruleForm.sort"}})],1),r("el-form-item",{attrs:{label:"状态",prop:"status"}},[r("el-radio-group",{model:{value:e.ruleForm.status,callback:function(t){e.$set(e.ruleForm,"status",t)},expression:"ruleForm.status"}},[r("el-radio",{attrs:{label:1}},[e._v("上架")]),r("el-radio",{attrs:{label:2}},[e._v("下架")])],1)],1),r("el-form-item",[r("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitForm("ruleForm")}}},[e._v("保存")]),r("el-button",{on:{click:function(t){return e.resetForm("ruleForm")}}},[e._v("重置")])],1)],1)],1)])},i=[],s=(r("a15b"),r("d81d"),r("a434"),r("b0c0"),r("a9e3"),r("ff03")),a=r("2ef0"),n=r.n(a),l={name:"addGroupGoods",components:{uploadFiles:s["a"]},data:function(){return{merchant_id:"",shop_id:"",ruleForm:{class_id:"",name:"",alias:"",price:"",discount:"",unit:"",image:"",images:1,status:1,market_price:"",m_price:"",sort:0,combo:[{name:"",num:0,unit:""}],is_combo:1},rules:{name:[{required:!0,message:"请输入套餐名称",trigger:"blur"}],class_id:[{required:!0,message:"请选择商品分类",trigger:"change"}],market_price:[{required:!0,message:"请输入套餐原价",trigger:"blur"}],price:[{required:!0,message:"请输入套餐价格",trigger:"blur"}],combo:[{required:!0,message:"请输入套餐组合信息",trigger:"blur"}],image:[{required:!0,message:"请上传套餐图片",trigger:"on-change"}]},value1:"",value2:"",limit:6,restaurants:[],options:[]}},created:function(){this.iniPageParam(),this.getGoodsClass()},computed:{computedPrice:function(){return""==this.ruleForm.discount?this.ruleForm.m_price:Number(this.ruleForm.m_price)*Number(this.ruleForm.discount)/100}},methods:{iniPageParam:function(){this.merchant_id=this.$route.query.merchant_id,this.shop_id=this.$route.query.shop_id},querySearch:function(e,t){var r=this.restaurants;t(r)},handleSelect:function(e){},inputFun:function(e){var t=this,r={name:this.ruleForm.combo[e].name,merchant_id:this.merchant_id,shop_id:this.shop_id};this.$store.dispatch("goods/getGroupBuySelectGoods",r).then((function(e){var r=[];e.data.map((function(e){r.push({value:e.name})})),t.restaurants=r}))},handleChange:function(e){console.log(e)},submitForm:function(e){var t=this;this.$refs[e].validate((function(e){if(!e)return console.log("error submit!!"),!1;var r=n.a.cloneDeep(t.ruleForm);r.shop_id=t.shop_id,r.merchant_id=t.merchant_id,r.discount=Number(r.discount),r.market_price=100*Number(r.m_price),r.sort=Number(r.sort),r.price=100*Number(t.computedPrice),t.$store.dispatch("goods/addGoods",r).then((function(e){t.$message({message:""+e.msg,type:"success"}),t.$router.push({path:"/shopInfo",query:{shop_id:t.shop_id,merchant_id:t.merchant_id,tab:"shopGoods"}})}))}))},resetForm:function(e){this.$refs[e].resetFields()},parentFun:function(e){var t=[];t=e,this.ruleForm.image=t.join(",")},addGoodsDetail:function(e){this.ruleForm.combo.push({name:"",num:1,unit:""})},removeGoodsDetail:function(e){this.ruleForm.combo.splice(e,1)},getGoodsClass:function(){var e=this,t={page_size:1e4,shop_id:this.shop_id,merchant_id:this.merchant_id};this.$store.dispatch("goods/getGoodsClass",t).then((function(t){e.options=t.data}))},addSummary:function(e){this.ruleForm.summary.push({item_name:"",item_content:""})},removeSummary:function(e){this.ruleForm.summary.splice(e,1)}}},c=l,u=(r("7cdb"),r("2877")),m=Object(u["a"])(c,o,i,!1,null,"0ac8d82d",null);t["default"]=m.exports},f473:function(e,t,r){},ff03:function(e,t,r){"use strict";var o=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"uploadFiles"},[r("el-upload",{directives:[{name:"show",rawName:"v-show",value:""!=this.root,expression:"this.root != ''"}],ref:"upload_file",attrs:{action:"/api/file/uploads","list-type":"picture-card",limit:e.limit,"file-list":e.TfileList,"on-preview":e.handlePictureCardPreview,"http-request":e.uploadImg,"on-change":e.handleChange,"on-success":e.handleSuccess,"before-upload":e.beforeAvatarUpload,"on-exceed":e.exceedFun,"on-remove":e.removeFun}},[r("i",{staticClass:"el-icon-plus"})]),r("h4",{directives:[{name:"show",rawName:"v-show",value:""==this.root,expression:"this.root == ''"}]},[e._v("没有设置路径“root”...")]),r("el-dialog",{attrs:{visible:e.dialogVisible},on:{"update:visible":function(t){e.dialogVisible=t}}},[r("img",{key:e.dialogImageUrl,attrs:{width:"100%",src:e.dialogImageUrl,alt:""}})]),r("el-dialog",{attrs:{title:"提示",visible:e.chaochudialogVisible,width:"30%"},on:{"update:visible":function(t){e.chaochudialogVisible=t}}},[r("span",[e._v(e._s(e.tishi))]),r("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{on:{click:function(t){e.chaochudialogVisible=!1}}},[e._v("取 消")]),r("el-button",{attrs:{type:"primary"},on:{click:function(t){e.chaochudialogVisible=!1}}},[e._v("确 定")])],1)])],1)},i=[],s=(r("4160"),r("baa5"),r("b0c0"),r("a9e3"),r("ac1f"),r("1276"),r("159b"),r("96cf"),r("1da1")),a=r("5f87"),n=r("9b15"),l={name:"newUploadFiles",props:{limit:Number,TfileList:Array,shop:Boolean,root:{type:String,default:""}},data:function(){return{header:{headers:{"Content-Type":"multipart/form-data; boundary=--------------------------AAAAA",AccessToken:Object(a["a"])()}},clentSts:{},fileLists:[],dialogImageUrl:"",dialogVisible:!1,chaochudialogVisible:!1,tishi:"",isAdd:!0}},methods:{removeFun:function(e,t){for(var r=[],o=[],i=[],s=0;s<t.length;s++)r=t[s].url.split("/upload"),i[s]="/upload"+r[1],o.push(i[s]);this.isAdd=!1,this.shop||this.$emit("childrenFun",o,this.isAdd)},exceedFun:function(){1==this.limit?(this.chaochudialogVisible=!0,this.tishi="只能上传1张图片，请先删除原有图片，再上传新的图片"):6==this.limit&&(this.chaochudialogVisible=!0,this.tishi="只能上传6张图片，请先删除要替换的图片，再上传新的图片")},handleChange:function(e,t){this.fileLists.push(e.raw)},uploadImg:function(e){var t=this,r=new FormData,o=this;this.fileLists.forEach((function(e){r.append("file[]",e,e.name),r.append("root",o.root)})),this.$ajax.defaults.headers.common["token"]=Object(a["a"])(),this.$ajax.post("/api/file/uploads",r,this.header).then((function(e){t.isAdd=!0;var r=e.data.data.url_path,o=r[r.length-1];1==t.limit?t.$emit("childrenFun",o,t.isAdd):t.shop?t.$emit("childrenFun",r,"0"):t.$emit("childrenFun",r,t.isAdd)}))},handlePictureCardPreview:function(e){this.dialogImageUrl=e.url,this.dialogVisible=!0},getFileSts:function(){var e=this;this.$store.dispatch("shop/getFileSts").then((function(t){e.clentSts=t.data.Credentials}))},handleUploadSTS:function(e){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function r(){var o,i,a,l,c,u;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,t.$store.dispatch("shop/getFileSts").then((function(e){return e.data.Credentials}));case 3:return t.clentSts=r.sent,console.log("this.clentSts:",t.clentSts),console.log("option:",e),o=e.file,i=o.name.lastIndexOf("."),a=o.name.substr(i),l="product/"+Date.parse(new Date)+a,c=new n({accessKeyId:t.clentSts.AccessKeyId,accessKeySecret:t.clentSts.AccessKeySecret,stsToken:t.clentSts.SecurityToken,region:"oss-cn-hangzhou",bucket:"ddhi"}),r.next=13,c.multipartUpload(l,o,{progress:function(){var t=Object(s["a"])(regeneratorRuntime.mark((function t(r){var o;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:console.log("p:",r),o={},o.percent=100*r,e.onProgress(o);case 4:case"end":return t.stop()}}),t)})));function r(e){return t.apply(this,arguments)}return r}()});case 13:if(u=r.sent,console.log(u),200!==u.res.statusCode){r.next=19;break}return r.abrupt("return",u);case 19:e.onError("上传失败");case 20:r.next=27;break;case 22:r.prev=22,r.t0=r["catch"](0),console.error(r.t0),e.onError("上传失败"),t.$error(r.t0.message);case 27:case"end":return r.stop()}}),r,null,[[0,22]])})))()},handleSuccess:function(e){console.log("response.res.status:",e),200===e.res.status&&console.log("上传了")},beforeAvatarUpload:function(e){var t=e.size/1024/1024<2;return t||this.$message.error("上传图片大小不能超过 2MB!"),t}}},c=l,u=(r("4091"),r("2877")),m=Object(u["a"])(c,o,i,!1,null,"f2a077e6",null);t["a"]=m.exports}}]);
//# sourceMappingURL=chunk-1673f500.f5493575.js.map