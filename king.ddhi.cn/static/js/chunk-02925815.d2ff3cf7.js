(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-02925815"],{"3cae":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"appBox"},["IOS"==e.ruleForm.platform?a("div",[a("div",{staticClass:"page-title"},[e._v("新增IOS版本")]),a("el-form",{ref:"ruleForm",staticClass:"demo-ruleForm",attrs:{model:e.ruleForm,rules:e.rules,"label-width":"120px"}},[a("el-form-item",{attrs:{label:"包名",prop:"name"}},[a("el-input",{staticClass:"formIpt",attrs:{placeholder:"请输入包名",clearable:""},model:{value:e.ruleForm.name,callback:function(t){e.$set(e.ruleForm,"name",t)},expression:"ruleForm.name"}})],1),a("el-form-item",{attrs:{label:"版本号",prop:"version"}},[a("el-input",{staticClass:"formIpt",attrs:{placeholder:"请输入版本号，例：1.0.0",clearable:""},model:{value:e.ruleForm.version,callback:function(t){e.$set(e.ruleForm,"version",t)},expression:"ruleForm.version"}})],1),a("el-form-item",{attrs:{label:"更新内容",prop:"summary"}},[a("el-input",{staticClass:"formIpt",attrs:{type:"textarea",clearable:"",autosize:{minRows:2,maxRows:10},placeholder:"填写版本更新内容"},model:{value:e.ruleForm.summary,callback:function(t){e.$set(e.ruleForm,"summary",t)},expression:"ruleForm.summary"}})],1),a("el-form-item",{attrs:{label:"审核中"}},[a("el-switch",{attrs:{"active-color":"#ffbe11","inactive-color":"#d9d9d9",disabled:e.isChecksh},on:{change:e.switchInreview},model:{value:e.value4,callback:function(t){e.value4=t},expression:"value4"}})],1),a("el-form-item",{attrs:{label:"强制更新",prop:"coerce_update"}},[a("el-switch",{attrs:{"active-color":"#ffbe11","inactive-color":"#d9d9d9",disabled:e.isCheck},on:{change:e.switchCoerce},model:{value:e.value1,callback:function(t){e.value1=t},expression:"value1"}})],1),a("el-form-item",{attrs:{label:"提示更新",prop:"prompt_update"}},[a("el-switch",{attrs:{"active-color":"#ffbe11","inactive-color":"#d9d9d9",disabled:e.isCheck},on:{change:e.switchPrompt},model:{value:e.value2,callback:function(t){e.value2=t},expression:"value2"}})],1),a("el-form-item",{attrs:{label:"是否发布",prop:"status"}},[a("el-switch",{attrs:{"active-color":"#ffbe11","inactive-color":"#d9d9d9"},on:{change:e.switchStatus},model:{value:e.value3,callback:function(t){e.value3=t},expression:"value3"}})],1),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitForm("ruleForm")}}},[e._v("确定")]),a("el-button",{on:{click:function(t){return e.resetForm("ruleForm")}}},[e._v("取消")])],1)],1)],1):a("div",[a("div",{staticClass:"page-title"},[e._v("新增Android版本")]),a("el-form",{ref:"ruleForm",staticClass:"demo-ruleForm",attrs:{model:e.ruleForm,rules:e.rules,"label-width":"120px"}},[a("el-form-item",{attrs:{label:"包名",prop:"name"}},[a("el-input",{staticClass:"formIpt",attrs:{placeholder:"请输入包名",clearable:""},model:{value:e.ruleForm.name,callback:function(t){e.$set(e.ruleForm,"name",t)},expression:"ruleForm.name"}})],1),a("el-form-item",{attrs:{label:"版本号",prop:"version"}},[a("el-input",{staticClass:"formIpt",attrs:{placeholder:"请输入版本号，例100",clearable:""},model:{value:e.ruleForm.version,callback:function(t){e.$set(e.ruleForm,"version",t)},expression:"ruleForm.version"}})],1),a("el-form-item",{attrs:{label:"更新内容",prop:"summary"}},[a("el-input",{staticClass:"formIpt",attrs:{type:"textarea",clearable:"",autosize:{minRows:2,maxRows:10},placeholder:"填写版本更新内容"},model:{value:e.ruleForm.summary,callback:function(t){e.$set(e.ruleForm,"summary",t)},expression:"ruleForm.summary"}})],1),a("el-form-item",{attrs:{label:"渠道",prop:"channel"}},[a("el-input",{staticClass:"formIpt",attrs:{placeholder:"请输入渠道，例：100",clearable:""},model:{value:e.ruleForm.channel,callback:function(t){e.$set(e.ruleForm,"channel",t)},expression:"ruleForm.channel"}}),a("div",{staticClass:"zhushi"},[e._v("(注：夜店之家-100；应用宝-101；360-102；华为-103；小米-104；OPPO-105；VIVO-106；魅族-107)")])],1),a("el-form-item",{attrs:{label:"上传包",required:""}},[a("el-col",{attrs:{span:6}},[a("el-form-item",{attrs:{prop:"url"}},[a("el-upload",{staticClass:"upload-demo",attrs:{action:"/file/uploads","on-preview":e.handlePreview,"on-remove":e.handleRemove,"before-upload":e.beforeAvatarUpload,"on-change":e.handleChange,"http-request":e.uploadFile,multiple:!1,limit:1,"on-exceed":e.handleExceed,"file-list":e.fileList,data:{root:"app"}}},[a("el-button",{attrs:{size:"small",type:"primary"}},[e._v("选择文件")]),a("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[a("div",[e._v(e._s(e.textInfo))]),a("div",{staticClass:"tipText"},[e._v("注：包名的命名规则必须为（"),a("b",[e._v("包名_渠道_版本号")]),e._v(".apk）")])])],1)],1)],1)],1),a("el-form-item",{attrs:{label:"强制更新",prop:"coerce_update"}},[a("el-switch",{attrs:{"active-color":"#ffbe11","inactive-color":"#d9d9d9"},on:{change:e.switchCoerce},model:{value:e.value1,callback:function(t){e.value1=t},expression:"value1"}})],1),a("el-form-item",{attrs:{label:"提示更新",prop:"prompt_update"}},[a("el-switch",{attrs:{"active-color":"#ffbe11","inactive-color":"#d9d9d9"},on:{change:e.switchPrompt},model:{value:e.value2,callback:function(t){e.value2=t},expression:"value2"}})],1),a("el-form-item",{attrs:{label:"是否发布",prop:"status"}},[a("el-switch",{attrs:{"active-color":"#ffbe11","inactive-color":"#d9d9d9"},on:{change:e.switchStatus},model:{value:e.value3,callback:function(t){e.value3=t},expression:"value3"}})],1),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitForm("ruleForm")}}},[e._v("确定")]),a("el-button",{on:{click:function(t){return e.resetForm("ruleForm")}}},[e._v("取消")])],1)],1)],1)])},s=[],l=(a("99af"),a("c975"),a("b0c0"),a("ac1f"),a("1276"),a("96cf"),a("1da1")),i=a("5f87"),o=(a("bc3a"),{data:function(){return{ruleForm:{name:"",version:"",summary:"",channel:"",url:"",coerce_update:0,prompt_update:0,platform:"IOS",status:1,in_review:0},rules:{name:[{required:!0,message:"请输入包名",trigger:"blur"}],version:[{required:!0,message:"请输入版本号，例1.0.0",trigger:"blur"}],summary:[{required:!0,message:"请输入更新内容",trigger:"blur"}],channel:[{required:!0,message:"请输入渠道，例：100",trigger:"blur"}],url:[{required:!0,message:"请先上传包",trigger:"blur"}]},value1:!1,value2:!1,value3:!0,value4:!1,fileList:[],header:{headers:{"Content-Type":"multipart/form-data; boundary=--------------------------AAAAA",AccessToken:Object(i["a"])()}},DataImg:[],fileData:"",textInfo:"未选择任何文件",myDate:"",year:"",month:"",date:"",hours:"",minutes:"",seconds:"",weekend:"",weeks:[],day:"",loading:"",apkArr:[],isChecksh:!1,isCheck:!1}},created:function(){this.$route.query.platform&&(this.ruleForm.platform=this.$route.query.platform),this.changeTime()},methods:{changeTime:function(){this.myDate=new Date,this.year=this.myDate.getFullYear(),this.month=this.myDate.getMonth()+1,this.date=this.myDate.getDate(),this.hours=this.myDate.getHours(),this.minutes=this.myDate.getMinutes(),this.seconds=this.myDate.getSeconds(),this.weekend=this.myDate.getDay(),this.weeks=new Array("星期日","星期一","星期二","星期三","星期四","星期五","星期六"),this.day=this.weeks[this.weekend],this.month<10&&(this.month="0"+this.month),this.date<10&&(this.date="0"+this.date),this.hours<10&&(this.hours="0"+this.hours),this.minutes<10&&(this.minutes="0"+this.minutes),this.seconds<10&&(this.seconds="0"+this.seconds)},switchCoerce:function(e){e?(this.isChecksh=!0,this.value4=!1,this.value2=!1):this.isChecksh=!1,this.ruleForm.coerce_update=this.value1?1:0,this.ruleForm.prompt_update=this.value1?0:1},switchPrompt:function(e){e?(this.isChecksh=!0,this.value4=!1,this.value1=!1):this.isChecksh=!1,this.ruleForm.prompt_update=this.value2?1:0,this.ruleForm.coerce_update=this.value2?0:1},switchStatus:function(e){this.ruleForm.status=this.value3?1:0},switchInreview:function(e){e?(this.isCheck=!0,this.value1=!1,this.value2=!1):this.isCheck=!1,this.ruleForm.in_review=this.value4?1:0},submitForm:function(e){var t=this;this.$refs[e].validate((function(e){if(!e)return console.log("error submit!!"),!1;var a=t.ruleForm;if("IOS"==t.ruleForm.platform)delete a.channel,delete a.url,t.api.appmanage.addApp(a).then((function(e){t.$message({message:""+e.data.msg,type:"success"}),t.$router.push("/appList")}));else if(3!=t.apkArr.length)t.$message({message:"apk包的命名规则不对哦",type:"error"});else if(3==t.apkArr.length){var r=/^\d+$/.test(t.apkArr[1]);r?(delete a.in_review,t.api.appmanage.addApp(a).then((function(e){t.$message({message:""+e.data.msg,type:"success"}),t.$router.push("/appList")}))):t.$message({message:"apk包的命名规则不对哦",type:"error"})}}))},resetForm:function(e){this.$refs[e].resetFields(),this.$router.push("/appList")},handleRemove:function(e,t){},handlePreview:function(e){},handleExceed:function(e,t){this.$message.warning("当前限制选择 1 个文件，本次选择了 ".concat(e.length," 个文件，共选择了 ").concat(e.length+t.length," 个文件"))},handleChange:function(e,t){this.fileData=e,this.DataImg.push(e.raw)},beforeAvatarUpload:function(e){var t=e.name.split(".")[e.name.split(".").length-1],a="apk"===t;return a||this.$message.error("上传包文件只能是 apk 格式!"),a},uploadFile:function(e){var t=this;t.fileList=[];var r={};this.api.appmanage.getfileSts(r).then((function(r){t.openFullScreen();var s=a("9b15"),i=new s({accessKeyId:r.data.data.Credentials.AccessKeyId,accessKeySecret:r.data.data.Credentials.AccessKeySecret,stsToken:r.data.data.Credentials.SecurityToken,bucket:"ddhi"});function o(){return n.apply(this,arguments)}function n(){return n=Object(l["a"])(regeneratorRuntime.mark((function a(){var r,s;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.prev=0,a.next=3,i.put("app/"+t.year+"/"+t.month+"/"+t.date+"/"+e.file.name,e.file);case 3:r=a.sent,r.url&&(t.loading.close(),t.textInfo="文件已上传成功"),t.ruleForm.url=r.url,s=r.url,-1!=s.indexOf("/")&&(t.apkArr=s.split("/")),-1!=s.indexOf(".apk")&&(t.apkArr=t.apkArr[t.apkArr.length-1].split(".apk")),t.ruleForm.name=t.apkArr[0],-1!=s.indexOf("_")&&(t.apkArr=t.apkArr[0].split("_")),t.ruleForm.channel=t.apkArr[1],t.ruleForm.version=t.apkArr[2],t.fileList.push({name:e.file.name,url:r.url}),a.next=19;break;case 16:a.prev=16,a.t0=a["catch"](0),console.error("error:",a.t0);case 19:case"end":return a.stop()}}),a,null,[[0,16]])}))),n.apply(this,arguments)}o()}))},openFullScreen:function(){this.loading=this.$loading({lock:!0,text:"文件正在上传，请稍后...",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"})}}}),n=o,u=(a("b527"),a("2877")),c=Object(u["a"])(n,r,s,!1,null,"e84bd846",null);t["default"]=c.exports},b527:function(e,t,a){"use strict";var r=a("d0d0"),s=a.n(r);s.a},d0d0:function(e,t,a){}}]);
//# sourceMappingURL=chunk-02925815.d2ff3cf7.js.map