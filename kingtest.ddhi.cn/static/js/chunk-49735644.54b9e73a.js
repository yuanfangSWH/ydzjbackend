(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-49735644"],{4091:function(e,t,r){"use strict";var i=r("b6d3"),o=r.n(i);o.a},8068:function(e,t,r){},"89e6":function(e,t,r){"use strict";r.r(t);var i=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"shopSet"},[r("div",{staticClass:"page-title"},[e._v(e._s(this._getVuex("pageTitle")))]),r("div",{staticClass:"formBox"},[r("el-form",{ref:"ruleForm",staticClass:"demo-ruleForm",attrs:{model:e.ruleForm,rules:e.rules,"label-width":"130px"}},[r("el-form-item",{attrs:{label:"套餐名称",prop:"name"}},[r("el-input",{staticClass:"gb-ipt",attrs:{placeholder:"请输入套餐名"},model:{value:e.ruleForm.name,callback:function(t){e.$set(e.ruleForm,"name",t)},expression:"ruleForm.name"}})],1),r("el-form-item",{attrs:{label:"副标题",prop:"alias"}},[r("el-input",{staticClass:"gb-ipt",attrs:{placeholder:"请输入套餐副标题"},model:{value:e.ruleForm.alias,callback:function(t){e.$set(e.ruleForm,"alias",t)},expression:"ruleForm.alias"}})],1),r("el-form-item",{attrs:{label:"商品分类",prop:"class_id"}},[r("el-select",{attrs:{placeholder:"请选择商品分类"},model:{value:e.ruleForm.class_id,callback:function(t){e.$set(e.ruleForm,"class_id",t)},expression:"ruleForm.class_id"}},e._l(e.options,(function(e,t){return r("el-option",{key:t,attrs:{label:e.class_name,value:e.class_id}})})),1)],1),r("el-form-item",{attrs:{label:"套餐原价",prop:"market_price"}},[r("el-input",{staticClass:"gb-ipt",attrs:{placeholder:"请输入套餐原价"},model:{value:e.ruleForm.market_price,callback:function(t){e.$set(e.ruleForm,"market_price",t)},expression:"ruleForm.market_price"}})],1),r("el-form-item",{attrs:{label:"折扣",prop:"discount"}},[r("el-input",{staticClass:"gb-ipt",model:{value:e.ruleForm.discount,callback:function(t){e.$set(e.ruleForm,"discount",t)},expression:"ruleForm.discount"}}),r("span",{staticClass:"form-shan"},[e._v("折 "),r("i",{staticStyle:{color:"#aaaaaa","font-style":"normal"}},[e._v("（例：98折，输入98）")])])],1),r("el-form-item",{attrs:{label:"套餐价格",required:""}},[r("el-input",{staticClass:"gb-ipt",attrs:{placeholder:"请输入套餐价格"},model:{value:e.computedPrice,callback:function(t){e.computedPrice=t},expression:"computedPrice"}})],1),r("el-form-item",{attrs:{label:"套餐组合",prop:"combo"}},e._l(e.ruleForm.combo,(function(t,i){return r("div",{key:i,staticClass:"groupBox"},[r("el-autocomplete",{staticClass:"inline-input",attrs:{"fetch-suggestions":e.querySearch,placeholder:"请输入商品名称","trigger-on-focus":!1},on:{select:e.handleSelect,input:function(t){return e.inputFun(i)}},model:{value:e.ruleForm.combo[i].name,callback:function(t){e.$set(e.ruleForm.combo[i],"name",t)},expression:"ruleForm.combo[i].name"}}),r("div",[r("el-input-number",{staticClass:"num-ipt",attrs:{"controls-position":"right",min:1},on:{change:e.handleChange},model:{value:e.ruleForm.combo[i].num,callback:function(t){e.$set(e.ruleForm.combo[i],"num",t)},expression:"ruleForm.combo[i].num"}})],1),r("el-input",{staticClass:"danwei-ipt",attrs:{placeholder:"单位"},model:{value:e.ruleForm.combo[i].unit,callback:function(t){e.$set(e.ruleForm.combo[i],"unit",t)},expression:"ruleForm.combo[i].unit"}}),i==e.ruleForm.combo.length-1?r("i",{staticClass:"add-icon el-icon-circle-plus",on:{click:function(t){return e.addGoodsDetail(i)}}}):r("i",{staticClass:"close-icon el-icon-error",on:{click:function(t){return e.removeGoodsDetail(i)}}})],1)})),0),r("el-form-item",{attrs:{label:"套餐组合",prop:"image"}},[r("uploadFiles",{staticClass:"uploadTemp",attrs:{limit:e.limit,TfileList:e.fileList,root:"goods"},on:{childrenFun:e.parentFun}}),r("span",{staticClass:"zhushi"},[e._v("（请上传100*100的图片尺寸，不得超过2M，不得超过 "+e._s(e.limit)+" 张）")])],1),r("el-form-item",{attrs:{label:"排序",prop:"sort"}},[r("el-input",{staticClass:"gb-ipt",attrs:{placeholder:"请输入套餐排序"},model:{value:e.ruleForm.sort,callback:function(t){e.$set(e.ruleForm,"sort",t)},expression:"ruleForm.sort"}})],1),r("el-form-item",{attrs:{label:"状态",prop:"status"}},[r("el-radio-group",{model:{value:e.ruleForm.status,callback:function(t){e.$set(e.ruleForm,"status",t)},expression:"ruleForm.status"}},[r("el-radio",{attrs:{label:1}},[e._v("上架")]),r("el-radio",{attrs:{label:2}},[e._v("下架")])],1)],1),r("el-form-item",[r("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitForm("ruleForm")}}},[e._v("保存")]),r("el-button",{on:{click:function(t){return e.resetForm("ruleForm")}}},[e._v("重置")])],1)],1)],1)])},o=[],s=(r("4160"),r("a15b"),r("d81d"),r("a434"),r("b0c0"),r("a9e3"),r("ac1f"),r("1276"),r("159b"),r("ff03")),a=r("2ef0"),l=r.n(a),n={name:"editGroupGoods",components:{uploadFiles:s["a"]},data:function(){return{merchant_id:"",shop_id:"",ruleForm:{goods_id:"",class_id:"",name:"",alias:"",price:"",discount:"",unit:"",image:"",images:1,status:1,market_price:"",m_price:"",sort:0,combo:[],is_combo:1},rules:{name:[{required:!0,message:"请输入套餐名称",trigger:"blur"}],class_id:[{required:!0,message:"请选择商品分类",trigger:"change"}],market_price:[{required:!0,message:"请输入套餐原价",trigger:"blur"}],price:[{required:!0,message:"请输入套餐价格",trigger:"blur"}],combo:[{required:!0,message:"请输入套餐组合信息",trigger:"blur"}],image:[{required:!0,message:"请上传套餐图片",trigger:"on-change"}]},value1:[],value2:[],limit:6,restaurants:[],options:[],imgArr:[],fileList:[],isAddImg:!1}},created:function(){this.iniPageParam(),this.getGoodsClass(),this.ruleForm.goods_id=this.$route.query.goods_id,this.ruleForm.goods_id&&this.getGoodsDetaile()},computed:{computedPrice:function(){return""==this.ruleForm.discount?this.ruleForm.market_price:Number(this.ruleForm.market_price)*Number(this.ruleForm.discount)/100}},methods:{iniPageParam:function(){this.merchant_id=this.$route.query.merchant_id,this.shop_id=this.$route.query.shop_id},getGoodsDetaile:function(){var e=this,t={id:this.ruleForm.goods_id,merchant_id:this.merchant_id,shop_id:this.shop_id};this.$store.dispatch("goods/getGoodsDetail",t).then((function(t){e.ruleForm=t.data;var r=e.ruleForm.image;e.imgArr=r.split(","),e.imgArr.forEach((function(t){var r=new Object;r.url=t,e.fileList.push(r)})),e.ruleForm.combo=e.ruleForm.combo?JSON.parse(e.ruleForm.combo):"",e.ruleForm.price=Number(e.ruleForm.price)/100,e.ruleForm.market_price=Number(e.ruleForm.market_price)/100}))},querySearch:function(e,t){var r=this.restaurants;t(r)},handleSelect:function(e){},inputFun:function(e){var t=this,r={name:this.ruleForm.combo[e].name};this.$store.dispatch("goods/getGroupBuySelectGoods",r).then((function(e){var r=[];e.data.map((function(e){r.push({value:e.name})})),t.restaurants=r}))},handleChange:function(e){},submitForm:function(e){var t=this;this.$refs[e].validate((function(e){if(!e)return console.log("error submit!!"),!1;var r=l.a.cloneDeep(t.ruleForm);if(r.merchant_id=t.merchant_id,r.shop_id=t.shop_id,r.discount=Number(r.discount),r.market_price=100*Number(r.market_price),r.sort=Number(r.sort),r.price=Number(t.computedPrice),r.image.constructor==Array)r.image=r.image.join(",");else if(!t.isAddImg){var i=[],o=[];i=r.image.split(",");for(var s=0;s<i.length;s++)o=i[s].split("/upload"),i[s]="/upload"+o[1];r.image=i.join(",")}t.$store.dispatch("goods/updateGoods",r).then((function(e){t.$message({message:""+e.msg,type:"success"}),t.$router.push({path:"/shopInfo",query:{shop_id:t.shop_id,merchant_id:t.merchant_id,tab:"shopGoods"}})}))}))},resetForm:function(e){this.$refs[e].resetFields()},parentFun:function(e,t){var r=[];if(r=e,""==this.ruleForm.image)this.ruleForm.image=r.join(",");else if(t){this.isAddImg=!0;var i=[],o=[];i=this.ruleForm.image.split(",");for(var s=0;s<i.length;s++)o=i[s].split("/upload"),i[s]="/upload"+o[1];this.ruleForm.image=i.join(",")+","+r.join(",")}else this.isAddImg=!0,this.ruleForm.image=r.join(",")},addGoodsDetail:function(e){this.ruleForm.combo.push({name:"",num:1,unit:""})},removeGoodsDetail:function(e){this.ruleForm.combo.splice(e,1)},getGoodsClass:function(){var e=this,t={page_size:1e4,merchant_id:this.merchant_id,shop_id:this.shop_id};this.$store.dispatch("goods/getGoodsClass",t).then((function(t){e.options=t.data}))},addSummary:function(e){this.ruleForm.summary.push({item_name:"",item_content:""})},removeSummary:function(e){this.ruleForm.summary.splice(e,1)}}},c=n,u=(r("c83b"),r("2877")),m=Object(u["a"])(c,i,o,!1,null,"6811acd8",null);t["default"]=m.exports},a15b:function(e,t,r){"use strict";var i=r("23e7"),o=r("44ad"),s=r("fc6a"),a=r("a640"),l=[].join,n=o!=Object,c=a("join",",");i({target:"Array",proto:!0,forced:n||!c},{join:function(e){return l.call(s(this),void 0===e?",":e)}})},a434:function(e,t,r){"use strict";var i=r("23e7"),o=r("23cb"),s=r("a691"),a=r("50c4"),l=r("7b0b"),n=r("65f0"),c=r("8418"),u=r("1dde"),m=r("ae40"),d=u("splice"),p=m("splice",{ACCESSORS:!0,0:0,1:2}),h=Math.max,f=Math.min,g=9007199254740991,b="Maximum allowed length exceeded";i({target:"Array",proto:!0,forced:!d||!p},{splice:function(e,t){var r,i,u,m,d,p,v=l(this),F=a(v.length),_=o(e,F),k=arguments.length;if(0===k?r=i=0:1===k?(r=0,i=F-_):(r=k-2,i=f(h(s(t),0),F-_)),F+r-i>g)throw TypeError(b);for(u=n(v,i),m=0;m<i;m++)d=_+m,d in v&&c(u,m,v[d]);if(u.length=i,r<i){for(m=_;m<F-i;m++)d=m+i,p=m+r,d in v?v[p]=v[d]:delete v[p];for(m=F;m>F-i+r;m--)delete v[m-1]}else if(r>i)for(m=F-i;m>_;m--)d=m+i-1,p=m+r-1,d in v?v[p]=v[d]:delete v[p];for(m=0;m<r;m++)v[m+_]=arguments[m+2];return v.length=F-i+r,u}})},b6d3:function(e,t,r){},baa5:function(e,t,r){var i=r("23e7"),o=r("e58c");i({target:"Array",proto:!0,forced:o!==[].lastIndexOf},{lastIndexOf:o})},c83b:function(e,t,r){"use strict";var i=r("8068"),o=r.n(i);o.a},ff03:function(e,t,r){"use strict";var i=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"uploadFiles"},[r("el-upload",{directives:[{name:"show",rawName:"v-show",value:""!=this.root,expression:"this.root != ''"}],ref:"upload_file",attrs:{action:"/api/file/uploads","list-type":"picture-card",limit:e.limit,"file-list":e.TfileList,"on-preview":e.handlePictureCardPreview,"http-request":e.uploadImg,"on-change":e.handleChange,"on-success":e.handleSuccess,"before-upload":e.beforeAvatarUpload,"on-exceed":e.exceedFun,"on-remove":e.removeFun}},[r("i",{staticClass:"el-icon-plus"})]),r("h4",{directives:[{name:"show",rawName:"v-show",value:""==this.root,expression:"this.root == ''"}]},[e._v("没有设置路径“root”...")]),r("el-dialog",{attrs:{visible:e.dialogVisible},on:{"update:visible":function(t){e.dialogVisible=t}}},[r("img",{key:e.dialogImageUrl,attrs:{width:"100%",src:e.dialogImageUrl,alt:""}})]),r("el-dialog",{attrs:{title:"提示",visible:e.chaochudialogVisible,width:"30%"},on:{"update:visible":function(t){e.chaochudialogVisible=t}}},[r("span",[e._v(e._s(e.tishi))]),r("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{on:{click:function(t){e.chaochudialogVisible=!1}}},[e._v("取 消")]),r("el-button",{attrs:{type:"primary"},on:{click:function(t){e.chaochudialogVisible=!1}}},[e._v("确 定")])],1)])],1)},o=[],s=(r("4160"),r("baa5"),r("b0c0"),r("a9e3"),r("ac1f"),r("1276"),r("159b"),r("96cf"),r("1da1")),a=r("5f87"),l=r("9b15"),n={name:"newUploadFiles",props:{limit:Number,TfileList:Array,shop:Boolean,root:{type:String,default:""}},data:function(){return{header:{headers:{"Content-Type":"multipart/form-data; boundary=--------------------------AAAAA",AccessToken:Object(a["a"])()}},clentSts:{},fileLists:[],dialogImageUrl:"",dialogVisible:!1,chaochudialogVisible:!1,tishi:"",isAdd:!0}},methods:{removeFun:function(e,t){for(var r=[],i=[],o=[],s=0;s<t.length;s++)r=t[s].url.split("/upload"),o[s]="/upload"+r[1],i.push(o[s]);this.isAdd=!1,this.shop||this.$emit("childrenFun",i,this.isAdd)},exceedFun:function(){1==this.limit?(this.chaochudialogVisible=!0,this.tishi="只能上传1张图片，请先删除原有图片，再上传新的图片"):6==this.limit&&(this.chaochudialogVisible=!0,this.tishi="只能上传6张图片，请先删除要替换的图片，再上传新的图片")},handleChange:function(e,t){this.fileLists.push(e.raw)},uploadImg:function(e){var t=this,r=new FormData,i=this;this.fileLists.forEach((function(e){r.append("file[]",e,e.name),r.append("root",i.root)})),this.$ajax.defaults.headers.common["token"]=Object(a["a"])(),this.$ajax.post("/api/file/uploads",r,this.header).then((function(e){t.isAdd=!0;var r=e.data.data.url_path,i=r[r.length-1];1==t.limit?t.$emit("childrenFun",i,t.isAdd):t.shop?t.$emit("childrenFun",r,"0"):t.$emit("childrenFun",r,t.isAdd)}))},handlePictureCardPreview:function(e){this.dialogImageUrl=e.url,this.dialogVisible=!0},getFileSts:function(){var e=this;this.$store.dispatch("shop/getFileSts").then((function(t){e.clentSts=t.data.Credentials}))},handleUploadSTS:function(e){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function r(){var i,o,a,n,c,u;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,t.$store.dispatch("shop/getFileSts").then((function(e){return e.data.Credentials}));case 3:return t.clentSts=r.sent,console.log("this.clentSts:",t.clentSts),console.log("option:",e),i=e.file,o=i.name.lastIndexOf("."),a=i.name.substr(o),n="product/"+Date.parse(new Date)+a,c=new l({accessKeyId:t.clentSts.AccessKeyId,accessKeySecret:t.clentSts.AccessKeySecret,stsToken:t.clentSts.SecurityToken,region:"oss-cn-hangzhou",bucket:"ddhi"}),r.next=13,c.multipartUpload(n,i,{progress:function(){var t=Object(s["a"])(regeneratorRuntime.mark((function t(r){var i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:console.log("p:",r),i={},i.percent=100*r,e.onProgress(i);case 4:case"end":return t.stop()}}),t)})));function r(e){return t.apply(this,arguments)}return r}()});case 13:if(u=r.sent,console.log(u),200!==u.res.statusCode){r.next=19;break}return r.abrupt("return",u);case 19:e.onError("上传失败");case 20:r.next=27;break;case 22:r.prev=22,r.t0=r["catch"](0),console.error(r.t0),e.onError("上传失败"),t.$error(r.t0.message);case 27:case"end":return r.stop()}}),r,null,[[0,22]])})))()},handleSuccess:function(e){console.log("response.res.status:",e),200===e.res.status&&console.log("上传了")},beforeAvatarUpload:function(e){var t=e.size/1024/1024<2;return t||this.$message.error("上传图片大小不能超过 2MB!"),t}}},c=n,u=(r("4091"),r("2877")),m=Object(u["a"])(c,i,o,!1,null,"f2a077e6",null);t["a"]=m.exports}}]);
//# sourceMappingURL=chunk-49735644.54b9e73a.js.map